endpoint_add_tcp "5.249.165.251:30100" 
endpoint_add_udp "5.249.165.251:30100" 
set sv_listingIPOverride "5.249.165.251" 
## You CAN edit the following:
sv_maxclients 8
set steam_webApiKey "none"
sets tags "default, deployer, qbox"

## You MAY edit the following:
sv_licenseKey "cfxk_2aUCewv1bB73yaMSQkfW_RlJmq"
sv_hostname "Life$tyle RolePlay"
sets sv_projectName "Life$tyle RolePlay"
sets sv_projectDesc "A city with serious RP"
sets locale "en-US" # replace with your language and location code, like en-US, pt-BR, etc
set mysql_connection_string "mysql://zap1339023-1:V5ozTPOJPGpFNCAO@mysql-mariadb-28-104-asx.zap-srv.com/zap1339023-1?charset=utf8mb4"

# loadscreen config
# --- CUSTOM LOADSCREEN ---
ensure bd_loadingscreen


# Chat config
set resources_useSystemChat true
set chat_showJoins true
set chat_showQuits true

# Voice config
exec voice.cfg

# Qbox config
setr qb_locale "en"
setr qbx:enableBridge "true" # When true, enables the qb-core bridge for qbx_core
set qbx:enableQueue "true" # When true, enables qbx_core's built-in queue system
set qbx:bucketLockdownMode "inactive" # Sets the lockdown mode as inactive read here: https://docs.fivem.net/natives/?_0xA0F2201F
set qbx:discordLink "discord.gg/qbox" # Sets the servers discord link
set qbx:max_jobs_per_player 1 # Sets the number of jobs per player
set qbx:max_gangs_per_player 1 # Sets the number of gangs per player
set qbx:setjob_replaces "true" # When true, the SetJob function deletes the previous primary job of the player before setting the new one
set qbx:setgang_replaces "true" # When true, the SetGang function deletes the previous primary gang of the player before setting the new one
set qbx:cleanPlayerGroups "true" # When true, on server startup, the database will be checked for any groups/grades players have that are not in config files and removes them from the database if so
set qbx:allowMethodOverrides "true" # When true, enables the ability of resources to override existing methods in the player object
set qbx:disableOverrideWarning "false" # When true, disables warnings from resources overriding existing methods in the player object
setr qbx:enableVehiclePersistence "false" # When true, player vehicles marked for persistence will be respawned when deleted
setr qbx:vehiclePersistenceType "semi" # When "full", player vehicles will also be respawned after server restarts, when "semi", they will only respawn when deleted
set qbx:acknowledge "false" # When true, disables the default service message
setr qbx:enableGroupManagement "false" # When true, allows bosses to manage job/gang grades. Specifically the grade name.

# Message displayed to players in the chat after loading in
setr qbx:motd "<p style='padding: 1rem; background-color: rgb(30, 30, 30); border-radius: 1rem; text-align: center;'><span style='color: rgb(40, 200, 40);'>Welcome to Qbox!</span><br>Learn more at <span id='link' style='color: rgb(100, 100, 255);' onclick='window.invokeNative(\"openUrl\", \"https://docs.qbox.re/\")'>docs.qbox.re</span></p><style>span#link:hover { cursor: pointer; }</style>"

# illenium-appearance locale config
setr illenium-appearance:locale "en"

# Renewed-Weathersync config
setr weather_disablecd true

# Ox resources config
exec ox.cfg

# NPWD config
set npwd:framework "qbx"
# fill them in if you want extra phone functionality https://projecterror.dev/docs/npwd/start/installation#setting-up-camera-functionality
set SCREENSHOT_BASIC_TOKEN ""
set NPWD_AUDIO_TOKEN ""

# ============================================
# PERFORMANCE OPTIMIZATIONS
# ============================================
# These settings help reduce latency and improve resource startup reliability

# Lock game build to prevent version mismatches that can cause crashes
set sv_enforceGameBuild 3570

# Reduce server load during resource initialization
# Disable script hooks if not needed (improves performance)
set sv_scriptHookAllowed 0

# Network optimizations to reduce latency spikes
set sv_enableNetworkedSounds false  # Disable if not needed (reduces network overhead)
set sv_enableNetworkedScriptEntityStates false  # Disable if not needed (reduces overhead)

# Entity lockdown to prevent abuse and improve performance
set sv_entityLockdown "relaxed"  # Options: inactive, relaxed, strict

# Reduce request paranoia for better performance (adjust based on your needs)
set sv_requestParanoia 1  # 0-3, lower = better performance but less security

# Enable net event reassembly for better network performance
setr sv_enableNetEventReassembly true
setr sv_netEventReassemblyMaxPendingEvents 150  # Increase buffer for busy servers

# Reduce thread hitches by limiting entity operations
set sv_filterRequestControl 1  # Helps prevent control request spam
set sv_filterRequestControlSettleTimer 20000  # 20 seconds (reduced from 30)

# Database connection optimization (helps prevent timeouts during resource startup)
# Note: These are handled by oxmysql, but ensuring connection string is optimized
# Your connection string already has charset=utf8mb4 which is good

# Resource startup timeout protection
# Some resources may need more time during high load periods
# The explicit ensures we added help, but this provides additional protection
# ============================================

# Allow mapforcer to start other resources
add_ace resource.mapforcer command.start allow
add_ace resource.mapforcer command.stop allow
add_ace resource.mapforcer command.restart allow

# ============================================
# RESOURCE LOAD ORDER
# ============================================
# Core → Framework → Libraries → Scripts
# 
# IMPORTANT: Folder names must match exactly (case-sensitive)
# Each resource must have fxmanifest.lua or __resource.lua
# Check server console for startup errors if resources don't load
# ============================================

# --- BASE GAME & CORE ---
stop basic-gamemode
ensure chat
ensure chat-theme-gtao
ensure lSpawnSelector
ensure sessionmanager
ensure hardcap
ensure baseevents
ensure mapforcer
ensure player-data
ensure playernames

# Load vanilla GTA map last
start map

# Core dependencies (load first)
ensure ox_lib
ensure oxmysql
ensure qbx_core

# Ox resources
ensure ox_target
ensure ox_inventory
ensure ox_doorlock

# Bridges
ensure [scripts]/[bridges]

# Shared libraries (before scripts that use them)
ensure qt-library
ensure jpr-libs
ensure lc_utils
ensure ps_lib

# Framework resources
ensure [qbx]
ensure [voice]
ensure [ox]
ensure screenshot-basic

# Heavy resource folders (must be ensured in server.cfg, not via script)
ensure [assets]
ensure [eup]
ensure [cars]
ensure [carsounds]
ensure Riverside-Oaks-Village

# ONX Emergency Vehicles (must load in specific order - shared first, then packs)
# NOTE: These are licensed/paid assets - ensure license is active at portal.cfx.re/assets/granted-assets
ensure onx-evp-a-shared         # Shared mods/data - MUST load first
ensure onx-evp-b-lightbars      # Lightbar systems
ensure onx-evp-b-livery-mods    # Department liveries/skins
ensure onx-evp-b-wheels         # Custom wheel pack
ensure onx-evp-c-pack           # Emergency vehicles pack
ensure onx-evp-c-pack2          # Additional emergency vehicles pack

# Startup delay script (loads individual heavy resources with delays)
# Note: This resource must be in [scripts]/[standalone]/startup-delay/
ensure startup-delay

# Maps & vehicles (individual maps loaded by startup-delay script with delays)
# Folder ensures don't work with StartResource(), so individual maps are handled by script
# ensure mapmanager
# ensure [maps]

# Standalone scripts (startup-delay will ensure individual resources if folder ensure fails)
ensure [scripts]/[standalone]

# Stop unwanted resources
stop redm-map-one
stop sessionmanager-rdr3
stop ped-money-drops
stop money
stop money-fountain
stop money-fountain-example-map
stop example-loadscreen
stop yarn
stop webpack
stop qbx_hud

# Scripts (folder ensures attempt to load all, startup-delay ensures individually if needed)
# Life scripts
ensure [scripts]/[life]

# JPR addons
ensure DLCiplLoader
ensure jpr-libsss

# Job scripts
ensure [scripts]/[jobs]
ensure md-jobs

# Criminal scripts - kq_lootareas must load before kq_club_heist
ensure kq_lootareas
ensure [scripts]/[criminal]

# Other scripts
ensure [scripts]/[hunting]
ensure [scripts]/[casino]
ensure [scripts]/[admin]
ensure [scripts]/[government]

# Bridges (explicitly ensure - folder already ensured above)
ensure jim_bridge
ensure qb-core-bridge

# Note: startup-delay script will ensure individual resources that don't start from folders
# This happens 15 seconds after server start to allow folder ensures to complete first


# Note: Housing and admin resources already loaded above

## Permissions ##
# Deployer Note: this admin master has no identifiers to be automatically added.
# add_principal identifier.discord:111111111111111111 group.admin #example
exec permissions.cfg
# --- Admin Permissions ---
add_ace identifier.license:e82401e87b175a2cabe05fcf33a100e7219a7496 command allow
add_principal identifier.license:e82401e87b175a2cabe05fcf33a100e7219a7496 group.admin

add_ace identifier.license:f276e341a9ec9c9c521d271ee9b98c2ec48dbc2d command allow
add_principal identifier.license:f276e341a9ec9c9c521d271ee9b98c2ec48dbc2d group.admin

add_ace identifier.license:f276e341a9ec9c9c521d271ee9b98c2ec48dbc2d command allow
add_principal identifier.license:f416f7bca2ff4cc8ff582babf66256d964a2a12f group.admin

add_ace identifier.license:fe84d79de20ee5467d6e4c046d2395f94e7ddc20 # TheMortician 
add_principal identifier.license:fe84d79de20ee5467d6e4c046d2395f94e7ddc20

add_principal identifier.discord:907787623681110047 qbcore.admin
add_principal identifier.discord:795494974182391838 qbcore.god
add_principal identifier.discord:51044733635959195 qbcore.admin
add_principal identifier.discord:691445103067267104 qbcore.admin
add_principal identifier.discord:1208038643994988565 qbcore.admin
add_principal identifier.discord:754189416662171768 qbcore.admin # TheMortician

add_ace group.admin command allow
add_ace group.admin admin allow
add_ace group.admin god allow  # Full access to qb-admin for all admins
add_ace resource.qbcore.god command allow
add_ace group.admin heist.admin allow
add_ace group.admin chrislocks.admin allow
add_ace group.admin command.heistbuilder allow
add_ace group.admin create allow # Creating Crafting tables (qt-crafting)
add_ace group.admin edit allow # Editing Crafting tables (qt-crafting)
## Miscellaneous ##
exec misc.cfg
add_principal identifier.discord:795494974182391838 group.mod
add_principal identifier.discord:1208038643994988565 group.mod
add_principal identifier.discord:691445103067267104 group.mod
add_principal identifier.discord:795494974182391838 command.heistbuilder
add_principal identifier.discord:795494974182391838 chrislocks.admin
add_principal identifier.steam:11000014569c44e group.admin # added by ZAP-Hosting for EasyAdmin
add_principal identifier.steam:11000014b150478 group.admin # added by ZAP-Hosting for EasyAdmin
