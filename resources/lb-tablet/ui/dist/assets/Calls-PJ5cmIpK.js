import{O as y,u as m,r as o,k as N,ah as W,bH as B,a2 as U,n as f,J as E,j as a,ag as w,a as s,F as p,K as k,L as r,o as H,bu as M,bp as F,bP as G,b2 as h,bs as v,bQ as x,a1 as _,i as T,bL as D,Y as q,bF as $,a3 as j}from"./index-BbvBBay_.js";const L=y(null),u=y([]);function z(){const e=m(L),c=m(u),C=m(_.APPS.POLICE.permissions),[l,S]=o.useState(""),[d,O]=o.useState("");o.useState(null),o.useEffect(()=>{var t;N("Police",{action:"getWiretaps",query:l},W()&&((t=B.wireTaps)==null?void 0:t.filter(i=>i.phoneNumber.toLowerCase().includes(l.toLowerCase())||i.phoneName.toLowerCase().includes(l.toLowerCase())))).then(i=>{i&&u.set(i)})},[l]),o.useEffect(()=>{const t=setTimeout(()=>S(d),500);return()=>clearTimeout(t)},[d]);const{handleScroll:A}=U({fetchData:t=>N("Police",{action:"getWiretaps",query:l,page:t}),onDataFetched:t=>u.set([...u.value,...t]),perPage:25});f("police:createWiretap",t=>{if(!t)return E("error","police:createWiretap did not return anything");u.set([...u.value,t])}),f("police:removeWiretap",t=>{var i;if(!t)return E("error","police:removeWiretap did not return anything");u.set(u.value.filter(n=>n.phoneNumber!==t)),((i=L.value)==null?void 0:i.phoneNumber)===t&&L.reset()});const I=()=>{let t="";T.PopUp.set({title:r("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.TITLE"),description:r("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.DESCRIPTION"),input:{placeholder:r("APPS.POLICE.PHONE.CALLS.WIRETAP_PHONENUMBER.PLACEHOLDER"),type:"text",minLength:3,value:"",onChange:i=>{t=i}},buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.PROCEED"),cb:()=>{if(!t)return E("warning","No phone number input");N("Police",{action:"wiretapNumber",phoneNumber:t},!0).then(i=>{var P,b;if(!i)return E("error","wiretapNumber did not return anything");let n={phoneNumber:t,phoneName:i.phoneName,subscribed:!1,createdAt:Date.now(),createdBy:(P=D.value)==null?void 0:P.id,author:(b=D.value)==null?void 0:b.name};L.set(n)})}}]})};return a("div",{className:"calls-container",children:a(w,{children:e?a(V,{}):s(p,{children:[s("div",{className:"search-container buttons",children:[a(k,{placeholder:"Search wiretaps",onChange:t=>O(t.target.value)}),C.phone.createWiretap&&a("div",{className:"buttons",children:a("div",{className:"button",onClick:I,children:r("APPS.POLICE.ADD")})})]}),s("div",{className:"list",onScroll:A,children:[(c==null?void 0:c.filter(t=>{var i;return(i=t==null?void 0:t.phoneNumber)==null?void 0:i.toLowerCase().includes(l.toLowerCase())}).length)===0&&l.length>0&&a("div",{className:"no-results",children:r("APPS.POLICE.NO_RESULTS_FOR",{query:l})}),c==null?void 0:c.map(t=>s(H.div,{...M,className:"item",onClick:()=>L.set(t),children:[s("div",{className:"img",children:[a("img",{src:F(null,"profile")}),a(G,{})]}),s("div",{className:"info",children:[a("div",{className:"name",children:t.phoneName??h(t.phoneNumber)}),t.phoneName&&a("div",{className:"subtitle",children:h(t.phoneNumber)}),s("div",{className:"cards",children:[a("div",{className:v("card",t.subscribed?"green":"red"),children:t.subscribed?r("APPS.POLICE.PHONE.CALLS.SUBSCRIBED"):r("APPS.POLICE.PHONE.CALLS.NOT_SUBSCRIBED")}),a("div",{className:"divider"}),a("div",{className:v("card",t.inCall?"green":"red"),children:t.inCall?r("APPS.POLICE.PHONE.CALLS.IN_CALL"):r("APPS.POLICE.PHONE.CALLS.NOT_IN_CALL")})]}),s("div",{className:"id report",style:{marginTop:"auto"},children:[a("div",{className:"label",children:r("APPS.POLICE.PHONE.CALLS.FOOTER",{name:t.author})}),a("div",{className:"value",children:x(t.createdAt)})]})]})]},t.phoneNumber))]})]})})})}const V=()=>{const e=m(L),[c,C]=o.useState([]),l=m(_.APPS.POLICE.permissions),[S,d]=o.useState(""),[O,A]=o.useState(""),I=()=>{T.PopUp.set({title:r("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.TITLE"),description:r("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.DESCRIPTION",{phoneNumber:h(e==null?void 0:e.phoneNumber)}),buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.PROCEED"),color:"red",cb:()=>{N("Police",{action:"removeWiretap",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(i=>{if(!i)return E("error","removeWiretap did not return anything");L.reset(),u.set(u.value.filter(n=>n.phoneNumber!==(e==null?void 0:e.phoneNumber)))})}}]})};o.useEffect(()=>{var i;l.phone.callHistory&&N("Police",{action:"getCallHistory",phoneNumber:e==null?void 0:e.phoneNumber,query:S},W()&&((i=B.callHistory)==null?void 0:i.filter(n=>{if(!n)return!1;let P=(e==null?void 0:e.phoneNumber)===n.callee?n.caller:n.callee;return!(n!=null&&n.hideCallerId)&&(P==null?void 0:P.toLowerCase().includes(S.toLowerCase()))}))).then(n=>{if(!n)return E("error","getCallHistory did not return anything");C(n)})},[S]),o.useEffect(()=>{const i=setTimeout(()=>d(O),500);return()=>clearTimeout(i)},[O]);const{handleScroll:t}=U({fetchData:i=>N("Police",{action:"getCallHistory",phoneNumber:e==null?void 0:e.phoneNumber,query:S,page:i}),onDataFetched:i=>C([...c,...i]),perPage:25});return a(p,{children:s("main",{className:"main chat",children:[s("div",{className:"main-header",children:[s("div",{className:"back",onClick:()=>L.reset(),children:[a(q,{})," ",r("APPS.POLICE.BACK")]}),a("div",{className:"button red",onClick:I,children:r("APPS.POLICE.PHONE.CALLS.REMOVE_WIRETAP.TITLE")})]}),s("div",{className:"main-body full-height",children:[l.phone.callHistory&&s("div",{className:"chats",children:[a("div",{className:"top",children:a("div",{className:"title",children:r("APPS.POLICE.PHONE.CALLS.CALL_HISTORY")})}),a(k,{placeholder:r("APPS.POLICE.PHONE.CALLS.SEARCH"),onChange:i=>A(i.target.value)}),a("div",{className:"items",onScroll:t,children:c.sort((i,n)=>i.timestamp>n.timestamp?-1:1).map((i,n)=>{let P=(e==null?void 0:e.phoneNumber)===i.callee?i.caller:i.callee,b=(e==null?void 0:e.phoneNumber)===i.callee&&!i.answered,R=(e==null?void 0:e.phoneNumber)===i.callee;return o.createElement(H.div,{...M,key:n,className:"item","data-missed":b,onClick:()=>{i.hideCallerId||$(P)}},s("div",{className:"user",children:[a("img",{src:F(null,"profile")}),a("div",{className:"info",children:i.hideCallerId?s(p,{children:[r("APPS.POLICE.PHONE.CALLS.NO_CALLER_ID"),s("span",{children:[R?r("APPS.POLICE.PHONE.CALLS.INCOMING"):r("APPS.POLICE.PHONE.CALLS.OUTGOING")," • ",g(i.duration)]})]}):s(p,{children:[h(P),s("span",{children:[R?r("APPS.POLICE.PHONE.CALLS.INCOMING"):r("APPS.POLICE.PHONE.CALLS.OUTGOING")," • ",g(i.duration)]})]})})]}),a("div",{className:"date",children:j(i.timestamp)}))})})]}),a("div",{className:"chats room",children:a(w,{children:a(Y,{})})})]})]})})},Y=()=>{var I,t;const e=m(L),c=m(_.APPS.POLICE.permissions),[C,l]=o.useState(!1),[S,d]=o.useState(((I=e==null?void 0:e.inCall)==null?void 0:I.duration)??0);o.useEffect(()=>()=>{C&&N("Police",{action:"stopListeningToWiretap",phoneNumber:e==null?void 0:e.phoneNumber})},[]),o.useEffect(()=>{var n;if(!((n=e==null?void 0:e.inCall)!=null&&n.duration))return;const i=setInterval(()=>{d(P=>P+1)},1e3);return()=>clearInterval(i)},[e==null?void 0:e.inCall]);const O=()=>{let i=!(e!=null&&e.subscribed);T.PopUp.set({title:i?r("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS"):r("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS"),description:i?r("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS_DESCRIPTION"):r("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS_DESCRIPTION"),buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.PROCEED"),cb:()=>{N("Police",{action:"toggleSubscribeWiretap",phoneNumber:e==null?void 0:e.phoneNumber,subscribe:i},!0).then(n=>{if(!n)return E("error","toggleSubscribeWiretap did not return anything");L.patch({subscribed:i})})}}]})},A=()=>{T.PopUp.set({title:C?r("APPS.POLICE.PHONE.CALLS.STOP_LISTENING"):r("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL"),description:C?r("APPS.POLICE.PHONE.CALLS.STOP_LISTENING_DESCRIPTION"):r("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL_DESCRIPTION"),buttons:[{title:r("APPS.POLICE.CANCEL")},{title:r("APPS.POLICE.PROCEED"),cb:()=>{N("Police",{action:C?"stopListeningToWiretap":"listenToWiretap",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(i=>{if(!i)return E("error","listenToWiretap did not return anything");l(!C)})}}]})};return f("police:setInCall",i=>{i.number===(e==null?void 0:e.phoneNumber)&&(L.patch({inCall:i.inCall?{inCallWith:i.inCallWith,duration:i.duration??0}:null}),u.set(u.value.map(n=>n.phoneNumber===(e==null?void 0:e.phoneNumber)?{...n,inCall:i.inCall?{inCallWith:i.inCallWith,duration:i.duration??0}:null}:n)))}),s(H.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.2},className:"active-call",children:[a("div",{className:"top",children:a("div",{className:"title",children:r("APPS.POLICE.PHONE.CALLS.CALL_STATUS")})}),a("div",{className:"call-content",children:a("div",{className:"center",children:C&&(e!=null&&e.inCall)?s("div",{className:"call-info",children:[a("div",{className:"contact",children:h((t=e==null?void 0:e.inCall)==null?void 0:t.inCallWith)}),a("div",{className:"duration",children:g(S)}),a("div",{className:"buttons",children:a("div",{className:"button",onClick:A,children:r("APPS.POLICE.PHONE.CALLS.STOP_LISTENING")})})]}):s(p,{children:[s("div",{className:"info",children:[r("APPS.POLICE.PHONE.CALLS.IN_CALL"),":",a("span",{"data-incall":e==null?void 0:e.inCall,children:e!=null&&e.inCall?r("APPS.POLICE.PHONE.CALLS.YES"):r("APPS.POLICE.PHONE.CALLS.NO")})]}),a("div",{className:"buttons",children:e!=null&&e.inCall?c.phone.listenWiretap&&a("div",{className:v("button","green"),onClick:A,children:r("APPS.POLICE.PHONE.CALLS.LISTEN_TO_CALL")}):a("div",{className:v("button",e!=null&&e.subscribed?"red":"green"),onClick:O,children:e!=null&&e.subscribed?r("APPS.POLICE.PHONE.CALLS.UNSUBSCRIBE_FROM_CALLS"):r("APPS.POLICE.PHONE.CALLS.SUBSCRIBE_TO_CALLS")})})]})})})]})},g=e=>{const c=Math.floor(e/3600),C=Math.floor(e/60),l=e%60;return`${c>0?`${c}:`:""}${C}:${l.toString().padStart(2,"0")}`};export{L as SelectedPhone,z as default};
