import{bM as me,bd as Pe,bN as Ce,bO as Te,O as P,bf as Q,u,be as Se,r as b,k as ce,bH as ee,j as r,a as G,a$ as pe,bg as be,bh as Ie,b0 as Ee,bi as Re,bo as Oe,bk as ye,h as k,i as re,L as S,F as ae,R as Ae,V as ve,bl as Me,a1 as Ne,o as Le}from"./index-BbvBBay_.js";import xe,{SelectedPhone as Fe}from"./Calls-PJ5cmIpK.js";import ke,{SelectedPhoneUnlock as we}from"./Unlock-OPxmj8_E.js";function De(e,t,s){t.center!==s.center&&e.setLatLng(t.center),t.radius!=null&&t.radius!==s.radius&&e.setRadius(t.radius)}const X=me(function({center:t,children:s,...c},o){const a=new Pe.Circle(t,c);return Ce(a,Te(o,{overlayContainer:a}))},De),ue=P(Oe.LOS_SANTOS),te=P(localStorage.getItem("lb-active-map-type")??Q.mapStyles.render),j=P([]),w=P({}),D=P(!1),Z=P(!1),B=P(null),W=P([]),z=P(0),F=P(null),N=P(500),O=P(null);let f=null;const _e=3,K=3;function Ue(){const e=u(ue),t=u(te),s=Q.mapTypes[e],c=Se(e),o=u(D),a=u(Z);b.useEffect(()=>{ce("Police",{action:"getServiceConfig"},{cellTowers:ee.cellTowers,rangeData:ee.cellTowerRanges}).then(l=>{l&&(j.set(l.cellTowers),w.set(l.rangeData))})},[]);const i=o||a;return r("div",{className:"triangulate-container",children:G(pe,{className:"map",style:{backgroundColor:Q.backgrounds[t]},crs:e==="losSantos"?be:Ie,center:s!=null&&s.defaultCenter?[s.defaultCenter[0],s.defaultCenter[1]]:[0,0],zoom:s.initialZoom,minZoom:s.minZoom,maxZoom:s.maxZoom,maxBounds:c,preferCanvas:!0,zoomControl:!1,attributionControl:!1,boxZoom:!1,bounceAtZoomLimits:!0,maxBoundsViscosity:.95,children:[r(je,{}),r(Ge,{}),r(Ee,{url:Re[e].tileServer.replace("{layer}",t),noWrap:!0},`${e}-${t}`),i&&r(ze,{})]},`map-${e}-${t}`)})}const He={1:"rgba(250,0,0,0.3)",2:"rgba(250,100,0,0.3)",3:"rgba(250,200,0,0.3)",4:"rgba(1, 131, 1, 0.4)"},_=(e,t,s,c)=>(e-s)**2+(t-c)**2,Ve=(e,t,s,c,o,a)=>{const i=_(e,t,c,o),l=Math.sqrt(i),n=1e-7;if(l<n&&Math.abs(s-a)<n||l>s+a+n||l<Math.abs(s-a)-n)return null;const C=(s*s-a*a+i)/(2*l),y=s*s-C*C,h=y<n?0:Math.sqrt(y),I=e+C*(c-e)/l,g=t+C*(o-t)/l,m=[g-h*(c-e)/l,I+h*(o-t)/l];if(h===0)return[m];const U=[g+h*(c-e)/l,I-h*(c-e)/l];return[m,U]},$e=(e,t)=>{var a,i;const s=Math.sqrt(_(e.x,e.y,t.x,t.y)),c=w.value,o=Object.keys(c).map(Number).sort((l,n)=>n-l);for(const l of o){const n=c[l]*(((i=(a=k.value.Police)==null?void 0:a.Triangulation)==null?void 0:i.RangeMultiplier)??1);if(n!==void 0&&s<=n)return{detected:!0,color:He[l],radius:n}}return{detected:!1,color:null,radius:0}},qe=e=>{if(e.length===0)return{position:null,contributingIntersections:[]};if(e.length===1){const a=e[0];return{position:[a.y,a.x],contributingIntersections:[]}}let t=[];for(let a=0;a<e.length;a++)for(let i=a+1;i<e.length;i++){const l=Ve(e[a].x,e[a].y,e[a].size,e[i].x,e[i].y,e[i].size);l&&t.push(...l)}if(t.length===0)return{position:null,contributingIntersections:[]};if(e.length===2){const a=t.reduce((l,n)=>l+n[0],0),i=t.reduce((l,n)=>l+n[1],0);return{position:[a/t.length,i/t.length],contributingIntersections:t}}const s=1.5,c=t.filter(a=>{const i=a[0],l=a[1];return e.every(n=>_(l,i,n.x,n.y)<=(n.size+s)**2)}),o=c.length>0?c:t;if(o.length>0){const a=o.reduce((l,n)=>l+n[0],0),i=o.reduce((l,n)=>l+n[1],0);return{position:[a/o.length,i/o.length],contributingIntersections:o}}return{position:null,contributingIntersections:[]}},ie=(e,t,s)=>{var n,C,y;const a=(((n=w.value)==null?void 0:n[1])??1500)*(((y=(C=k.value.Police)==null?void 0:C.Triangulation)==null?void 0:y.RangeMultiplier)??1)*1.5;if(e.length===0||!t)return a;let i;if(e.length===1)i=e[0].size;else{let h=0;if(s.length>0){let g=0;s.forEach(m=>{g=Math.max(g,_(t[1],t[0],m[1],m[0]))}),h=Math.sqrt(g)}else e.length>0?h=e.reduce((g,m)=>g+m.size,0)/e.length*.8:h=a/2;let I=1;e.length===2?I=1.2:e.length>3&&(I=.9),i=h*I,i=Math.min(i,a)}return Math.max(10,i)},ze=()=>{var le,se;const e=u(j),t=u(B),s=u(D),c=u(Z),o=u(W),a=u(z),i=u(F),l=u(N),n=u(O),C=ye(),y=b.useRef(null),h=b.useRef(null),I=b.useRef(null),g=b.useRef(null);b.useEffect(()=>{var d,A,v,H,V;if(s){f&&(clearInterval(f),f=null),W.set([]),z.set(0),F.set(null),g.current=null;const L=(((d=w.value)==null?void 0:d[1])??1500)*(((v=(A=k.value.Police)==null?void 0:A.Triangulation)==null?void 0:v.RangeMultiplier)??1);N.set(L),O.set(null),f=setInterval(()=>{const x=z.value;if(x>=e.length){f&&(clearInterval(f),f=null),D.set(!1),Z.set(!0);let T=g.current?"SUCCESS":"FAILED";re.PopUp.set({title:S(`APPS.POLICE.PHONE.TRIANGULATE.${T}.TITLE`),description:S(`APPS.POLICE.PHONE.TRIANGULATE.${T}.DESCRIPTION`),buttons:[{title:S("APPS.POLICE.OK")}]});return}const E=e[x];let $=!0;if(i&&o.length>=K){const T=_(i[1],i[0],E.x,E.y);Math.sqrt(T)>l*_e&&($=!1)}if($&&t){const T=$e(t,E);if(T.detected&&T.color){const p={x:E.x,y:E.y,z:E.z,color:T.color,size:T.radius};W.set(q=>q.some(M=>M.x===p.x&&M.y===p.y)?q:[...q,p])}}z.set(x+1)},((V=(H=k.value.Police)==null?void 0:H.Triangulation)==null?void 0:V.CellTowerTime)??500)}else f&&(clearInterval(f),f=null);return()=>{f&&(clearInterval(f),f=null)}},[s,e,t]),b.useEffect(()=>{var x,E,$;const{position:d,contributingIntersections:A}=qe(o);F.set(d),g.current=d;const v=25,H=v*.2,V=(((x=w.value)==null?void 0:x[1])??1500)*((($=(E=k.value.Police)==null?void 0:E.Triangulation)==null?void 0:$.RangeMultiplier)??1),L=V*1.5;if(t&&d){let p=ie(o,d,A);const q=_(d[1],d[0],t.x,t.y),M=Math.sqrt(q);M>p&&(p=M+H);let Y=Math.max(v,Math.min(L,p)),R=Y;o.length>=K?n===null||Y<n?(O.set(Y),R=Y):(R=n,M>R&&(R=M+H,R=Math.max(v,Math.min(L,R)),R>n&&O.set(R))):n!==null&&O.set(null),N.set(R)}else if(o.length===0)N.set(V),O.set(null),F.set(null),g.current=null;else if(d){let T=ie(o,d,A),p=Math.max(v,Math.min(L,T));N.set(p),o.length<K&&n!==null&&O.set(null)}else N.set(L),O.set(null),F.set(null),g.current=null},[o,t,C,n]),b.useEffect(()=>{y.current&&y.current.bringToFront(),h.current&&h.current.bringToFront(),I.current&&I.current.bringToFront()});const m=s&&!c&&a<e.length?e[a]:null,U=w.value,de=s&&!c,fe=s&&!c&&o.length>0,he=i&&l>0&&(s||c),ne=c?.75:.5,ge=((U==null?void 0:U[1])??1500)*.6*(((se=(le=k.value.Police)==null?void 0:le.Triangulation)==null?void 0:se.RangeMultiplier)??1);return G(ae,{children:[de&&m&&r(X,{center:[m.y,m.x],radius:ge,pathOptions:{color:"rgba(220, 220, 220, 0.3)",fillColor:"rgba(220, 220, 220, 0.75)",fillOpacity:.75,weight:1,dashArray:"8, 4"}},`scanning-${m.x}-${m.y}`),fe&&o.map((d,A)=>r(X,{center:[d.y,d.x],radius:d.size,pathOptions:{color:d.color.replace("0.3","0.7"),fillColor:d.color,fillOpacity:.25,weight:1.5}},`pinging-${d.x}-${d.y}-${A}`)),he&&i&&r(ae,{children:r(X,{ref:h,center:i,radius:l,pathOptions:{color:"rgba(0, 220, 0, 0.8)",fillColor:`rgba(0, 220, 0, ${ne})`,fillOpacity:ne,weight:2}},"accuracy-area")})]})},je=()=>{const e=u(D),t=u(B),s=u(Z),c=()=>{let a="";re.PopUp.set({title:S("APPS.POLICE.PHONE.TRIANGULATE.TITLE"),description:S("APPS.POLICE.PHONE.TRIANGULATE.DESCRIPTION"),input:{placeholder:S("APPS.POLICE.PHONE.TRIANGULATE.PLACEHOLDER"),type:"text",minLength:3,value:"",onChange:i=>{a=i}},buttons:[{title:S("APPS.POLICE.CANCEL")},{title:S("APPS.POLICE.PROCEED"),cb:()=>{o(),j.value.length!==0&&ce("Police",{action:"triangulate",phoneNumber:a},ee.phonePosition).then(i=>{const l=[...j.value];j.set(l.sort(()=>.5-Math.random())),D.set(!0),i&&B.set(i)})}}]})},o=()=>{D.set(!1),Z.set(!1),B.set(null),W.set([]),z.set(0),F.set(null),N.set(500),O.set(null),f&&(clearInterval(f),f=null)};return G("div",{className:"search",children:[!e&&r(Ae,{onClick:c}),(e||s||t)&&r(ve,{onClick:o})]})},Ge=()=>{const e=u(te);u(ue);const t=["render","game","print"];return r("div",{className:"options",children:r(Me,{onClick:()=>{const c=t.indexOf(e),o=t[(c+1)%t.length];te.set(o),localStorage.setItem("lb-active-map-type",o)}})})},J=P("triangulate"),oe={triangulate:{label:S("APPS.POLICE.PHONE.TRIANGULATE.TITLE"),view:r(Ue,{})},unlock:{label:S("APPS.POLICE.PHONE.UNLOCK.TITLE"),view:r(ke,{})},calls:{label:S("APPS.POLICE.PHONE.CALLS.TITLE"),view:r(xe,{})}};function We(){var i;const e=u(J),t=u(we),s=u(Fe),[c,o]=b.useState(oe);b.useEffect(()=>{const l=Object.fromEntries(Object.entries(oe).filter(([n])=>a(n)));o(l),J.set(Object.keys(l)[0])},[]);const a=l=>{var C;let n=(C=Ne.APPS.POLICE.permissions.value)==null?void 0:C.phone;return n?l==="triangulate"?n==null?void 0:n.triangulate:l==="unlock"?n==null?void 0:n.unlock:l==="calls"?(n==null?void 0:n.callHistory)||(n==null?void 0:n.createWiretap)||(n==null?void 0:n.listenWiretap):!1:!1};return r(Le.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:r("main",{className:"main profiles",children:G("div",{className:"page",style:{gap:e==="calls"&&s||e=="unlock"&&t?"0":"1rem"},children:[G("div",{className:"top",children:[r("div",{className:"title",children:S("APPS.POLICE.PHONE.TITLE")}),r("div",{className:"selector",children:Object.keys(c).map(l=>r("div",{className:"option","data-active":e===l,onClick:()=>J.set(l),children:c[l].label},l))}),r("div",{})]}),r("div",{className:"items",style:{padding:e==="calls"&&s||e=="unlock"&&t?"0":"0 0.75rem",overflowY:e==="calls"&&s?"hidden":"auto"},children:(i=c[e])==null?void 0:i.view})]})})})}export{We as default};
