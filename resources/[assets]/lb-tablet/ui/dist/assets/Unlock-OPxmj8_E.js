import{r as l,O as D,u as g,k as A,J as P,j as i,a as N,F as b,K as F,L as s,h as I,o as x,bu as _,bp as M,bP as j,b2 as f,bs as L,i as K,Y as B}from"./index-BbvBBay_.js";const y=({timestamp:e,onTimeUp:u,interval:n=1e3})=>{const[m,t]=l.useState(0),[a,d]=l.useState(!1);return l.useEffect(()=>{if(!e){t(0);return}const o=()=>{const c=e-Date.now();t(c),c<=0&&c>-1e3&&!a&&u&&(d(!0),u())};o();const r=setInterval(o,n);return()=>clearInterval(r)},[e,u,n,a]),{remainingTime:m,formattedTime:(o=>{if(o<=0)return"00:00:00";const r=Math.floor(o/(1e3*60*60)),c=Math.floor(o%(1e3*60*60)/(1e3*60)),O=Math.floor(o%(1e3*60)/1e3);return`${r.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`})(m),isTimeUp:m<=0}},h=D([]),C=D(null);function q(){const e=g(h),u=g(C),[n,m]=l.useState("");return l.useEffect(()=>{A("Police",{action:"getPhones"},[{phoneNumber:"1234567890",phoneName:"John's Phone",unlocked:!0,timeRemaining:0,attempts:1},{phoneNumber:"1234567892",phoneName:"Breze's phone",unlocked:!0,attempts:0,timeRemaining:15},{phoneNumber:"1234567893",phoneName:"Jane's Phone",unlocked:!1,attempts:1}]).then(t=>{if(!t)return P("warning","Failed to get equipped phones");t.forEach(a=>{a.timeRemaining!==void 0&&(a.finishedAt=Date.now()+a.timeRemaining*1e3)}),h.set(t)})},[]),i("div",{className:"unlock-container",children:u?i(J,{}):N(b,{children:[i("div",{className:"search-container",style:{width:"100%"},children:i(F,{style:{width:"100%"},placeholder:s("APPS.POLICE.PHONE.UNLOCK.SEARCH"),onChange:t=>m(t.target.value)})}),N("div",{className:"list",children:[e.length===0&&n.length===0&&i("div",{className:"no-results",children:s("APPS.POLICE.PHONE.UNLOCK.NO_PHONES")}),(e==null?void 0:e.filter(t=>{var a,d;return t.phoneName?t.phoneName.toLowerCase().includes(n.toLowerCase())||((a=t.phoneNumber)==null?void 0:a.toLowerCase().includes(n.toLowerCase())):(d=t.phoneNumber)==null?void 0:d.toLowerCase().includes(n.toLowerCase())}).length)===0&&n.length>0&&i("div",{className:"no-results",children:s("APPS.POLICE.NO_RESULTS_FOR",{query:n})}),e==null?void 0:e.filter(t=>{var a,d;return t.phoneName?t.phoneName.toLowerCase().includes(n.toLowerCase())||((a=t.phoneNumber)==null?void 0:a.toLowerCase().includes(n.toLowerCase())):(d=t.phoneNumber)==null?void 0:d.toLowerCase().includes(n.toLowerCase())}).map(t=>i(G,{phone:t},t.phoneNumber))]})]})})}const G=({phone:e})=>{var o,r,c,O,v,U,T;const[u,n]=l.useState(e.unlocked&&p(e.finishedAt)),[m,t]=l.useState(!u&&k(e.finishedAt)),[a,d]=l.useState(!1);y({timestamp:e.finishedAt,onTimeUp:()=>{t(!1),n(e.unlocked)}});const S=E=>{if(a)return P("warning","Phone is disabled (max attempts reached)");C.set(E)};return l.useEffect(()=>{var R,w,H;let E=e.unlocked&&p(e.finishedAt);n(E),t(!E&&k(e.finishedAt)),d(E?!1:e.attempts>=(((H=(w=(R=I.value)==null?void 0:R.Police)==null?void 0:w.PhoneUnlock)==null?void 0:H.Attempts)??1))},[e.unlocked,e.finishedAt]),N(x.div,{..._,className:"item","data-disabled":a,onClick:()=>S(e),children:[N("div",{className:"img",children:[i("img",{src:M(null,"profile")}),i(j,{})]}),N("div",{className:"info",children:[i("div",{className:"name",children:e.phoneName??f(e.phoneNumber)}),e.phoneName&&i("div",{className:"subtitle",children:f(e.phoneNumber)})]}),N("div",{className:"cards",style:{flexWrap:"inherit"},children:[(e==null?void 0:e.attempts)>0&&i("div",{className:L("card",e.attempts===(((c=(r=(o=I.value)==null?void 0:o.Police)==null?void 0:r.PhoneUnlock)==null?void 0:c.Attempts)??1)?"red":"orange"),children:s("APPS.POLICE.PHONE.UNLOCK.ATTEMPTS",{attempts:e.attempts.toString(),maxAttempts:(T=((U=(v=(O=I.value)==null?void 0:O.Police)==null?void 0:v.PhoneUnlock)==null?void 0:U.Attempts)??1)==null?void 0:T.toString()})}),i("div",{className:L("card",u?"green":m?"orange":"red"),children:u?s("APPS.POLICE.PHONE.UNLOCK.PROCESSED"):m?s("APPS.POLICE.PHONE.UNLOCK.PROCESSING"):s("APPS.POLICE.PHONE.UNLOCK.LOCKED")})]})]})},J=()=>{const e=g(C),[u,n]=l.useState(!1),[m,t]=l.useState(!1),{formattedTime:a}=y({timestamp:e==null?void 0:e.finishedAt,onTimeUp:()=>{n(!1),K.PopUp.set({title:e!=null&&e.unlocked?s("APPS.POLICE.PHONE.UNLOCK.SUCCESS.TITLE"):s("APPS.POLICE.PHONE.UNLOCK.FAILED.TITLE"),description:e!=null&&e.unlocked?s("APPS.POLICE.PHONE.UNLOCK.SUCCESS.DESCRIPTION"):s("APPS.POLICE.PHONE.UNLOCK.FAILED.DESCRIPTION"),buttons:[{title:s("APPS.POLICE.OK")}]})}});l.useEffect(()=>{k(e==null?void 0:e.finishedAt)&&n(!0)},[]);const d=()=>{if(e!=null&&e.unlocked)return P("warning","Phone is already unlocked");A("Police",{action:"unlockPhone",phoneNumber:e==null?void 0:e.phoneNumber},{timeRemaining:.25,unlocked:!1}).then(r=>{if(!(r!=null&&r.timeRemaining))return P("error","Failed to process phone");n(!0),C.patch({finishedAt:Date.now()+r.timeRemaining*60*1e3,unlocked:r.unlocked}),h.set(h.value.map(c=>c.phoneNumber===(e==null?void 0:e.phoneNumber)?{...c,unlocked:r.unlocked}:c))})},S=()=>{if(!(e!=null&&e.unlocked))return P("warning","Phone is not unlocked");m||A("Police",{action:"resetPin",phoneNumber:e==null?void 0:e.phoneNumber},!0).then(r=>{if(!r)return P("error","Failed to reset pin");t(!0),K.PopUp.set({title:s("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.TITLE"),description:s("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.SUCCESS"),buttons:[{title:s("APPS.POLICE.OK")}]})})},o=(e==null?void 0:e.unlocked)&&p(e==null?void 0:e.finishedAt);return N(x.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:[N("div",{className:"grid-header",children:[N("div",{className:"back",onClick:()=>C.reset(),children:[i(B,{})," ",s("APPS.POLICE.BACK")]}),i("div",{className:"title",children:(e==null?void 0:e.phoneName)??f(e==null?void 0:e.phoneNumber)}),i("div",{className:"buttons"})]}),i("div",{className:"unlock-body",children:i("div",{className:"unlocking",children:u?N(b,{children:[i("div",{className:"title",children:s("APPS.POLICE.PHONE.UNLOCK.PROCESSING_PHONE",{phone:(e==null?void 0:e.phoneName)??f(e==null?void 0:e.phoneNumber)})}),i("div",{className:"subtitle tabular",children:s("APPS.POLICE.PHONE.UNLOCK.REMAINING_TIME",{time:a})})]}):i("div",{className:"buttons column",children:o?N(b,{children:[i("div",{className:"title",children:s("APPS.POLICE.PHONE.UNLOCK.SUCCESS.TITLE")}),i("div",{className:"subtitle",children:s("APPS.POLICE.PHONE.UNLOCK.SUCCESS.DESCRIPTION")}),i("div",{className:L("button blue reset",m&&"disabled"),onClick:S,children:s("APPS.POLICE.PHONE.UNLOCK.RESET_PIN.TITLE")})]}):i("div",{className:L("button"),onClick:d,children:s("APPS.POLICE.PHONE.UNLOCK.PROCESS_PHONE")})})})})]})},k=e=>e===void 0?!1:e>Date.now(),p=e=>e===void 0?!1:e===0?!0:e<Date.now();export{C as SelectedPhoneUnlock,q as default};
