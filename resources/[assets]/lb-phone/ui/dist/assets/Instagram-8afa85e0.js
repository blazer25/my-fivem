import{K as Z,u as E,r as m,cp as At,cq as z,aW as St,t as g,aX as Re,a2 as J,C as _,L as r,j as i,a as e,a8 as Ie,bD as pt,Q as Ae,ca as k,cr as dt,c7 as mt,P as oe,d as ie,cs as Ye,b1 as It,F as y,m as Ee,b as Se,ct as Be,cu as ut,v as M,a6 as Q,a7 as re,cv as Et,U as Tt,p as Rt,ad as ke,O as Ct,H as me,bS as _e,V as Ot,A as Ve,N as ue,cw as ft,w as ae,f as vt,I as xe,z as ze,X as De,al as Te,ao as Lt,ap as Mt,aF as wt,S as Gt,cx as bt,x as _t,cy as kt,q as ct,aR as Dt,aU as yt,bN as Ut,cf as Ft,bV as Vt,cg as xt,ai as Ht,cz as Wt,ag as $t,ac as qt,b0 as Yt}from"./index-569b241b.js";import{S as Bt}from"./Switch-55d464d2.js";import{T as ht}from"./Textarea-61cff3f3.js";import{formatNumber as zt}from"./Tiktok-4f7a8be6.js";import"./Slider-81509870.js";const ne=Z({host:"",participants:[],viewers:0});function Kt(){var ge,Pe,Ne,Le;E(Se),E(O);const a=E($),t=E(ne),[c,l]=m.useState(!1),[u,f]=m.useState(!1),[s,v]=m.useState(null),[o,P]=m.useState(""),I=m.useRef(null),d=m.useRef(null),n=m.useRef(null),[h,A]=m.useState(null),[R,T]=m.useState(null),[U,S]=m.useState(null),[C,b]=m.useState([]),[p,D]=m.useState([]);m.useEffect(()=>{I.current.scrollTop=I.current.scrollHeight},[p]),m.useEffect(()=>{const N=new At;return A({peer:N,id:N.id}),z.info("Created peer"),()=>{try{N.destroy()}catch(w){z.error("Failed to destroy peer"),console.error(w)}}},[]),m.useEffect(()=>{if(!U||n!=null&&n.current||!h)return;z.info("Creating game render");const N=new St(U);n.current=N,N.resizeByAspect(3/4);const w=window.innerWidth;if(w>1280&&N.setQuality(1280/w),R||c){z.info("Host is true, creating call"),c?g("Instagram",{action:"setLive",username:a.username,verified:a.verified,id:h.id}):R&&g("Instagram",{action:"joinLive",username:R,streamId:h.id}).then(B=>{if(T(null),!B)return z.error("Failed to join live");f(!0)});const H=U.captureStream(24);h.peer.on("call",B=>{z.info("Answering call",B),B.answer(H)}),h.peer.calls.forEach(B=>{z.info("Setting stream for existing call",B),B.setStream(H)})}return()=>{n.current&&n.current.destroy(),h.peer.off("call"),n.current=null}},[U,h]);const Y=N=>{h!=null&&h.peer&&N.forEach(async w=>{if(w.username===a.username)return z.info("Skipping self");z.info("Adding participant",w);const H=await h.peer.call(w.id),B=H.getRemoteStream();B&&(z.info("Got remote stream immediately for",w),b(se=>[...se,{peerId:H.getTargetPeer(),stream:B,username:w.username}])),H.on("stream",se=>{z.info("Received remote stream for",w,se),b(Me=>{const we=Me.findIndex(ye=>ye.username===w.username),Oe=[...Me],Ge={peerId:H.getTargetPeer(),stream:se,username:w.username};return we!==-1?Oe[we]=Ge:Oe.push(Ge),Oe})})})},F=N=>{N.forEach(w=>{z.info("Removing participant",w),w.username===a.username&&(h.peer.calls.forEach(H=>{H.setStream()}),f(!1)),b(H=>H.filter(B=>B.username!==w.username))})};m.useEffect(()=>{const N=t.participants;if(!N||!h)return z.warn("No participants");z.info("Updating participants",N);const w=N.filter(B=>!C.find(se=>se.username===B.username));w.length>0&&Y(w);const H=C.filter(B=>!N.find(se=>se.username===B.username));H.length>0&&F(H)},[t.participants,h]),m.useEffect(()=>{const N=a.username===(t==null?void 0:t.host);return l(N),Re.ShouldClose.set(!1),N&&b(w=>[...w,{username:t.host}]),()=>{Re.ShouldClose.set(!0)}},[]);const x=()=>{var N;_.PopUp.set({title:c?r("APPS.INSTAGRAM.END_LIVE_POPUP.TITLE"):r("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:r("APPS.INSTAGRAM.END_LIVE_POPUP.DESCRIPTION").format({action:(N=c?r("APPS.INSTAGRAM.END_LIVE_POPUP.END"):r("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"))==null?void 0:N.toLowerCase()}),buttons:[{title:r("APPS.INSTAGRAM.END_LIVE_POPUP.CANCEL")},{title:c?r("APPS.INSTAGRAM.END_LIVE_POPUP.END"):r("APPS.INSTAGRAM.END_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{j(c)}}]})},K=()=>{g("Instagram",{action:"sendLiveMessage",data:{user:{username:a.username,avatar:a.avatar,verified:a.verified},live:t.host,content:o}}),P("")},j=(N,w)=>{if(c)g("Instagram",{action:"endLive"},!0).then(()=>O.set("feed"));else if(u&&g("Instagram",{action:"endLive"}).then(()=>O.set("feed")),g("Instagram",{action:"stopViewing",username:t.host}),N)Re.ShouldClose.set(!0),ne.patch({ended:!0});else{if(w===!1)return;O.set("feed")}};return J("instagram:addMessage",N=>{N.live===t.host&&D(w=>[...w,N])}),J("instagram:updateViewers",N=>{N.username===(t==null?void 0:t.host)&&ne.patch({viewers:N.viewers})}),J("instagram:setLive",N=>{ne.set(N)}),J("instagram:liveEnded",N=>{N===(t==null?void 0:t.host)&&j(!0)}),J("instagram:stopLive",()=>O.set("feed")),J("instagram:invitedLive",N=>{N===(t==null?void 0:t.host)&&_.PopUp.set({title:r("APPS.INSTAGRAM.INVITE_LIVE_POPUP.TITLE"),description:r("APPS.INSTAGRAM.INVITE_LIVE_POPUP.DESCRIPTION").format({username:N}),buttons:[{title:r("APPS.INSTAGRAM.INVITE_LIVE_POPUP.NO")},{title:r("APPS.INSTAGRAM.INVITE_LIVE_POPUP.YES"),cb:()=>{T(N),b(w=>[...w,{username:a.username}])}}]})}),J("instagram:joinedLive",N=>{N.host===(t==null?void 0:t.host)&&ne.patch({participants:[...t.participants,N]})}),J("instagram:leftLive",N=>{N.host===(t==null?void 0:t.host)&&(z.info("left live",N),ne.patch({participants:t.participants.filter(w=>w.username!==N.participant)}))}),i("div",{className:"instagram-live-container",children:[e("div",{className:"instagram-streams","data-streams":C.length.toString(),children:C.map((N,w)=>N.username===a.username?i("div",{className:"instagram-stream",children:[e("canvas",{ref:H=>S(H)}),!c&&e(Ie,{onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.TITLE"),description:r("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.LEAVE_LIVE_POPUP.LEAVE"),color:"red",cb:()=>{g("Instagram",{action:"endLive"}),f(!1)}}]})}})]},`stream-${N.username}`):e(Xt,{host:c,stream:N.stream,username:N.username},`stream-${N.username}`))}),t.ended&&i("div",{className:"instagram-stream-ended",children:[e(pt,{onClick:()=>O.set("feed")}),e("div",{className:"title",children:r("APPS.INSTAGRAM.LIVE_ENDED")})]}),e(Ae,{children:s&&e(Jt,{username:t.host,type:s,host:s==="participants"?c||u:c,endLive:j,close:()=>v(null)})}),i("div",{className:"instagram-live",children:[i("div",{className:"live-header",children:[i("div",{className:"profile",onClick:()=>{C.length>1?v("participants"):!c&&!u&&(j(),V(t.host))},children:[e("div",{className:"profile-picture",children:e(k,{className:"avatar",avatar:(Pe=(ge=t==null?void 0:t.participants)==null?void 0:ge[0])==null?void 0:Pe.avatar})}),i("div",{className:"name",children:[e(jt,{usernames:t.participants.map(N=>N.username)}),((Le=(Ne=t==null?void 0:t.participants)==null?void 0:Ne[0])==null?void 0:Le.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(dt,{})]})]}),i("div",{className:"stats",children:[e("div",{className:"live",children:r("APPS.INSTAGRAM.LIVE")}),i("div",{className:"viewers",onClick:()=>v("viewers"),children:[e(mt,{}),t.viewers]}),e(Ie,{className:"x",onClick:()=>{c||u?x():j(!1)}})]})]}),i("div",{className:"comment-section",children:[e("div",{className:"comment-feed",ref:I,children:p.map((N,w)=>{const H=N.user.avatar??`./assets/img/avatar-placeholder-${oe.Settings.value.display.theme}.svg`;return i("div",{className:"comment",children:[e(k,{avatar:H}),i("div",{className:"info",children:[i("div",{className:"name",children:[N.user.username,N.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"comment-text",children:N.content})]})]},w)})}),i("div",{className:"comment-input",children:[e(ie,{type:"text",ref:d,placeholder:r("APPS.INSTAGRAM.COMMENT_PLACEHOLDER"),onChange:N=>P(N.target.value),onKeyDown:N=>{N.key==="Enter"&&o.replace(/ /g,"").length>0&&(K(),d.current.value="")}}),e(Ye,{onClick:()=>{o.replace(/ /g,"").length>0&&(K(),d.current.value="")}}),(c||u)&&e(It,{onClick:()=>g("Instagram",{action:"flipCamera"})})]})]})]})]})}const Xt=a=>{const t=m.useRef(null);return m.useEffect(()=>{if(!(t!=null&&t.current))return z.warn("No video ref");t.current.srcObject=a.stream,t.current.play().catch(()=>z.error("Failed to play video stream"))},[a==null?void 0:a.stream]),i("div",{className:"instagram-stream",children:[a.host&&e(Ie,{onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:a.username}),description:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:a.username}),buttons:[{title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{g("Instagram",{action:"removeLive",username:a.username}).then(()=>{})}}]})}}),e("video",{autoPlay:!0,ref:t})]})},jt=a=>{let t=a.usernames.map((c,l)=>c).join(", ");return t.length>9&&(t=t.substring(0,9)+"..",t[t.length-3]===","&&(t=t.substring(0,t.length-3)+"..")),e(y,{children:t})},Jt=a=>{const[t,c]=m.useState([]);return m.useEffect(()=>{var l;if(a.type==="participants"){c((l=ne.value)==null?void 0:l.participants);return}g("Instagram",{action:"getLiveViewers",username:a.username}).then(u=>{u&&c(u)})},[]),i(Ee.div,{className:"story-modal","data-type":"live",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[i("div",{className:"story-modal-header",children:[e("div",{className:"close-border",onClick:()=>a.close()}),e("div",{className:"title",children:a.type==="viewers"?r("APPS.INSTAGRAM.WHOS_WATCHING"):r("APPS.INSTAGRAM.IN_THIS_ROOM")})]}),e("div",{className:"story-modal-content",children:e("div",{className:"viewers",children:t.map((l,u)=>e(Qt,{type:a.type,user:l,host:a.host,endLive:a.endLive},u))})})]})},Qt=({user:a,host:t,type:c,endLive:l})=>{var v;const u=(v=E(ne))==null?void 0:v.participants,[f,s]=m.useState(!1);return i("div",{className:"item",children:[i("div",{className:"user",onClick:()=>{t||(l(!1,!1),V(a.username))},children:[e("div",{className:"profile-picture",children:e(k,{className:"avatar",avatar:a.avatar})}),i("div",{className:"user-details",children:[i("div",{className:"username",children:[a.username,a.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:a.name})]})]}),t&&c==="viewers"&&(u.find(o=>o.username===a.username)?e("div",{className:"remove",onClick:o=>{o.stopPropagation(),_.PopUp.set({title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.TITLE").format({username:a.username}),description:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.DESCRIPTION").format({username:a.username}),buttons:[{title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.REMOVE_LIVE_POPUP.REMOVE"),color:"red",cb:()=>{g("Instagram",{action:"removeLive",username:a.username}).then(()=>{})}}]})},children:r("APPS.INSTAGRAM.REMOVE")}):e("div",{className:"invite",onClick:o=>{o.stopPropagation(),!f&&g("Instagram",{action:"inviteLive",username:a.username},()=>{s(!0)})},children:f?r("APPS.INSTAGRAM.INVITED"):r("APPS.INSTAGRAM.INVITE")}))]})};function gt(a){const t=E(oe.Settings);return e(y,{children:a.liked?e(Be,{onClick:a.onClick,color:"#ed4956"}):e(ut,{onClick:a.onClick,color:t.display.theme==="dark"?"#ffffff":"#262626"})})}function Pt(a){const t=E($),[c,l]=m.useState(a.data),[u,f]=m.useState(!1),s=m.useRef(null),[v,o]=m.useState(0),[P,I]=m.useState(!1),d=E(Ot),n=E(Ve),h={pos:{startLeft:0,startX:0},onMouseDown:S=>{me("Instagram")&&(h.pos={startLeft:s.current.scrollLeft,startX:S.clientX},s.current.style.userSelect="none",document.addEventListener("mouseup",h.onMouseUp),document.addEventListener("mousemove",h.onMove))},onMove:S=>{const C=(S.clientX-h.pos.startX)/_e();s.current.scrollLeft=h.pos.startLeft-C;const b=s.current.getBoundingClientRect();(b.left*_e()-5>S.clientX||S.clientX>b.right*_e()-5)&&h.onMouseUp()},onMouseUp:()=>{s.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",h.onMouseUp),document.removeEventListener("mousemove",h.onMove);const S=JSON.parse(c.media),C=s.current.clientWidth;let b=v;const p=s.current.scrollLeft-h.pos.startLeft;p>C/2&&b<S.length-1?b++:p<-C/2&&b>0&&b--,A(b)}},A=S=>{s.current.scrollTo({left:S*s.current.offsetWidth,behavior:"smooth"}),o(S)};J("instagram:updatePostData",S=>{if(!S||S.postId!==c.id)return M("warning","instagram:updatePostData","Post ID's do not match");l(C=>({...C,[S.data]:S.increment?C[S.data]+1:C[S.data]-1}))});const R=S=>{if(!u)return f(!0);if(S.detail===2){if(!c.id)return;c.liked||g("Instagram",{action:"toggleLike",data:{postId:c.id,toggle:!c.liked,isComment:!1}},!c.liked).then(C=>{l(b=>({...b,liked:C})),I(!0),setTimeout(()=>I(!1),1e3)})}},T=()=>{_.ContextMenu.set({buttons:[{title:r("APPS.INSTAGRAM.SHARE_TO_STORY.TITLE"),cb:()=>{var S;g("Instagram",{action:"addToStory",media:(S=JSON.parse(c.media))==null?void 0:S[v],metadata:{post:{id:c.id,username:c.username}}},Math.random().toString(36).substring(7)).then(C=>{if(!C)return M("error","Failed to add story");le.set([{username:t.username,avatar:t.avatar,verified:t.verified,seen:0,id:C},...le.value.filter(b=>b.username!==t.username)]),_.PopUp.set({title:r("APPS.INSTAGRAM.SHARE_TO_STORY.SUCCESS"),description:r("APPS.INSTAGRAM.SHARE_TO_STORY.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.OK")}]})})}}]})},U=()=>{V(c.username),c!=null&&c.viewPost&&ve.reset()};return i("div",{className:"post",id:a.last?"last":"","data-id":c.id,"data-active":a.active,children:[i("div",{className:"post-header",children:[e(k,{avatar:c.avatar,className:"profile-picture",onClick:U}),i("div",{className:"post-info",children:[i("div",{className:"name",onClick:U,children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),c.location&&e("div",{className:"location",children:c.location})]})]}),i("div",{className:"post-body",children:[P&&e("div",{className:"popup-heart","data-visible":P,children:e(Be,{})}),e("div",{className:"image-container",ref:s,onMouseDown:h.onMouseDown,children:JSON.parse(c.media).map((S,C)=>{var b;return e("div",{className:"image",onClick:R,children:Q(S)?e(Zt,{attachment:S,active:a.active&&!(d!=null&&d.visible)&&((b=n==null?void 0:n.active)==null?void 0:b.name)==="Instagram"}):e(re,{src:S,blur:!u&&(c==null?void 0:c.username)!==(t==null?void 0:t.username)})},C)})}),i("div",{className:"actions",children:[i("div",{className:"like-comment",children:[e(gt,{liked:c.liked,onClick:()=>{c.id&&g("Instagram",{action:"toggleLike",data:{postId:c.id,toggle:!c.liked,isComment:!1}},!c.liked).then(S=>{l(C=>({...C,liked:S}))})}}),e(Et,{onClick:()=>qe({id:c.id,username:c.username,avatar:c.avatar,verified:c.verified,caption:c.caption,timestamp:c.timestamp})}),(c.username===t.username||t.isAdmin)&&e(Tt,{onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.DELETE_POST_POPUP.TITLE"),description:r("APPS.INSTAGRAM.DELETE_POST_POPUP.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.DELETE_POST_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.DELETE_POST_POPUP.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"deletePost",id:c.id},!0).then(S=>{if(!S)return M("error","Instagram","Failed to delete post");O.set("feed")})}}]})}})]}),JSON.parse(c.media).length>1&&e("div",{className:"scroll-dots",children:JSON.parse(c.media).map((S,C)=>e("div",{className:`dot ${v==C?"active":""}`,onClick:()=>A(C)},C))}),e("div",{className:"like-comment",children:e(Rt,{onClick:T})})]}),i("div",{className:"liked-by",onClick:()=>{he.set({title:r("APPS.INSTAGRAM.LIKED_BY"),postId:c.id})},children:[c.like_count," ",r("APPS.INSTAGRAM.LIKES")]}),i("div",{className:"caption",children:[e("span",{className:"user",onClick:S=>{S.stopPropagation(),V(c.username)},children:c.username}),ke(c.caption)]}),e("div",{className:"comments",onClick:S=>{S.stopPropagation(),qe({id:c.id,username:c.username,avatar:c.avatar,verified:c.verified,caption:c.caption,timestamp:c.timestamp})},children:c.comment_count>0?r("APPS.INSTAGRAM.VIEW_ALL_COMMENTS").format({count:c.comment_count}):r("APPS.INSTAGRAM.FIRST_COMMENT")}),e("div",{className:"date",children:Ct(c.timestamp)})]})]})}const Zt=a=>{var f;const[t,c]=m.useState(a.active),l=E(oe.Settings),u=m.useRef(null);return m.useEffect(()=>{var s,v,o,P;c(a.active),!(!u.current||((s=l==null?void 0:l.sound)==null?void 0:s.volume)===void 0)&&a.active&&(u.current.volume=((v=l==null?void 0:l.sound)==null?void 0:v.volume)!==void 0?l.sound.volume:.5,u.current.currentTime=0,a.active?(o=u.current)==null||o.play().catch(I=>{}):(P=u.current)==null||P.pause().catch(I=>{}))},[a.active]),m.useEffect(()=>{var s,v;!u.current||((s=l==null?void 0:l.sound)==null?void 0:s.volume)===void 0||a.active&&(u.current.volume=((v=l==null?void 0:l.sound)==null?void 0:v.volume)!==void 0?l.sound.volume:.5)},[(f=l==null?void 0:l.sound)==null?void 0:f.volume]),e("video",{ref:u,src:a.attachment,autoPlay:!0,loop:!0,muted:!a.active,onLoadedMetadata:s=>{var v;a.active&&(s.currentTarget.volume=((v=l==null?void 0:l.sound)==null?void 0:v.volume)!==void 0?l.sound.volume:.5)}})},q={account:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0},accounts:{lb:{username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,verified:!0,following:2,followers:13,posts:2,followingList:["loaf","breze"],followerList:["loaf","breze"]},breze:{username:"breze",name:"Breze",bio:`Hey, its breze 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","loaf"],followerList:["lb","loaf"]},loaf:{username:"loaf",name:"Loaf Scripts",bio:`Loaf Scritps official account 
https://lbphone.com`,verified:!0,following:2,followers:1,posts:2,followingList:["lb","breze"],followerList:["lb","breze"]}},posts:[{id:"1",username:"breze",name:"Breze",verified:!0,caption:"sunsets are the best",media:'["https://r2.fivemanage.com/images/GRBUI6C4orbD.webp", "https://r2.fivemanage.com/images/rafgjPwSYnn2.png"]',location:"Sandy Shores",like_count:2,comment_count:0,timestamp:Date.now()-1e3*60*60*24*1},{id:"2",username:"lb",name:"LB",verified:!0,caption:"dump",media:'["https://r2.fivemanage.com/images/upTPndukc2PD.webp", "https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp"]',location:"Los Santos",like_count:8,comment_count:2,timestamp:Date.now()-1e3*60*60*24*2}],stories:[{id:"1",username:"lb",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,seen:0,media:[{id:"2",image:"https://r2.fivemanage.com/images/oRKcdeTA8oBy.png",timestamp:Date.now()-1e3*60*60*4,seen:!1,views:2,viewers:[{username:"Breze"},{username:"Loaf"}]}]},{id:"2",username:"breze",verified:!0,seen:0,media:[{id:"1",metadata:{post:{id:132,src:"https://townsquare.media/site/812/files/2024/03/attachment-future-metro-boomin-we-dont-trust-you-photo.jpg?w=1080&q=75",username:"tordinationen"}},timestamp:Date.now()-1e3*60*60*2,seen:!1},{id:"2",image:"https://r2.fivemanage.com/images/ZsmnyJOA2rc5.png",timestamp:Date.now()-1e3*60*60*3,seen:!1},{id:"3",image:"https://r2.fivemanage.com/video/REZeHruJivNL.mp4",timestamp:Date.now()-1e3*60*60*4,seen:!1}]},{id:"3",username:"loaf",verified:!0,seen:1,media:[{id:"1",image:"https://r2.fivemanage.com/images/X4pfDFiSFvhi.webp",timestamp:Date.now()-1e3*60*60*3,seen:!0},{id:"2",image:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*4,seen:!0}]}],comments:[{postId:"2",user:{username:"breze",verified:!0},comment:{id:"1",content:"nice",timestamp:Date.now()-1e3*60*60*24,likes:0}},{postId:"2",user:{username:"loaf",verified:!0},comment:{id:"2",content:"haha, nice picture",timestamp:Date.now()-1e3*60*60*22,likes:1,liked:!0}}],messages:[{id:"1",username:"breze",name:"Breze",verified:!0,content:"hey",messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,content:"yoo, your last post was fire",messages:[{id:"3",sender:"loaf",content:"yoo, your last post was fire",timestamp:Date.now()-1e3*60*60*8}],timestamp:Date.now()-1e3*60*60*8}],notifications:[{type:"like_photo",username:"loaf",name:"Loaf Scripts",postId:"1",photo:"https://r2.fivemanage.com/images/upTPndukc2PD.webp",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function ea(){const a=E(O),t=E($),c=E(le),[l,u]=m.useState([]),[f,s]=m.useState([]),[v,o]=m.useState(null);m.useEffect(()=>{me("Instagram")&&g("Instagram",{action:"getPosts",filters:{following:!0},page:0},q.posts).then(n=>{if(!n)return M("error","Failed to fetch posts");u(n)})},[]),m.useEffect(()=>{me("Instagram")&&a==="feed"&&(g("Instagram",{action:"getLives"}).then(n=>{n&&s(n)}),g("Instagram",{action:"getStories"},q.stories).then(n=>{if(!n)return M("warning","Failed to fetch stories");le.set([...n.sort((h,A)=>{if(h.seen===A.seen)return 0;if(h.seen===1)return 1;if(A.seen===1)return-1})])}))},[a]),new IntersectionObserver(P,{rootMargin:"20px",threshold:.5});function P(n){n.forEach(h=>{if(h.isIntersecting){let R=h.target.getAttribute("data-id");o(R)}})}const{handleScroll:I}=ue({fetchData:n=>g("Instagram",{action:"getPosts",filters:{following:!0},page:n}),onDataFetched:n=>u([...l,...n]),perPage:25});m.useEffect(()=>{const n=document.querySelector(".stories");return n==null||n.addEventListener("wheel",h=>{h.preventDefault(),n.scrollLeft+=h.deltaY}),()=>{n==null||n.removeEventListener("wheel",h=>{h.preventDefault(),n.scrollLeft+=h.deltaY})}},[]),J("instagram:updateLives",n=>{n&&s(n)});const d=()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.GO_LIVE_POPUP.TITLE"),description:r("APPS.INSTAGRAM.GO_LIVE_POPUP.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.GO_LIVE_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.GO_LIVE_POPUP.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"goLive",user:{username:t.username,avatar:t==null?void 0:t.avatar,verified:t.verified}},!0).then(n=>{if(!n)return M("error","Failed to go live");ne.set({host:t.username,participants:[{username:t.username,name:t.username,avatar:t==null?void 0:t.avatar,verified:t.verified}],viewers:0}),O.set("live")})}}]})};return i(y,{children:[i("div",{className:"instagram-header feed-header",children:[i("div",{className:"name",children:[t==null?void 0:t.username,(t==null?void 0:t.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e(Ye,{onClick:()=>O.set("dmList")})]}),i("div",{className:"feed",onScroll:I,children:[e("div",{className:"stories-wrapper",children:i("div",{className:"stories",children:[i("div",{className:"story self",onClick:()=>{_.ContextMenu.set({buttons:[{title:r("APPS.INSTAGRAM.GO_LIVE"),cb:()=>d()},{title:r("APPS.INSTAGRAM.CREATE_STORY"),cb:()=>{var n,h,A;_.Gallery.set({includeVideos:!0,allowExternal:(A=(h=(n=Se)==null?void 0:n.value)==null?void 0:h.AllowExternal)==null?void 0:A.InstaPic,onSelect:R=>{let T=Array.isArray(R)?R[0].src:R.src;g("Instagram",{action:"addToStory",media:T},Math.random().toString(36).substring(7)).then(U=>{if(!U)return M("error","Failed to add story");le.set([{username:t.username,avatar:t.avatar,verified:t.verified,seen:0,id:U},...c.filter(S=>S.username!==t.username)])})}})}}]})},children:[i("div",{className:"profile-picture",children:[e(k,{className:"avatar",avatar:t==null?void 0:t.avatar}),e("div",{className:"plus",children:e("i",{className:"far fa-plus"})})]}),e("div",{className:"name",children:r("APPS.INSTAGRAM.YOUR_STORY")})]}),Object.keys(f).map(n=>{var h;return i("div",{className:"story",onClick:()=>{var A;g("Instagram",{action:"viewLive",username:((A=f[n])==null?void 0:A.participant)??n}).then(R=>{var S,C,b,p;if(!R)return M("error","Failed to view live, perhaps it ended?");let T=(S=f[n])!=null&&S.participant?f[(C=f[n])==null?void 0:C.participant]:f[n],U=(T==null?void 0:T.participants)??[];U.unshift({username:((b=f[n])==null?void 0:b.participant)??n,name:T.name,avatar:T.avatar,verified:T.verified,id:T.id}),ne.set({host:((p=f[n])==null?void 0:p.participant)??n,participants:U,viewers:R}),O.set("live")})},children:[i("div",{className:"profile-picture",children:[e(k,{className:"avatar",avatar:(h=f[n])==null?void 0:h.avatar}),e("img",{className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"})]}),e("div",{className:"name",children:n})]},n)}),c==null?void 0:c.map(n=>i("div",{className:"story",onClick:h=>{let[A,R]=ft(h);Fe(n,null,{x:A,y:R})},children:[i("div",{className:"profile-picture",children:[e(k,{className:"avatar",avatar:n.avatar}),e("img",{className:"circle","data-seen":n.seen===1,src:"./assets/img/icons/instagram/StoryCircle.svg"})]}),e("div",{className:"name",children:n.username})]},n.username))]})}),(l==null?void 0:l.length)===0&&e("div",{className:"no-posts",children:r("APPS.INSTAGRAM.EMPTY_FEED")}),l==null?void 0:l.map(n=>e(Pt,{data:n,active:v===n.id},n.id))]})]})}function lt(){const a=E(oe.Settings),[t,c]=m.useState(""),[l,u]=m.useState(""),[f,s]=m.useState(""),[v,o]=m.useState("login"),P=()=>{g("Instagram",{action:"logIn",username:l,password:f},{success:!!q.accounts[l],account:q.accounts[l]}).then(d=>{if(d.success&&d.account)g("isAdmin",null,!1).then(n=>{ae.APPS.INSTAGRAM.account.set(d.account),$.set({...d.account,isAdmin:n}),O.set("feed"),de.set(!0)});else{if(d.error)return _.PopUp.set({title:r("APPS.INSTAGRAM.ERROR"),description:r(`APPS.INSTAGRAM.${d.error}`),buttons:[{title:r("APPS.INSTAGRAM.OK")}]});M("error","Instagram LogIn Error",d.error)}})},I=()=>{let d=l==null?void 0:l.toLowerCase().replace(/\s/g,""),n=d.match(Se.value.UsernameFilter);if(!n||(n==null?void 0:n[0])!==d||d.length<3||d.length>15){M("warning","Username did not match regex"),_.PopUp.set({title:r("APPS.INSTAGRAM.ERROR"),description:r("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:r("APPS.INSTAGRAM.OK")}]});return}g("Instagram",{action:"createAccount",name:t,username:d,password:f},{success:!q.accounts[d]}).then(h=>{if(h.success)g("isAdmin").then(A=>{let R={name:t,username:d,posts:0,followers:0,following:0};ae.APPS.INSTAGRAM.account.set(R),$.set({...R,isAdmin:A}),O.set("feed"),de.set(!0)});else{if(h.error)return _.PopUp.set({title:r("APPS.INSTAGRAM.ERROR"),description:r(`APPS.INSTAGRAM.${h.error}`),buttons:[{title:r("APPS.INSTAGRAM.OK")}]});M("error","couldn't create account",h)}})};return m.useEffect(()=>{c(""),u(""),s("")},[v]),e("div",{className:"log-in",children:i(y,{children:[e("div",{className:"wrapper",children:v==="login"?i(y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":a.display.theme}),i("div",{className:"form",children:[e(ie,{placeholder:r("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:d=>u(d.target.value.replace(/\s/g,"")),maxLength:15},1),e(ie,{placeholder:r("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:d=>s(d.target.value),maxLength:50},3),e("div",{className:"button",onClick:P,children:r("APPS.INSTAGRAM.LOG_IN")})]})]}):i(y,{children:[e("img",{src:"./assets/img/icons/instagram/logo.png","data-theme":a.display.theme}),i("div",{className:"form",children:[e(ie,{placeholder:r("APPS.INSTAGRAM.NAME_PLACEHOLDER"),type:"text",onChange:d=>c(d.target.value),maxLength:20},2),e(ie,{placeholder:r("APPS.INSTAGRAM.USERNAME_PLACEHOLDER"),type:"text",className:"username",onChange:d=>u(d.target.value.replace(/\s/g,"")),maxLength:15},4),e(ie,{placeholder:r("APPS.INSTAGRAM.PASSWORD_PLACEHOLDER"),type:"password",onChange:d=>s(d.target.value),maxLength:50}),e("div",{className:"button",onClick:I,children:r("APPS.INSTAGRAM.CREATE_ACCOUNT")})]})]})}),e("div",{className:"footer",children:v==="login"?i(y,{children:[r("APPS.INSTAGRAM.NOT_HAVE_ACCOUNT")," ",e("span",{onClick:()=>o("createAccount"),children:r("APPS.INSTAGRAM.CREATE_ACCOUNT")})]}):i(y,{children:[r("APPS.INSTAGRAM.HAVE_ACCOUNT")," ",e("span",{onClick:()=>o("login"),children:r("APPS.INSTAGRAM.LOG_IN")})]})})]})})}const We=Z(!1);function ta(){var f,s,v,o,P;const a=E(Ve),[t,c]=m.useState(null),l=E(We);m.useEffect(()=>{me("Instagram")&&g("Instagram",{action:"getNotifications"},q.notifications).then(I=>{if(!I)return M("warning","Failed to fetch notifications, or no results?");c(I)})},[a==null?void 0:a.active]);const{handleScroll:u}=ue({fetchData:I=>g("Instagram",{action:"getNotifications",page:I}),onDataFetched:I=>{I.length>0&&c(d=>({notifications:[...d.notifications,...I[0].notifications]}))},perPage:25});return i("div",{className:"notifications-container",children:[e(Ae,{children:l&&e(aa,{})}),e("div",{className:"notifications-header",children:r("APPS.INSTAGRAM.ACTIVITY")}),i("div",{className:"notifications-body",onScroll:u,children:[((f=t==null?void 0:t.requests)==null?void 0:f.total)>0&&i("div",{className:"follow-requests",onClick:()=>We.set(!0),children:[i("div",{className:"item-data",children:[e("div",{className:"profile-pictures","data-multiple":t.requests.total>1,children:t.requests.recent.map((I,d)=>e(k,{avatar:I.avatar},d))}),i("div",{className:"item-body",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("div",{className:"subtitle",children:t.requests.total>1?r("APPS.INSTAGRAM.ANDOTHERS").format({username:(s=t.requests.recent[0])==null?void 0:s.username,amount:((v=t.requests)==null?void 0:v.total)-1}):(o=t.requests.recent[0])==null?void 0:o.username})]})]}),i("div",{className:"actions",children:[e("div",{className:"blue-dot"}),e(vt,{})]})]}),(P=t==null?void 0:t.notifications)==null?void 0:P.map((I,d)=>{let n=d===t.notifications.length-1?"last":"";return e(sa,{notification:I,last:n},d)})]})]})}const aa=()=>{const[a,t]=m.useState(""),[c,l]=m.useState([]),u=[{class:"follow",label:r("APPS.INSTAGRAM.CONFIRM"),action:!0},{class:"following",label:r("APPS.INSTAGRAM.DELETE"),action:!1}];m.useEffect(()=>{g("Instagram",{action:"getFollowRequests",page:0},[]).then(s=>{if(!s)return M("warning","Failed to fetch follow requests");M("info","Fetched follow requests",s),l(s)})},[]);const{handleScroll:f}=ue({fetchData:s=>g("Instagram",{action:"getFollowRequests",page:s}),onDataFetched:s=>l(s),perPage:15});return i(Ee.div,{initial:{opacity:.5,x:150},animate:{opacity:1,x:0},exit:{opacity:.5,x:150},transition:{duration:.2,ease:"easeInOut"},className:"requests-container",children:[i("div",{className:"requests-header",children:[e("div",{className:"icon",children:e(xe,{onClick:()=>We.set(!1)})}),e("div",{className:"title",children:r("APPS.INSTAGRAM.FOLLOW_REQUESTS")}),e("span",{})]}),i("div",{className:"requests-body",children:[e(ze,{placeholder:r("SEARCH"),onChange:s=>t(s.target.value)}),e("div",{className:"items",onScroll:f,children:c.filter(s=>{var v,o;return((v=s.username)==null?void 0:v.toLowerCase().includes(a==null?void 0:a.toLowerCase()))||((o=s.name)==null?void 0:o.toLowerCase().includes(a==null?void 0:a.toLowerCase()))}).map((s,v)=>i("div",{className:"item",children:[i("div",{className:"user",onClick:()=>V(s.username),children:[e(k,{className:"avatar",avatar:s.avatar}),i("div",{className:"user-info",children:[i("div",{className:"username",children:[s.username,s.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:s.name})]})]}),e("div",{className:"buttons",children:u.map((o,P)=>e("div",{className:De("button",o.class),onClick:I=>{I.stopPropagation(),g("Instagram",{action:"handleFollowRequest",username:s.username,accept:o.action},!0).then(d=>{if(!d)return M("warning","Failed to handle follow request");l(n=>n.filter(h=>h.username!==s.username))})},children:o.label},P))})]},v))})]})]})},sa=({notification:a,last:t})=>{const c=E($),[l,u]=m.useState(a.isFollowing);switch(a.type){case"like_photo":return i("div",{className:"notification-item",id:t,onClick:()=>Ue(a.postId),children:[i("div",{className:"notification-body",children:[e(k,{className:"avatar",avatar:a.avatar,onClick:s=>{s.stopPropagation(),V(a.username)}}),i("div",{className:"content",children:[e("span",{children:a.username})," ",r("APPS.INSTAGRAM.LIKED_PHOTO"),e("span",{className:"date",children:Te(a.timestamp)})]})]}),Q(a.photo)?e("video",{className:"post-preview",src:a.photo,muted:!0,controls:!1}):e(re,{className:"post-preview",src:a.photo})]});case"like_comment":return e("div",{className:"notification-item",id:t,onClick:()=>Ue(a.postId,!0),children:i("div",{className:"notification-body",children:[e(k,{className:"avatar",avatar:a.avatar,onClick:s=>{s.stopPropagation(),V(a.username)}}),i("div",{className:"content",children:[e("span",{children:a.username})," ",r("APPS.INSTAGRAM.LIKED_COMMENT").format({comment:a.comment}),e("span",{className:"date",children:Te(a.timestamp)})]})]})});case"comment":return i("div",{className:"notification-item",id:t,onClick:()=>Ue(a.postId,!0),children:[i("div",{className:"notification-body",children:[e(k,{className:"avatar",avatar:a.avatar,onClick:s=>{s.stopPropagation(),V(a.username)}}),i("div",{className:"content",children:[e("span",{children:a.username})," ",r("APPS.INSTAGRAM.COMMENTED").format({comment:a.comment}),e("span",{className:"date",children:Te(a.timestamp)})]})]}),Q(a.photo)?e("video",{className:"post-preview",src:a.photo,muted:!0,controls:!1}):e("img",{className:"post-preview",src:a.photo})]});case"follow":return i("div",{className:"notification-item",id:t,onClick:()=>V(a.username),children:[i("div",{className:"notification-body",children:[e(k,{className:"avatar",avatar:a.avatar,onClick:s=>{s.stopPropagation(),V(a.username)}}),i("div",{className:"content",children:[e("span",{children:a.username})," ",r("APPS.INSTAGRAM.FOLLOWED"),e("span",{className:"date",children:Te(a.timestamp)})]})]}),e("div",{className:De("button",l?"following":"follow"),onClick:s=>{s.stopPropagation(),c.username!==a.username&&(l?_.PopUp.set({title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:a.username}),buttons:[{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"toggleFollow",data:{username:a.username,following:!l}},!0).then(()=>{u(v=>!v)})}}]}):g("Instagram",{action:"toggleFollow",data:{username:a.username,following:!l}},!0).then(()=>{u(v=>!v)}))},children:l?r("APPS.INSTAGRAM.FOLLOWING"):r("APPS.INSTAGRAM.FOLLOW")})]})}};function na(){var R,T,U,S,C,b;const a=E($),t=E(ce);E(O);const c=E(ee),l=m.useRef(null),u=m.useRef(null),[f,s]=m.useState(!1),[v,o]=m.useState(!1),[P,I]=m.useState(null);m.useEffect(()=>{me("Instagram")&&t.username&&(s(a.username===t.username),g("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:0}).then(p=>{p&&I(p)}))},[t==null?void 0:t.username]);const{handleScroll:d}=ue({fetchData:p=>g("Instagram",{action:"getPosts",filters:{profile:!0,username:t.username},page:p}),onDataFetched:p=>I([...P,...p]),perPage:15}),n=()=>{if(!t.name)return M("warning","Name is required, not saving");g("Instagram",{action:"updateProfile",data:{name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}},!0).then(p=>{if(!p)return M("warning","Failed to update profile");ae.APPS.INSTAGRAM.account.set({...a,name:t.name,bio:t.bio,avatar:t.avatar,private:t.private}),o(!1),M("info","Successfully updated profile")})};J("instagram:updateProfileData",p=>{p.username===t.username&&ce.set({...t,[p.data]:p.increment?t[p.data]+1:t[p.data]-1})});const h=m.useRef(!0);m.useEffect(()=>{if(h.current){h.current=!1;return}g("Instagram",{action:"toggleFollow",data:{username:t.username,following:t.isFollowing}},!0)},[t.isFollowing]);const A=()=>{g("AccountSwitcher",{action:"getAccounts",app:"Instagram"}).then(p=>{var F;if(!p)return M("info","No accounts found");let D=a.isAdmin,Y=(F=p==null?void 0:p.filter(x=>x!==t.username))==null?void 0:F.map(x=>({title:x,cb:()=>{g("AccountSwitcher",{action:"switch",app:"Instagram",account:x}).then(K=>{g("Instagram",{action:"isLoggedIn"}).then(j=>{j?(ae.APPS.INSTAGRAM.account.set(j),$.set({...j,isAdmin:D}),O.set("feed"),de.set(!0)):ae.APPS.INSTAGRAM.account.set(null)})})}}));_.ContextMenu.set({buttons:[{title:a.username},...Y,{title:r("APPS.INSTAGRAM.ADD_ACCOUNT"),cb:()=>de.set(!1)}]})})};return m.useEffect(()=>{if(!(l!=null&&l.current)||!(u!=null&&u.current))return;const p=33,D=29.5,F=(l.current.offsetHeight-p)/16,x=Math.max(D-F,0);u.current.style.maxHeight=`${x}rem`},[u==null?void 0:u.current,t.bio]),e(y,{children:t&&i("div",{className:"profile",children:[e(Ae,{children:v&&i(Ee.div,{className:"edit-profile",initial:{y:750,opacity:.75},animate:{y:0,opacity:1},exit:{y:750,opacity:.75},transition:{duration:.3,ease:"easeInOut"},children:[i("div",{className:"edit-profile-header",children:[e("div",{className:"cancel",onClick:()=>o(!1),children:r("CANCEL")}),e("div",{className:"title",children:r("APPS.INSTAGRAM.EDIT_PROFILE")}),e("div",{className:"save",onClick:()=>n(),children:r("APPS.INSTAGRAM.DONE")})]}),i("div",{className:"edit-profile-body",children:[i("div",{className:"profile-picture",onClick:()=>{var p,D,Y;_.Gallery.set({allowExternal:(Y=(D=(p=Se)==null?void 0:p.value)==null?void 0:D.AllowExternal)==null?void 0:Y.InstaPic,onSelect:F=>{let x=Array.isArray(F)?F[0].src:F.src;ce.set({...t,avatar:x}),$.set({...a,avatar:x})}})},children:[e(k,{avatar:t.avatar}),e("span",{children:r("APPS.INSTAGRAM.CHANGE_PICTURE")})]}),i("div",{className:"profile-items",children:[i("div",{className:"item",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.NAME")}),e(ie,{placeholder:r("APPS.INSTAGRAM.NAME_PLACEHOLDER"),onChange:p=>{ce.set({...t,name:p.target.value})},maxLength:30,defaultValue:t.name})]}),i("div",{className:"item",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.BIO")}),e(ht,{placeholder:r("APPS.INSTAGRAM.BIO"),onChange:p=>{ce.set({...t,bio:p.target.value})},maxLength:100,defaultValue:t.bio??""})]}),i("div",{className:"item",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.PRIVATE")}),e("div",{className:"switch-wrapper",children:e(Bt,{checked:t.private,onChange:()=>ce.set({...t,private:!t.private})})})]})]}),i("div",{className:"buttons",children:[e("div",{className:"button blue",onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:r("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"signOut"},!0).then(p=>{if(!p)return M("error","Failed to sign out");de.set(null),$.set(null),ae.APPS.INSTAGRAM.account.set(null)})}}]})},children:r("APPS.INSTAGRAM.SIGN_OUT")}),((U=(T=(R=Se)==null?void 0:R.value)==null?void 0:T.ChangePassword)==null?void 0:U.InstaPic)&&e("div",{className:"button red",onClick:()=>Lt("Instagram",()=>{}),children:r("APPS.INSTAGRAM.CHANGE_PASSWORD")}),((b=(C=(S=Se)==null?void 0:S.value)==null?void 0:C.DeleteAccount)==null?void 0:b.InstaPic)&&e("div",{className:"button red",onClick:()=>{Mt("Instagram",()=>{de.set(null),$.set(null),ae.APPS.INSTAGRAM.account.set(null)})},children:r("APPS.INSTAGRAM.DELETE_ACCOUNT")})]})]})]})}),f?e("div",{className:"instagram-header",children:i("div",{className:"name",style:{cursor:"pointer"},onClick:()=>A(),children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})}),e(dt,{})]})}):i("div",{className:"profile-header",children:[e("i",{className:"fas fa-chevron-left",onClick:()=>{c!=null&&c.cb?c.cb():O.set("feed")}}),i("div",{className:"name",children:[t.username??"Unknown",t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("span",{})]}),i("div",{className:"profile-body",children:[i("div",{className:"profile-wrapper",children:[i("div",{className:"top",children:[i("div",{className:"profile-picture",children:[e(k,{avatar:t.avatar,className:"avatar"}),t.isLive&&(!t.private||t.isFollowing||!f)?e("img",{onClick:()=>{g("Instagram",{action:"getLives"}).then(p=>{var Y;let D=t.username;g("Instagram",{action:"viewLive",username:((Y=p[D])==null?void 0:Y.participant)??D}).then(F=>{var j,ge,Pe,Ne;if(!F)return M("error","Failed to view live, perhaps it ended?");let x=(j=p[D])!=null&&j.participant?p[(ge=p[D])==null?void 0:ge.participant]:p[D],K=(x==null?void 0:x.participants)??[];K.unshift({username:((Pe=p[D])==null?void 0:Pe.participant)??D,name:x.name,avatar:x.avatar,verified:x.verified,id:x.id}),ne.set({host:((Ne=p[D])==null?void 0:Ne.participant)??D,participants:K,viewers:F}),O.set("live")})})},className:"circle live",src:"./assets/img/icons/instagram/LiveCircle.svg"}):null,t.hasStory&&!t.isLive&&(!t.private||t.isFollowing||f)?e("img",{className:"circle","data-seen":t.seenStory===1,src:"./assets/img/icons/instagram/StoryCircle.svg",onClick:p=>{let[D,Y]=ft(p);Fe({username:t.username,avatar:t.avatar,verified:t.verified},null,{x:D,y:Y})}}):null]}),i("div",{className:"stats",children:[i("div",{children:[e("div",{className:"value",children:t.posts}),e("div",{className:"label",children:t.posts===1?r("APPS.INSTAGRAM.POST"):r("APPS.INSTAGRAM.POSTS")})]}),i("div",{"data-disabled":!t.isFollowing&&t.private&&!f,onClick:()=>{!t.isFollowing&&t.private&&!f||he.set({title:r("APPS.INSTAGRAM.FOLLOWERS"),username:t.username})},children:[e("div",{className:"value",children:t.followers}),e("div",{className:"label",children:t.followers===1?r("APPS.INSTAGRAM.FOLLOWER"):r("APPS.INSTAGRAM.FOLLOWERS")})]}),i("div",{"data-disabled":!t.isFollowing&&t.private&&!f,onClick:()=>{!t.isFollowing&&t.private&&!f||he.set({title:r("APPS.INSTAGRAM.FOLLOWING"),username:t.username})},children:[e("div",{className:"value",children:t.following}),e("div",{className:"label",children:r("APPS.INSTAGRAM.FOLLOWING")})]})]})]}),e("div",{className:"name",children:t.name}),e("div",{className:"description",ref:l,children:ke(t.bio)??""}),e("div",{className:"buttons",children:f?f&&e("div",{className:"button edit",onClick:()=>o(!0),children:r("APPS.INSTAGRAM.EDIT_PROFILE")}):i(y,{children:[e("div",{className:De("button",t.requested||t.isFollowing?"following":"follow"),onClick:()=>{t.isFollowing?_.PopUp.set({title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.username}),buttons:[{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{ce.set({...t,isFollowing:!1})}}]}):t.private?g("Instagram",{action:"toggleFollow",data:{username:t.username,following:!0}},!0).then(p=>{if(!p)return M("error","Failed to follow");ce.set({...t,requested:!t.requested})}):ce.set({...t,isFollowing:!0})},children:t.isFollowing?r("APPS.INSTAGRAM.FOLLOWING"):t.requested?r("APPS.INSTAGRAM.REQUESTED"):r("APPS.INSTAGRAM.FOLLOW")}),!t.private||t.isFollowing?e("div",{className:"button following",onClick:()=>{pe.set({username:t.username,name:t.name,verified:t.verified,avatar:t.avatar}),O.set("dm")},children:r("APPS.INSTAGRAM.MESSAGE")}):null]})})]}),t.private&&!t.isFollowing&&!f?i("div",{className:"private-account",children:[e("div",{className:"icon",children:e(wt,{})}),e("div",{className:"title",children:r("APPS.INSTAGRAM.PRIVATE_ACCOUNT")}),e("div",{className:"description",children:r("APPS.INSTAGRAM.PRIVATE_ACCOUNT_DESCRIPTION")})]}):e("div",{className:"posts",ref:u,onScroll:d,children:P&&P.map((p,D)=>{let Y=JSON.parse(p.media)[0];return e("div",{onClick:()=>ve.set(p),children:Q(Y)?e("video",{src:Y,muted:!0,autoPlay:!0,loop:!0}):e(re,{src:Y,blur:t.username!==a.username})},D)})})]})]})})}function ia(){const[a,t]=m.useState(""),[c,l]=m.useState(""),[u,f]=m.useState([]),[s,v]=m.useState([]);m.useEffect(()=>{me("Instagram")&&g("Instagram",{action:"getPosts",page:0},q.posts).then(P=>{if(!P)return M("warning","No posts received in getPosts");v(P)})},[]),m.useEffect(()=>{const P=setTimeout(()=>t(c),500);return()=>clearTimeout(P)},[c]),m.useEffect(()=>{a.length>0&&g("Instagram",{action:"search",query:a},Object.keys(q.accounts).map(P=>q.accounts[P])).then(P=>{P&&f(P)})},[a]);const{handleScroll:o}=ue({fetchData:P=>g("Instagram",{action:"getPosts",page:P}),onDataFetched:P=>v([...s,...P]),perPage:15});return i("div",{className:"search-container",children:[e("div",{className:"search-header",children:e(ze,{placeholder:r("SEARCH"),onChange:P=>l(P.target.value)})}),e("div",{className:"search-body",onScroll:o,children:a.length>0?e("div",{className:"search-results",children:u.map(P=>i("div",{className:"item",onClick:()=>V(P.username),children:[e("div",{className:"profile-picture",children:e(k,{avatar:P.avatar})}),i("div",{className:"user",children:[i("div",{className:"username",children:[P.username,P.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:P.name})]})]}))}):e("div",{className:"feed-grid",children:s.map((P,I)=>{let n=Math.floor(I/3)%2==0,h=!1;h=I%3==(n?1:0),s[I+1]||(h=!1);let A=JSON.parse(P.media)[0];return e("div",{className:De("grid-post",h&&"big"),onClick:()=>{ee.set({cb:()=>{O.set("search"),ee.set(null)}}),ve.set(P)},children:Q(A)?e("video",{src:A,autoPlay:!0,loop:!0,muted:!0}):e(re,{src:A,blur:!0})},I)})})})]})}function ra(){var v,o,P,I,d,n;const a=E($),t=E(fe),[c,l]=m.useState(""),u=m.useRef(null),f=()=>{c.length!==0&&g("Instagram",{action:"postComment",data:{postId:t.post.id,comment:c}},Math.random().toString(36).substring(7)).then(h=>{if(!h)return M("error","Failed to post comment, no ");l(""),u.current.value="",fe.set({...t,post:t.post,comments:[{user:{username:a.username,avatar:a.avatar,verified:a.verified},comment:{id:h,content:c,timestamp:new Date().getTime(),likes:0,liked:!1}},...t.comments]})})},{handleScroll:s}=ue({fetchData:h=>g("Instagram",{action:"getComments",postId:t.post.id,page:h}),onDataFetched:h=>fe.set({...fe.value,comments:[...fe.value.comments,...h]}),perPage:25});return i(Ee.div,{...Gt("right","active",.2),className:"comments-container",children:[i("div",{className:"comments-header",children:[e(xe,{onClick:()=>fe.reset()}),e("div",{className:"title",children:r("APPS.INSTAGRAM.COMMENTS")}),e("span",{})]}),i("div",{className:"comments-body",onScroll:s,children:[i("div",{className:"post-info",children:[e("div",{className:"profile-picture",children:e(k,{avatar:(v=t==null?void 0:t.post)==null?void 0:v.avatar})}),i("div",{className:"post-data",children:[i("div",{className:"caption",children:[i("span",{className:"username",children:[(o=t==null?void 0:t.post)==null?void 0:o.username,((P=t==null?void 0:t.post)==null?void 0:P.verified)&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),ke((I=t==null?void 0:t.post)==null?void 0:I.caption)]}),e("div",{className:"actions",children:e("div",{className:"date",children:Nt((d=t==null?void 0:t.post)==null?void 0:d.timestamp)})})]})]}),(n=t==null?void 0:t.comments)==null?void 0:n.map((h,A)=>e(ca,{data:h},A))]}),i("div",{className:"add-comment",children:[e("div",{className:"profile-picture",children:e(k,{avatar:a.avatar})}),i("div",{className:"input-container",children:[e(ie,{type:"text",ref:u,placeholder:r("APPS.INSTAGRAM.ADD_COMMENT_AS").format({name:a.username}),onKeyPress:h=>{h.key==="Enter"&&f()},onChange:h=>l(h.target.value)}),e("div",{className:"send",onClick:f,children:r("APPS.INSTAGRAM.POST")})]})]})]})}const ca=({data:a})=>{var s;const[t,c]=m.useState(a.comment.liked),[l,u]=m.useState(a.comment.likes);J("instagram:updateCommentLikes",v=>{!v||v.commentId!==a.comment.id||u(o=>o+(v.increment?1:-1))});const f=()=>{V(a.user.username),fe.reset()};return i("div",{className:"comment",children:[i("div",{className:"user",children:[e("div",{className:"profile-picture",onClick:f,children:e(k,{avatar:a.user.avatar})}),i("div",{className:"comment-data",children:[i("div",{className:"caption",children:[i("span",{className:"username",onClick:f,children:[a.user.username,a.user.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),a.comment.content]}),i("div",{className:"actions",children:[e("div",{className:"date",children:Nt(a.comment.timestamp)}),i("div",{className:"likes",children:[l," ",(s=r("APPS.INSTAGRAM.LIKES"))==null?void 0:s.toLowerCase()]})]})]})]}),e(gt,{liked:t,onClick:()=>{a.comment.id&&g("Instagram",{action:"toggleLike",data:{postId:a.comment.id,toggle:!t,isComment:!0}},!t).then(v=>c(v))}})]})},Nt=a=>{const t=new Date(a),l=new Date().getTime()-t.getTime(),u=Math.floor(l/(1e3*60*60*24)),f=Math.floor(l/(1e3*60*60)),s=Math.floor(l/(1e3*60));let v="";return u<1?f<1?v=`${s}m`:v=`${f}h`:u<30?v=`${u}d`:v=`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`,v};function la(){E(O);const[a,t]=m.useState(0),[c,l]=m.useState([]),[u,f]=m.useState(""),[s,v]=m.useState(null);return m.useEffect(()=>{var o,P,I;a===0&&_.Gallery.set({allowExternal:(I=(P=(o=Se)==null?void 0:o.value)==null?void 0:P.AllowExternal)==null?void 0:I.InstaPic,multiSelect:!0,includeVideos:!0,onCancel:()=>O.set("feed"),onSelect:d=>{Array.isArray(d)?d.length>0&&l(d.map(n=>n.src)):d&&l([d.src]),t(1)}})},[a]),e("div",{className:"newpost-container","data-camera":!1,children:a===1&&i(y,{children:[i("div",{className:"newpost-header",children:[e(xe,{onClick:()=>O.set("feed")}),e("div",{className:"title",children:r("APPS.INSTAGRAM.NEW_POST")}),e("div",{className:"next",onClick:()=>{g("Instagram",{action:"newPost",data:{caption:u,location:s,images:c}},!0).then(o=>{if(!o)return M("warning","Failed to post");O.set("feed")})},children:r("APPS.INSTAGRAM.POST")})]}),e("div",{className:"newpost-body",children:i("div",{className:"newpost-content",children:[i("div",{className:"caption",children:[e("div",{className:"attachments",style:{width:`calc(4rem + ${c.length*20}px)`},onClick:()=>t(0),children:c.slice(0,5).map((o,P)=>e("div",{className:"attachment",style:{left:`${P*20}px`,top:`${P*5}px`,zIndex:P+1},children:Q(o)?e(oa,{src:o}):e(re,{src:o,alt:"image"})},P))}),e("div",{className:"text-area",children:e(ht,{onChange:o=>f(o.target.value),placeholder:r("APPS.INSTAGRAM.CAPTION_PLACEHOLDER")})})]}),e("div",{className:"item",onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.CHOOSE_LOCATION.TITLE"),description:r("APPS.INSTAGRAM.CHOOSE_LOCATION.DESCRIPTION"),input:{type:"text",maxCharacters:30,onChange:o=>v(o)},buttons:[{title:r("APPS.INSTAGRAM.CHOOSE_LOCATION.CANCEL")},{title:r("APPS.INSTAGRAM.CHOOSE_LOCATION.PROCEED")}]})},children:s?i(y,{children:[i("div",{className:"label",children:[e(bt,{}),s]}),e(Ie,{onClick:o=>{o.stopPropagation(),v(null)}})]}):i(y,{children:[e("div",{className:"label",children:r("APPS.INSTAGRAM.LOCATION")}),e(vt,{})]})})]})})]})})}const oa=({src:a})=>{const[t,c]=m.useState(null);return i(y,{children:[e("video",{src:a,crossOrigin:"anonymous",controls:!1,onMouseOver:u=>{var f;return(f=u.currentTarget)==null?void 0:f.play()},onMouseOut:u=>{var f;return(f=u.currentTarget)==null?void 0:f.pause()},onLoadedMetadata:u=>c(u.currentTarget.duration)}),t&&e("div",{className:"video-duration",children:(u=>{const f=Math.floor(u/60),s=_t(u-f*60,0);return`${f}:${s<10?"0"+s:s}`})(t)})]})};function da(){const a=E(ve);return e(y,{children:e(Ee.div,{...kt,className:"viewpost-container",children:i(y,{children:[i("div",{className:"viewpost-header",children:[e(xe,{onClick:()=>{ve.reset()}}),e("div",{className:"name",children:(a==null?void 0:a.username)??"Unknown"}),e("span",{})]}),e("div",{className:"profile-body",children:e(Pt,{data:{...a,viewPost:!0}})})]})})})}function ma(){E(oe.Settings);const a=E($),t=E(pe),c=E(ee),[l,u]=m.useState([]),f=m.useRef(null),s=m.useRef(0),[v,o]=m.useState({content:"",attachments:[]});m.useEffect(()=>{var d;u([]),g("Instagram",{action:"getMessages",page:0,username:t.username},((d=q.messages.find(n=>n.username===t.username))==null?void 0:d.messages)??[]).then(n=>{n&&u(n.reverse())})},[]),J("instagram:newMessage",d=>{if(t.username!==d.sender||d.sender===a.username)return;u([...l,d]);let n=document.querySelector(".dm-body-container");n.scrollTop=n.scrollHeight});const P=()=>{v.content.length===0&&v.attachments.length===0||g("Instagram",{action:"sendMessage",username:t.username,message:{content:v.content,attachments:v.attachments.length>0?v.attachments:null}},!0).then(d=>{if(!d)return;f.current.value="",u([...l,{sender:a.username,recipient:t.username,content:v.content,attachments:v.attachments,timestamp:Date.now()}]),o({content:"",attachments:[]});let n=document.querySelector(".dm-body-container");n.scrollTop=n.scrollHeight})},{handleScroll:I}=ue({fetchData:d=>g("Instagram",{action:"getMessages",username:t.username,page:d}),onDataFetched:d=>{let n=document.querySelector(".dm-body-container");s.current=n.scrollHeight,u([...d.reverse(),...l])},isReversed:!0,perPage:25});return m.useEffect(()=>{let d=document.querySelector(".dm-body-container");const n=d.scrollHeight;d.scrollTop+=n-s.current,d.scroll},[l]),i("div",{className:"dm-container",children:[i("div",{className:"dm-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{c&&c.cb?(c.cb(),ee.reset()):O.set("dmList")}}),i("div",{className:"profile",onClick:d=>{d.stopPropagation(),ee.set({cb:()=>{pe.set(t),O.set("dm")}}),V(t.username)},children:[e("div",{className:"avatar",children:e(k,{avatar:t.avatar})}),i("div",{className:"username",children:[t.name??t.username,t.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]})]})]}),e("div",{className:"dm-body-container",onScroll:I,children:e("div",{className:"dm-body",children:l.map((d,n)=>{var U;let h,A=d.sender===a.username?"self":"other",R=((U=l[n+1])==null?void 0:U.sender)===a.username?"self":"other",T=$e(d.content);return l[n+1]?h=Math.abs(d.timestamp-l[n+1].timestamp)/36e5:R=void 0,i("div",{className:`message ${A}`,children:[A=="other"?i("div",{className:"message-with-pfp",children:[e("div",{"data-story-reply":T?"true":"false",className:De("profile-picture",A!==R?"show":"hide"),onClick:S=>{S.stopPropagation(),ee.set({cb:()=>{pe.set(t),O.set("dm")}}),V(t.username)},children:e(k,{avatar:t.avatar})}),e("div",{className:"message-content",children:T?i("div",{className:"story-reply",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.REPLIED_TO_YOUR_STORY")}),Q(T.src)?e("video",{src:T.src,controls:!1,loop:!0,autoPlay:!0,muted:!0}):e(re,{src:T.src}),e("div",{className:"content",children:T.content})]}):i(y,{children:[d.content&&e("div",{className:"content",children:ke(d.content)}),d.attachments&&e("div",{className:"attatchments",children:d.attachments.map((S,C)=>Q(S)?e("video",{src:S,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:b=>_.FullscreenImage.set(S)},C):e(re,{src:S,blur:!0,onClick:()=>_.FullscreenImage.set(S)},C))})]})})]}):e(y,{children:T?i("div",{className:"story-reply",children:[Q(T.src)?e("video",{src:T.src,controls:!1,loop:!0,autoPlay:!0,muted:!0}):e(re,{src:T.src}),e("div",{className:"content",children:T.content})]}):i(y,{children:[d.content&&e("div",{className:"content",children:ke(d.content)}),d.attachments&&e("div",{className:"attatchments",children:d.attachments.map((S,C)=>Q(S)?e("video",{src:S,controls:!1,loop:!0,muted:!0,autoPlay:!0,onClick:b=>{_.FullscreenImage.set(S)}},C):e(re,{src:S,onClick:()=>{_.FullscreenImage.set(S)}},C))})]})}),l[n+1]&&h>6?e("div",{className:"date",children:ct(d.timestamp)}):A!==R&&e("div",{className:"date",children:ct(d.timestamp)})]},n)})})}),e("div",{className:"attachments",children:v.attachments.map((d,n)=>i("div",{className:"attachment",children:[Q(d)?e("video",{src:d,muted:!0,controls:!1,loop:!0,autoPlay:!0}):e(re,{src:d}),e(Ie,{onClick:()=>{o({...v,attachments:v.attachments.filter((h,A)=>A!==n)})}})]},n))}),i("div",{className:"dm-footer",children:[e(ie,{type:"text",ref:f,onChange:d=>{o({...v,content:d.target.value})},onKeyDown:d=>{d.key==="Enter"&&P()},placeholder:r("APPS.INSTAGRAM.MESSAGE_PLACEHOLDER")}),v.content.length>0?e("span",{onClick:()=>P(),className:"send",children:r("APPS.INSTAGRAM.SEND")}):e(Dt,{onClick:()=>{var d,n,h;v.attachments.length<3&&_.Gallery.set({includeVideos:!0,allowExternal:(h=(n=(d=Se)==null?void 0:d.value)==null?void 0:n.AllowExternal)==null?void 0:h.InstaPic,onSelect:A=>o({...v,attachments:[...v.attachments,Array.isArray(A)?A[0].src:A.src]})})}})]})]})}const $e=a=>{if(!(a.includes("<!REPLIED_STORY-DATA=")&&a.includes("!>")))return null;const c=a.match(/src="([^"]+)"/),l=a.match(/content:"([^"]+)"/);return!c||!l?null:{src:c[1],content:l[1]}},ot=Z(0);function ua(){const a=E($),[t,c]=m.useState(!1),[l,u]=m.useState(""),[f,s]=m.useState(""),[v,o]=m.useState([]),[P,I]=m.useState([]);m.useEffect(()=>{me("Instagram")&&g("Instagram",{action:"getRecentMessages",page:0},q.messages).then(n=>{n&&I(n)})},[]);const{handleScroll:d}=ue({fetchData:n=>g("Instagram",{action:"getRecentMessages",page:n}),onDataFetched:n=>I([...P,...n]),perPage:25});return m.useEffect(()=>{const n=setTimeout(()=>u(f),500);return()=>clearTimeout(n)},[f]),m.useEffect(()=>{l.length>0?t?g("Instagram",{action:"search",query:l},q.messages.filter(n=>n.username!==a.username)).then(n=>{n&&o(n)}):o(P.filter(n=>{var h;return n.username.includes(l)||((h=n==null?void 0:n.name)==null?void 0:h.includes(l))&&n.username!==a.username})):o([])},[l]),m.useEffect(()=>{u(""),o([])},[t]),e("div",{className:"dm-list",children:t?i("div",{className:"slide up",children:[i("div",{className:"dm-list-header new",children:[e("i",{className:"far fa-chevron-left",onClick:()=>{c(!1),o([])}}),e("div",{className:"title",children:r("APPS.INSTAGRAM.NEW_MESSAGE")}),e("span",{})]}),i("div",{className:"dm-list-body ",children:[i("div",{className:"input",children:[e("span",{children:r("APPS.INSTAGRAM.TO")}),e(ie,{type:"text",onChange:n=>s(n.target.value),placeholder:r("SEARCH")})]}),v.length>0&&e("div",{className:"items",children:v.map((n,h)=>i("div",{className:"item",onClick:()=>{c(!1),pe.set(n),O.set("dm")},children:[e("div",{className:"avatar",onClick:A=>{A.stopPropagation(),ee.set({cb:()=>{O.set("dmList"),ee.reset()}}),V(n.username)},children:e(k,{avatar:n.avatar})}),i("div",{className:"info",children:[i("div",{className:"username",children:[n.username,n.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"last-message",children:n.name})]})]},h))})]})]}):i(y,{children:[i("div",{className:"dm-list-header",children:[i("div",{className:"top",children:[e("i",{className:"far fa-chevron-left",onClick:()=>O.set("feed")}),e("i",{className:"far fa-edit",onClick:()=>c(!0)})]}),e(ze,{placeholder:r("SEARCH"),onChange:n=>s(n.target.value)})]}),e("div",{className:"dm-list-body",onScroll:d,children:e("div",{className:"items",children:l.length>0&&!t?v.map((n,h)=>{var A,R;if(((A=n.content)==null?void 0:A.length)===0&&(n.content=r("APPS.INSTAGRAM.SENT_A_PHOTO")),(R=n.content)!=null&&R.includes("<!REPLIED_STORY-DATA=")){let T=$e(n.content);n.content=r("APPS.INSTAGRAM.REPLIED_TO_YOUR_STORY_CONTENT").format({content:T.content})}return i("div",{className:"item",onClick:()=>{n.unread&&ot.set(ot.value-1),c(!1),pe.set(n),O.set("dm")},children:[e("div",{className:"avatar",onClick:T=>{T.stopPropagation(),ee.set({cb:()=>{O.set("dmList"),ee.reset()}}),V(n.username)},children:e(k,{avatar:n.avatar})}),i("div",{className:"info",children:[i("div",{className:"username",children:[n.name,n.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),i("div",{className:"last-message",children:[n.content.length>40?n.content.substring(0,40)+"...":n.content,"  ",Te(n.timestamp)]})]})]},h)}):P.map((n,h)=>{var A;if(n.content.length===0&&(n.content=r("APPS.INSTAGRAM.SENT_A_PHOTO")),(A=n.content)!=null&&A.includes("<!REPLIED_STORY-DATA=")){let R=$e(n.content);n.content=r("APPS.INSTAGRAM.REPLIED_TO_YOUR_STORY_CONTENT").format({content:R.content})}return i("div",{className:"item",onClick:()=>{c(!1),pe.set(n),O.set("dm")},children:[e("div",{className:"avatar",onClick:R=>{R.stopPropagation(),ee.set({cb:()=>{O.set("dmList"),ee.reset()}}),V(n.username)},children:e(k,{avatar:n.avatar})}),i("div",{className:"info",children:[i("div",{className:"username",children:[n.name,n.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),n.content.length>40?n.content.substring(0,40)+"...":n.content,"  ",Te(n.timestamp)]})]},h)})})})]})})}function fa(){var j,ge,Pe,Ne,Le,N,w,H,B,se,Me,we,Oe,Ge,ye,Ke,Xe,je,Je,Qe,Ze,et,tt,at,st,nt,it,rt;const a=E(oe.Settings),t=E(Re.Visible),c=E(Ve),l=E($),u=E(le),f=E(Ce),[s,v]=m.useState(null),[o,P]=m.useState(0),[I,d]=m.useState(""),[n,h]=m.useState(!1),[A,R]=m.useState({x:0,y:0}),T=m.useRef(null),[U,S]=m.useState(0),[C,b]=m.useState(null);m.useEffect(()=>{if(s){for(let L=0;L<s.media.length;L++)if(!s.media[L].seen)return P(L)}},[]),m.useEffect(()=>{f&&(v(f),R(f.origin))},[f]),m.useEffect(()=>{var G,W,X;const L=(W=(G=s==null?void 0:s.media)==null?void 0:G[o])==null?void 0:W.metadata;L!=null&&L.post&&yt((X=s==null?void 0:s.media[o])==null?void 0:X.image).then(te=>{if(!te)return M("warning","Failed to get average color");b(`
                    linear-gradient(0deg,
                        ${te.darkmuted??te.muted} 0%,
                        ${te.darkvibrant??te.dominant} 100%
                    )
                `)})},[o,s]),m.useEffect(()=>{var L,G;if(!(!T.current||((L=a==null?void 0:a.sound)==null?void 0:L.volume)===void 0)){if(!t||!me("Instagram")){T.current.pause();return}(G=T==null?void 0:T.current)!=null&&G.paused&&T.current.play(),T.current.volume=a.sound.volume}},[(j=a==null?void 0:a.sound)==null?void 0:j.volume,t,c==null?void 0:c.active]);const p=L=>{if(n)return h(!1);const G=L.target.getBoundingClientRect(),W=L.clientX-G.left*_e();let X=s.media[o];if(X.seen||g("Instagram",{action:"viewedStory",id:X.id}),W<G.width*_e()/2)if(o>0)P(o-1);else{let te=u.findIndex(He=>He.username===s.username),be=u[te-1];be&&Fe(be)}else if(o<s.media.length-1)P(o+1);else{let te=u.findIndex(He=>He.username===s.username),be=u[te+1];be?(Y(s.username),Fe(be),P(0)):F()}},D=()=>{var G,W;if(!I||I==="")return;let L=`<!REPLIED_STORY-DATA='{src="${(W=(G=s==null?void 0:s.media)==null?void 0:G[o])==null?void 0:W.image}", content:"${I}"}'!>`;g("Instagram",{action:"sendMessage",username:s.username,message:{content:L}},!0).then(X=>{if(!X)return M("error","Failed to send message");pe.set({username:s.username,name:s.name,verified:s.verified,avatar:s.avatar}),O.set("dm"),F()})},Y=L=>{var G;s.media.length===o+1&&le.set((G=le.value)==null?void 0:G.map(W=>(W.username===L&&(W.seen=1),W)))},F=L=>{L!==!1&&Y(s.username),Ce.set(null)},x=()=>{var L,G;(G=(L=s==null?void 0:s.media[o])==null?void 0:L.metadata)!=null&&G.post&&_.ContextMenu.set({buttons:[{title:r("APPS.INSTAGRAM.VIEW_POST"),cb:()=>{var W,X,te;if(Ue((te=(X=(W=s==null?void 0:s.media[o])==null?void 0:W.metadata)==null?void 0:X.post)==null?void 0:te.id),s!=null&&s.media[o].seen)return F();g("Instagram",{action:"viewedStory",id:s==null?void 0:s.media[o].id},!0).then(()=>F())}}]})},K=(Pe=(ge=s==null?void 0:s.media)==null?void 0:ge[o])==null?void 0:Pe.metadata;return i(Ee.div,{className:"instagram-story",initial:{scale:0,transformOrigin:f!=null&&f.origin?`${((Ne=f==null?void 0:f.origin)==null?void 0:Ne.x)??0}px ${((Le=f==null?void 0:f.origin)==null?void 0:Le.y)??0}px`:"50% 50%"},animate:{scale:1,transformOrigin:f!=null&&f.origin?`${((N=f==null?void 0:f.origin)==null?void 0:N.x)??0}px ${((w=f==null?void 0:f.origin)==null?void 0:w.y)??0}px`:"50% 50%"},exit:{scale:0,transformOrigin:A?`${(A==null?void 0:A.x)??0}px ${(A==null?void 0:A.y)??0}px`:"50% 50%"},transition:{duration:.25,ease:"easeInOut"},children:[K!=null&&K.post?e("div",{className:"background-image",onClick:p,style:{background:C??"rgb(20,20,20)"}}):Q((B=(H=s==null?void 0:s.media)==null?void 0:H[o])==null?void 0:B.image)?e("video",{ref:T,className:"background-image",onClick:p,src:(Me=(se=s==null?void 0:s.media)==null?void 0:se[o])==null?void 0:Me.image,autoPlay:!0,loop:!0,onLoadedMetadata:()=>T.current.volume=a.sound.volume,onTimeUpdate:()=>S(T.current.currentTime/T.current.duration)}):e("div",{className:"background-image",onClick:p,style:{backgroundImage:`url(${(Oe=(we=s==null?void 0:s.media)==null?void 0:we[o])==null?void 0:Oe.image})`}}),e(Ae,{children:n&&e(va,{activeImage:o,close:()=>h(!1)})}),i("div",{className:"story-wrapper",children:[i("div",{className:"story-header",children:[e("div",{className:"story-steps",children:(Ge=s==null?void 0:s.media)==null?void 0:Ge.map((L,G)=>{var X;let W=Q((X=s==null?void 0:s.media[G])==null?void 0:X.image);return e("div",{style:W&&o===G?{background:`linear-gradient(to right, rgba(255,255,255,0.8) ${U*100}%, rgba(255,255,255,0.3) ${U*100}%)`}:void 0,className:o===G?"active":"",onClick:()=>P(G)},G)})}),i("div",{className:"profile-details",children:[i("div",{className:"profile",onClick:()=>{var L,G;(G=(L=s==null?void 0:s.media)==null?void 0:L[o])!=null&&G.seen||g("Instagram",{action:"viewedStory",id:s==null?void 0:s.media[o].id},!0).then(()=>F()),F(),V(s==null?void 0:s.username)},children:[e("div",{className:"profile-picture",children:e(k,{className:"avatar",avatar:s==null?void 0:s.avatar})}),i("div",{className:"name",children:[s==null?void 0:s.username,!1]}),e("div",{className:"time",children:Te((Ke=(ye=s==null?void 0:s.media)==null?void 0:ye[o])==null?void 0:Ke.timestamp)})]}),e("div",{className:"stats",children:e(Ie,{onClick:()=>{var L,G,W,X;if((G=(L=s==null?void 0:s.media)==null?void 0:L[o])!=null&&G.seen)return F();g("Instagram",{action:"viewedStory",id:(X=(W=s==null?void 0:s.media)==null?void 0:W[o])==null?void 0:X.id},!0).then(()=>F())}})})]})]}),(K==null?void 0:K.post)&&e("div",{className:"story-post",children:i("div",{className:"post-wrapper",onClick:x,children:[Q((je=(Xe=s==null?void 0:s.media)==null?void 0:Xe[o])==null?void 0:je.image)?e("video",{src:(Qe=(Je=s==null?void 0:s.media)==null?void 0:Je[o])==null?void 0:Qe.image,muted:!0}):e(re,{src:(et=(Ze=s==null?void 0:s.media)==null?void 0:Ze[o])==null?void 0:et.image}),i("div",{className:"post-username",children:["@",(tt=K==null?void 0:K.post)==null?void 0:tt.username]})]})}),(s==null?void 0:s.username)===l.username?i("div",{className:"story-footer","data-stats":!0,children:[i("div",{className:"seen-by",onClick:()=>h(!0),children:[((st=(at=s==null?void 0:s.media)==null?void 0:at[o])==null?void 0:st.viewers)&&e("div",{className:"images",children:(rt=(it=(nt=s==null?void 0:s.media)==null?void 0:nt[o])==null?void 0:it.viewers)==null?void 0:rt.map((L,G)=>e(k,{avatar:L.avatar},G))}),r("APPS.INSTAGRAM.SEEN_BY").format({count:zt(s==null?void 0:s.media[o].views)??0})]}),e(Ie,{onClick:()=>{_.PopUp.set({title:r("APPS.INSTAGRAM.DELETE_STORY.TITLE"),description:r("APPS.INSTAGRAM.DELETE_STORY.DESCRIPTION"),buttons:[{title:r("APPS.INSTAGRAM.DELETE_STORY.CANCEL")},{title:r("APPS.INSTAGRAM.DELETE_STORY.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"removeFromStory",id:s==null?void 0:s.media[o].id},!0).then(L=>{var G;if(!L)return M("error","Failed to remove image from story");M("info","Removed image from story"),Ce.set(null),s.media.length===1&&le.set((G=le.value)==null?void 0:G.filter(W=>W.username!==s.username))})}}]})}})]}):i("div",{className:"story-footer",children:[e("div",{className:"input",children:e(ie,{type:"text",placeholder:r("APPS.INSTAGRAM.SEND_A_MESSAGE"),onChange:L=>d(L.target.value),onKeyDown:L=>{L.key==="Enter"&&D()}})}),e(Ye,{onClick:()=>D()})]})]})]})}const va=a=>{var f;const t=E(Ce),[c,l]=m.useState([]);m.useEffect(()=>{var s,v;(a==null?void 0:a.activeImage)!==void 0&&g("Instagram",{action:"getViewers",id:t==null?void 0:t.media[a.activeImage].id,page:0},(v=(s=q.stories.find(o=>o.username===t.username))==null?void 0:s.media.find(o=>o.id===t.media[a.activeImage].id))==null?void 0:v.viewers).then(o=>{if(!o)return M("warning","Failed to fetch viewers data");l(o)})},[]);const{handleScroll:u}=ue({fetchData:s=>g("Instagram",{action:"getViewers",id:t==null?void 0:t.media[a.activeImage].id,page:s}),onDataFetched:s=>l(v=>[...v,...s]),perPage:15});return i(Ee.div,{className:"story-modal",initial:{y:600},animate:{y:0},exit:{y:600},transition:{duration:.35,ease:"easeInOut"},children:[i("div",{className:"story-modal-header",children:[i("div",{className:"views",children:[e(mt,{})," ",e("div",{className:"views",children:((f=t==null?void 0:t.media[a==null?void 0:a.activeImage])==null?void 0:f.views)??0})]}),e(Ie,{className:"close",onClick:a==null?void 0:a.close})]}),i("div",{className:"story-modal-content",children:[e("div",{className:"title",children:r("APPS.INSTAGRAM.STORY_VIEWERS")}),e("div",{className:"viewers",onScroll:u,children:c.map((s,v)=>e("div",{className:"item",children:i("div",{className:"user",onClick:()=>{V(s.username),Ce.set(null)},children:[e("div",{className:"profile-picture",children:e(k,{className:"avatar",avatar:s.avatar})}),i("div",{className:"user-details",children:[i("div",{className:"username",children:[s.username,s.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:s.name})]})]})},v))})]})]})};function ha(){const a=E(O),t=E($);return e("div",{className:"instagram-footer",children:i(y,{children:[[{value:"feed",activeIcon:e(Ut,{}),icon:e(Ft,{})},{value:"search",activeIcon:e(Vt,{}),icon:e(xt,{})},{value:"newPost",activeIcon:e(Ht,{}),icon:e(Wt,{})},{value:"notifications",activeIcon:e(Be,{}),icon:e(ut,{})}].map((l,u)=>e("div",{onClick:()=>{ve.value&&ve.reset(),O.set(l.value)},children:a===l.value?l.activeIcon:l.icon},u)),e(k,{avatar:t.avatar,className:"profile",onClick:()=>V(t.username)})]})})}function ga(){const a=E(he),[t,c]=m.useState([]);let l={[r("APPS.INSTAGRAM.FOLLOWING")]:"getFollowing",[r("APPS.INSTAGRAM.FOLLOWERS")]:"getFollowers",[r("APPS.INSTAGRAM.LIKED_BY")]:"getLikes"};const u=(s,v)=>{var o,P;if(s!==r("APPS.INSTAGRAM.LIKED_BY")){let I=s===r("APPS.INSTAGRAM.FOLLOWING")?(o=q.accounts[v])==null?void 0:o.followingList:((P=q.accounts[v])==null?void 0:P.followerList)??[];return I==null?void 0:I.map(d=>q.accounts[d])}};m.useEffect(()=>{me("Instagram")&&g("Instagram",{action:l[a.title],data:{postId:a.postId,username:a.username,page:0}},u(a.title,a.username)).then(s=>{if(!s)return M("info","No data returned from instagram event");c(s)})},[]);const{handleScroll:f}=ue({fetchData:s=>g("Instagram",{action:l[a.title],data:{postId:a.postId,username:a.username,page:s}}),onDataFetched:s=>c([...t,...s]),perPage:20});return e(y,{children:a&&t&&i(Ee.div,{...$t,className:"userpanel-container",children:[i("div",{className:"userpanel-header",children:[e("i",{className:"far fa-chevron-left",onClick:()=>he.set(null)}),e("div",{className:"userpanel-title",children:a.title}),e("span",{})]}),e("div",{className:"userpanel-body",onScroll:f,children:e("div",{className:"items",children:t.map((s,v)=>e(Pa,{data:s,allData:a},v))})})]})})}const Pa=a=>{const t=E($);let c=a.data;const[l,u]=m.useState(c.isFollowing===1);return i("div",{className:"item",onClick:()=>{he.set(a.allData),V(c.username)},children:[i("div",{className:"user",children:[e("div",{className:"profile-picture",children:e(k,{avatar:c.avatar})}),i("div",{className:"user-details",children:[i("div",{className:"username",children:[c.username,c.verified&&e("span",{className:"verified",children:e("img",{src:"./assets/img/icons/instagram/Verified.svg"})})]}),e("div",{className:"name",children:c.name})]})]}),t.username!==c.username&&e("div",{className:"action",onClick:f=>{f.stopPropagation(),c.username!==t.username&&(l?_.PopUp.set({title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.TITLE"),description:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.DESCRIPTION").format({name:c.username}),buttons:[{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.CANCEL")},{title:r("APPS.INSTAGRAM.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>{g("Instagram",{action:"toggleFollow",data:{username:c.username,following:!l}},!0).then(()=>{u(s=>!s)})}}]}):g("Instagram",{action:"toggleFollow",data:{username:c.username,following:!l}},!0).then(()=>{u(s=>!s)}))},children:l?e("div",{className:"button following",children:r("APPS.INSTAGRAM.FOLLOWING")}):e("div",{className:"button follow",children:r("APPS.INSTAGRAM.FOLLOW")})})]})},O=Z("feed"),$=Z(null),de=Z(!1),le=Z([]),Ce=Z(null),ce=Z(null),fe=Z(null),ve=Z(null),pe=Z(null),ee=Z(null),he=Z(null);function Ea(){var h;const a=E(oe.Settings),t=(h=E(Ve))==null?void 0:h.active,c=E(oe.Styles.TextColor),l=E(O),u=E($),f=E(de),s=E(ve),v=E(Ce),o=E(fe),P=E(he),[I,d]=m.useState(!0);m.useEffect(()=>{var A,R;t&&((A=t==null?void 0:t.data)==null?void 0:A.view)==="profile"&&V((R=t==null?void 0:t.data)==null?void 0:R.username)},[t]),m.useEffect(()=>{g("isAdmin",null,!1).then(A=>{if(ae.APPS.INSTAGRAM.account.value){$.set({...ae.APPS.INSTAGRAM.account.value,isAdmin:A}),de.set(!0),d(!1);return}else if(ae.APPS.INSTAGRAM.account.value===!1)return d(!1);g("Instagram",{action:"isLoggedIn"},q.account).then(R=>{R?(ae.APPS.INSTAGRAM.account.set(R),$.set({...R,isAdmin:A}),de.set(!0),d(!1)):(d(!1),ae.APPS.INSTAGRAM.account.set(null))})})},[]),m.useEffect(()=>{if(me("Instagram"))return setTimeout(()=>{l==="live"||l==="story"?(oe.Styles.TextColor.set("#fafafaed"),l=="live"&&_.IndicatorVisible.set(!1)):(oe.Styles.TextColor.set(a.display.theme==="dark"?"#fafafaed":"#000000"),_.IndicatorVisible.set(!0)),l==="dm"?Re.ReceiveAppNotifications.set(!1):Re.ReceiveAppNotifications.set(!0)},250),()=>{Re.ReceiveAppNotifications.set(!0)}},[l]);const n={feed:e(ea,{}),search:e(ia,{}),notifications:e(ta,{}),profile:e(na,{}),live:e(Kt,{}),logIn:e(lt,{}),newPost:e(la,{}),dmList:e(ua,{}),dm:e(ma,{})};return J("instagram:logout",A=>{if(!A)return M("warning","No username provided to logout");if(!f)return M("info","User is not logged in, cannot log out");if(A!==(u==null?void 0:u.username))return M("warning","Username provided does not match current logged in username, not logging out");$.set(null),de.set(!1),O.set("logIn")}),e("div",{className:"instagram-container",children:I||!qt()?e("div",{className:"loading",children:e(Yt,{size:40,lineWeight:5,speed:2,color:c})}):e("div",{className:"instagram-wrapper",children:f?i(y,{children:[e(Ae,{children:v&&e(fa,{})}),e(Ae,{children:P&&e(ga,{})}),e(Ae,{children:o&&e(ra,{})}),e(Ae,{children:s&&e(da,{})}),n==null?void 0:n[l],l!=="live"&&l!=="logIn"&&l!=="newPost"&&l!=="comments"&&!v&&e(ha,{})]}):e(lt,{})})})}const Ue=(a,t)=>{a&&g("Instagram",{action:"getPost",id:a},q.posts.find(c=>c.id===a)).then(c=>{if(!c)return M("warning","Failed to fetch post data");if(t)return qe(c);ve.set(c)})},V=a=>{var t;a&&g("Instagram",{action:"getProfile",username:a},(t=q.accounts)==null?void 0:t[a]).then(c=>{if(!c)return M("warning","Failed to fetch profile data");ce.set(c),O.set("profile"),he.value&&he.reset()})},qe=a=>{a.id&&g("Instagram",{action:"getComments",postId:a.id,page:0},q.comments.filter(t=>t.postId===a.id)).then(t=>{t&&fe.set({post:a,comments:t})})},Fe=(a,t,c)=>{var l;!a&&!(a!=null&&a.username)||((t==null?void 0:t.length)==0&&(t=null),g("Instagram",{action:"getStory",username:a.username},(l=q.stories.find(u=>u.username===a.username))==null?void 0:l.media).then(u=>{if(!u||u.length===0)return M("warning","Failed to fetch story data");Ce.set({username:a.username,avatar:a.avatar,verified:a.verified,media:u,queue:t,origin:c})}))};export{$ as Account,fe as Comments,O as CurrentView,pe as Dm,ee as History,de as LoggedIn,ve as Post,ce as Profile,le as Stories,Ce as Story,he as UserPanel,Ea as default,qe as fetchAndSetComments,Ue as fetchAndSetPost,V as fetchAndSetProfile,Fe as fetchAndSetStory};
