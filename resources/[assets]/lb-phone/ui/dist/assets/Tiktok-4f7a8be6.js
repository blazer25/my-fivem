import{a as e,W as be,r as l,H as ae,t as L,v as m,j as o,z as Ue,L as i,co as qe,ca as Z,X as le,C as W,cD as De,a2 as ce,m as re,cE as Fe,Q as Pe,I as ve,ay as je,cc as ye,q as Ne,ag as pe,a8 as we,N as Se,cs as Ve,cF as Re,aX as Ie,T as Oe,ad as Ke,F as Q,d as ue,a9 as Xe,a3 as Je,cr as Me,u as fe,A as ge,ct as xe,cG as Qe,cH as Ge,bT as et,a7 as tt,P as de,V as Be,S as We,b as he,w as te,cI as nt,cJ as it,cK as st,ck as ot,e as Ee,ao as at,ap as lt,b0 as He,bW as rt,aD as ct,ab as dt,bN as ut,cf as mt,bV as ft,cg as ht,cz as Le,cL as vt,bQ as Tt,cM as Pt,cN as gt,cx as pt,b8 as St,ac as Ct}from"./index-569b241b.js";import{T as $e}from"./Textarea-61cff3f3.js";import{S as Nt}from"./Switch-55d464d2.js";import{S as It}from"./Slider-81509870.js";function me(){return e("div",{className:"checkmark",children:e(be,{})})}const $={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function Ze(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function Ot(){var y;const{User:t}=l.useContext(B),[u]=t,[h,P]=l.useState(""),[I,T]=l.useState(""),[d,r]=l.useState([]),[a,p]=l.useState([]),[n,s]=l.useState(0),[f,b]=l.useState(!1),[R,U]=l.useState(0),[c,S]=l.useState(!1),[v,D]=l.useState(!1);l.useEffect(()=>{ae("TikTok")&&L("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},$.Videos).then(K=>{if(!K)return m("warning","Failed to get videos");p(K)})},[]),l.useEffect(()=>{h.length>0&&L("TikTok",{action:"searchAccounts",query:h},$.Accounts.filter(K=>K.username.includes(h))).then(K=>{if(!K)return m("info","No response, most likely no accounts to search for?");r(K)}),U(0),D(!1)},[h]),l.useEffect(()=>{const K=setTimeout(()=>P(I),500);return()=>clearTimeout(K)},[I]);const F=()=>{let K=h.length===0;if(K&&f)return m("info","Fetched everything, no need to fetch more (VIDEOS)");if(!K&&v)return m("info","Fetched everything, no need to fetch more (SEARCH)");if(c)return m("info","Already fetching");let O=document.querySelector("#last");if(!O)return m("warning","No last element");!qe(O)&&(S(!0),L("TikTok",{action:K?"getVideos":"searchAccounts",query:h,data:{full:!0,type:"recent"},page:(K?n:R)+1},null).then(w=>{w&&w.length>0?(K?p(N=>[...N,...w]):r(N=>[...N,...w]),S(!1)):(S(!1),K?b(!0):D(!0))}),K?s(w=>w+1):U(w=>w+1))};return o("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Ue,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:K=>T(K.target.value)})}),h.length>0?e("div",{className:"search-results",onScroll:F,children:(y=d==null?void 0:d.filter(K=>K.username!==u.username))==null?void 0:y.map((K,O)=>e(wt,{data:K,last:d.length-1===O},O))}):e("div",{className:"discover-content",onScroll:F,children:a.map((K,O)=>e(At,{data:K,last:a.length-1===O},O))})]})}const wt=({data:t,last:u})=>{var p,n;const{Func:h,GoBack:P}=l.useContext(B),[I,T]=P,[d,r]=l.useState(t.isFollowing),a=s=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:s}},!0).then(f=>{if(!f||!(f!=null&&f.success))return m("warning","Failed to toggle follow");if(f.error)return m("error",f.error);r(s)})};return o("div",{className:"item",id:u?"last":"",onClick:()=>{T({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.follower_count)??"0"," ",(p=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:p.toLowerCase()," ",z(t.video_count)??"0"," ",(n=i("APPS.TIKTOK.VIDEOS"))==null?void 0:n.toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:le("button",d?"following":"follow"),onClick:s=>{s.stopPropagation(),d?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>a(!1)}]}):a(!0)},children:d?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})},At=({data:t,last:u})=>{const{Func:h,GoBack:P}=l.useContext(B),[I,T]=P;return o("div",{className:"item",id:u?"last":"",onClick:()=>{h.fetchAndSetVideo(t.id,{type:"recent"}),T({view:"discover"})},children:[o("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:d=>{var r;return(r=d.currentTarget)==null?void 0:r.play().catch(()=>{})},onMouseLeave:d=>{var r;return(r=d.currentTarget)==null?void 0:r.pause()},muted:!0}),e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),o("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),o("div",{className:"video-info",children:[o("div",{className:"user",onClick:d=>{d.stopPropagation(),T({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[e(Z,{avatar:t.avatar}),e("div",{className:"name",children:t.username})]}),o("div",{className:"stats",children:[o("div",{children:[e(De,{className:"plays"}),z(t.views)]}),o("div",{children:[e(Ze,{}),z(t.likes)]})]})]})]})]})};function kt(){const{User:t,View:u,Dm:h}=l.useContext(B),[P,I]=u,[T,d]=h,[r,a]=l.useState(!1),[p,n]=l.useState([]);return l.useEffect(()=>{ae("TikTok")&&L("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(s=>{if(!(s!=null&&s.success))return m("warning",s.error);n(s.channels)})},[]),ce("tiktok:receivedMessage",s=>{n(f=>{let b=f.findIndex(U=>U.channelId===s.channelId);if(b===-1)return f;let R=[...f];return R[b].lastMessage=s.content,R[b].lastMessageTimestamp=Date.now(),R})}),o(re.div,{...Fe,className:"messages-container",children:[e(Pe,{children:r&&e(Kt,{close:()=>a(!1)})}),o("div",{className:"dmmessages-header",children:[e(ve,{onClick:()=>I("inbox")}),e("div",{className:"title",children:i("APPS.TIKTOK.DIRECT_MESSAGES")}),e(je,{onClick:()=>a(!0)})]}),o("div",{className:"messages-body",children:[p.length===0&&o("div",{className:"no-messages",children:[e(ye,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),p.map((s,f)=>o("div",{className:"message","data-unread":s.unread_messages>0,onClick:()=>{d({id:s.id,name:s.name,username:s.username,avatar:s.avatar,verified:s.verified,follower_count:s.follower_count,following_count:s.following_count,video_count:s.video_count}),s.unread_messages>0&&L("TikTok",{action:"clearUnreadMessages",id:s.id}),I("dm")},children:[o("div",{className:"user",children:[e(Z,{avatar:s.avatar}),o("div",{className:"message-content",children:[e("div",{className:"username",children:s.name}),e("div",{className:"content",children:s.last_message})]})]}),e("div",{className:"timestamp",children:Ne(s.timestamp)})]},f))]})]})}const Kt=({close:t})=>{const{User:u}=l.useContext(B),[h]=u,[P,I]=l.useState(""),[T,d]=l.useState(""),[r,a]=l.useState([]);l.useEffect(()=>{const n=setTimeout(()=>I(T),500);return()=>clearTimeout(n)},[T]),l.useEffect(()=>{P.length>0&&L("TikTok",{action:"searchAccounts",query:P},{success:!0,accounts:$.Accounts}).then(n=>{if(!n)return m("info","No response, most likely no accounts to search for?");a(n)})},[P]);const p=n=>{};return o(re.div,{...pe,className:"search-container",children:[o("div",{className:"search-header",children:[e(we,{onClick:t}),e(Ue,{placeholder:i("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>d(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:p,children:r==null?void 0:r.filter(n=>n.username!==h.username).map((n,s)=>e(Et,{data:n,last:r.length-1===s},s))})]})},Et=({data:t,last:u})=>{var a,p;const{View:h,Dm:P}=l.useContext(B),[I,T]=h,[d,r]=P;return e("div",{className:"item",id:u?"last":"",onClick:()=>{r({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),T("dm")},children:o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),o("div",{className:"stats",children:[z(t.follower_count)," ",(a=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:a.toLowerCase()," ",z(t.video_count)??"0"," ",(p=i("APPS.TIKTOK.VIDEOS"))==null?void 0:p.toLowerCase()]})]})]})})};function ze({className:t}){return o("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function Ae({className:t}){return o("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function Lt(){const{View:t}=l.useContext(B),[u,h]=t,[P,I]=l.useState([]),[T,d]=l.useState(0);l.useEffect(()=>{ae("TikTok")&&(L("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(a=>{if(!a.success)return m("warning","Failed to get unread messages: "+a.error);d(a==null?void 0:a.unread)}),L("TikTok",{action:"getNotifications",page:0},{success:!0,data:$.Notifications}).then(a=>{if(!a.success)return m("warning","Failed to get notifications: "+a.error);I(a.data)}))},[]);const{handleScroll:r}=Se({fetchData:a=>L("TikTok",{action:"getNotifications",page:a}),onDataFetched:a=>()=>{if(!(a!=null&&a.success))return m("warning","Failed to get notifications: "+a.error);if(!(a!=null&&a.data))return m("warning","Failed to get notifications: (NO DATA)"+(a==null?void 0:a.error));I([...P,...a.data])},perPage:25});return o("div",{className:"inbox-container",children:[o("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:i("APPS.TIKTOK.ALL_ACTIVITY")}),o("div",{className:"messages",onClick:()=>h("messages"),children:[e(Ve,{}),T>0&&e("div",{className:"notifications",children:T})]})]}),o("div",{className:"inbox-body",onScroll:r,children:[P.length===0&&o("div",{className:"no-notifications",children:[e(Re,{}),e("div",{className:"title",children:i("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:i("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),P.map((a,p)=>e(_t,{data:a},p))]})]})}const _t=({data:t})=>{const{Func:u,GoBack:h}=l.useContext(B),[P,I]=h,[T,d]=l.useState(t.isFollowing),r=n=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},{success:!0}).then(s=>{if(!s||!(s!=null&&s.success))return m("warning","Failed to toggle follow");if(s.error)return m("error",s.error);d(n)})};let a;switch(t.type){case"follow":a=i("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":a=i("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":a=i("APPS.TIKTOK.LIKED_COMMENT");break;case"save":a=i("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":a=i("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":a=i("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const p=()=>{I({view:"inbox"}),u.fetchAndSetProfile(t.username)};return o("div",{className:le("notification",t.type),children:[o("div",{className:"user",children:[o("div",{className:"avatar",onClick:p,children:[e(Z,{avatar:t.avatar}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(Ae,{}):e(ze,{})})]}),o("div",{className:"info",children:[o("div",{className:"username",onClick:p,children:[t.name,t.verified&&e(me,{})]}),o("div",{className:"notification-content",children:[a,e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&o("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:le("button",T?"following":"follow"),onClick:n=>{n.stopPropagation(),T?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:T?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(I({view:"inbox"}),u.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function bt(){var N,_;const{User:t,GoBack:u,View:h,Func:P,Dm:I,Profile:T}=l.useContext(B),[d,r]=t,[a,p]=h,[n]=I,[s,f]=u,[b,R]=T,[U,c]=l.useState([]),[S,v]=l.useState(n==null?void 0:n.id),D=l.useRef(null),[F,y]=l.useState("");l.useState(0),l.useState(!1),l.useState(!1),l.useEffect(()=>(Ie.ReceiveAppNotifications.set(!1),()=>{Ie.ReceiveAppNotifications.set(!0)}),[]),l.useEffect(()=>{var g;S&&L("TikTok",{action:"getMessages",page:0,id:S},{success:!0,messages:(g=$.Messages.find(k=>k.id===S))==null?void 0:g.messages}).then(k=>{if(!(k!=null&&k.success))return m("warning","An error occured while fetching messages. "+(k==null?void 0:k.error));if(!(k!=null&&k.messages))return m("warning","An error occured while fetching messages. (No messages)");c(k.messages.reverse())})},[S]),ce("tiktok:receivedMessage",g=>{n.username===g.sender&&c([...U,{...g,timestamp:new Date().getTime()}])});const K=()=>{var g;if(F.trim().length===0)return m("warning","You can't send an empty message");L("TikTok",{action:"sendMessage",data:{id:S,username:n.username,content:F}},{success:!0,id:"3",channelId:(g=$.Messages.find(k=>k.id===S))==null?void 0:g.id}).then(k=>{if(!(k!=null&&k.success))return m("warning","An error occured while sending message. "+(k==null?void 0:k.error));m("info",`Message sent to ${n.username}, id: ${k.id}, channelId: ${k==null?void 0:k.channelId}`),k!=null&&k.channelId&&!S&&v(k.channelId),D.current.value="",c([...U,{id:k.id,sender:d.username,recipient:n.username,content:F,timestamp:new Date().getTime()}]),y("");let x=document.querySelector(".dm-body");x.scrollTop=x.scrollHeight})},{handleScroll:O}=Se({fetchData:g=>L("TikTok",{action:"getMessages",username:n.username,page:g}),onDataFetched:g=>c([...g.reverse(),...U]),isReversed:!0,perPage:25}),E=g=>{if(g)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(g)},w=g=>{P.fetchAndSetVideo(g,{single:!0}),f({view:"dm"})};return o(re.div,{...Fe,className:"dm-container",children:[o("div",{className:"dm-header",children:[e(ve,{onClick:()=>{s!=null&&s.view?(s.data&&s.data.identifier==="profile"&&R(s.data.data),p(s.view),f(null)):p("messages")},className:"chevron"}),o("div",{className:"profile",onClick:g=>{g.stopPropagation(),f({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e(Z,{avatar:n.avatar})}),o("div",{className:"username",children:[n.name??n.username,n.verified&&e(me,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:O,children:o("div",{className:"dm-body",children:[o("div",{className:"messages-hero","data-nomessages":U.length===0,children:[e(Z,{className:"avatar",avatar:n.avatar}),e("div",{className:"name",children:n.name}),o("div",{className:"secondary",children:[o("div",{className:"username",children:["@",n.username]}),o("div",{className:"stats",children:[o("div",{className:"following",children:[z(n.following_count)," ",(N=i("APPS.TIKTOK.FOLLOWING"))==null?void 0:N.toLowerCase()]}),o("div",{className:"followers",children:[z(n.follower_count)," ",(_=i("APPS.TIKTOK.FOLLOWERS"))==null?void 0:_.toLowerCase()]})]})]})]}),U.map((g,k)=>{var q;let x,Y=g.sender===d.username?"self":"other",ee=((q=U[k+1])==null?void 0:q.sender)===d.username?"self":"other";return U[k+1]?x=Math.abs(g.timestamp-U[k+1].timestamp)/36e5:ee=void 0,g.content&&E(g.content)&&(g.video=g.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],g.videoId=g.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),o("div",{className:le("message",Y),children:[Y=="other"?o("div",{className:"message-with-pfp",children:[e("div",{className:le("profile-picture",Y!==ee?"show":"hide"),onClick:se=>{se.stopPropagation(),f({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:e(Z,{avatar:n.avatar})}),e("div",{className:"message-content",children:g.video?o("div",{className:"shared-video",onClick:()=>w(g.videoId),children:[e("video",{src:g.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(g.content)})})]}):e(Q,{children:g.video?o("div",{className:"shared-video",onClick:()=>w(g.videoId),children:[e("video",{src:g.video,autoPlay:!1,controls:!1}),e(Oe,{})]}):e("div",{className:"content",children:Ke(g.content)})}),U[k+1]&&x>6?e("div",{className:"date",children:Ne(g.timestamp)}):Y!==ee&&e("div",{className:"date",children:Ne(g.timestamp)})]},k)})]})}),e("div",{className:"dm-footer",children:o("div",{className:"input",children:[e(ue,{type:"text",placeholder:i("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:D,onChange:g=>y(g.target.value),onKeyDown:g=>{g.key==="Enter"&&K()}}),e("div",{className:"buttons",children:F.trim().length>0&&e("div",{className:"send",onClick:K,children:e(Xe,{})})})]})})]})}function Ut(){return o("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function Dt({id:t,commentCount:u,username:h,close:P}){const{User:I}=l.useContext(B),[T]=I,[d,r]=l.useState([]),[a,p]=l.useState(""),[n,s]=l.useState(null),f=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{var c;ae("TikTok")&&L("TikTok",{action:"getComments",page:0,data:{id:t,creator:h}},{success:!0,comments:(c=$.Videos.find(S=>S.id===t))==null?void 0:c.commentsData}).then(S=>{if(!(S!=null&&S.success))return m("warning",S.error);r(S.comments)})},[]);const R=()=>{if(a.trim().length===0)return m("warning","Comment is empty");let c=n!=null&&n.isReplyToReply?`@${n.name} ${a}`:a;L("TikTok",{action:"postComment",data:{id:t,comment:c,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(S=>{if(!(S!=null&&S.success))return m("warning",S.error);r(n?v=>v.map(D=>D.id==n.id?{...D,reply_count:D!=null&&D.reply_count?D.reply_count+1:1,replies:[{id:S.id,username:T.username,avatar:T.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:T.verified},...(D==null?void 0:D.replies)||[]]}:D):v=>[{id:S.id,username:T.username,avatar:T.avatar,comment:c,timestamp:new Date().getTime(),likes:0,liked:!1,verified:T.verified},...v]),p(""),b.current.style.height="auto",s(null)})},{handleScroll:U}=Se({fetchData:c=>L("TikTok",{action:"getComments",data:{id:t,creator:h},page:c}),onDataFetched:c=>r(S=>[...S,...(c==null?void 0:c.comments)??[]]),perPage:15});return l.useEffect(()=>{const c=S=>{const v=f.current;v.scrollTo({top:v.scrollTop+S.deltaY,behavior:"smooth"})};return f.current&&f.current.addEventListener("wheel",c),()=>{f.current&&f.current.removeEventListener("wheel",c)}},[f]),e("div",{className:"comments-container",onClick:()=>P(),children:o(re.div,{...pe,className:"comments-wrapper",onClick:c=>c.stopPropagation(),children:[o("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:i("APPS.TIKTOK.COMMENTS_TITLE").format({count:u})}),e("div",{className:"close",children:e(we,{onClick:P})})]}),e("div",{className:"comments-body",ref:f,onScroll:U,children:d.map((c,S)=>e(Ye,{comment:c,videoId:t,username:h,remove:()=>r(v=>v.filter(D=>D.id!=c.id)),setReplyTo:s},c.id))}),o("div",{className:"comments-footer",children:[e(Z,{avatar:T.avatar}),o("div",{className:"input",children:[e(ue,{maxLength:300,ref:b,value:a,onChange:c=>{p(c.target.value);let S=c.target.scrollHeight;c.target.style.height=S+"px"},onKeyDown:c=>{c.key=="Enter"&&R(),c.key==" "&&p(S=>S+" ")},placeholder:n?i("APPS.TIKTOK.REPLY_TO").format({name:n.name}):i("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{W.Emoji.set({onSelect:c=>p(S=>S+c.emoji)})},children:e(Ut,{})}),a.trim().length>0&&e("span",{children:e(ye,{onClick:R})})]})]})]})})}const Ye=({videoId:t,username:u,comment:h,remove:P,setReplyTo:I})=>{var y,K,O;const{User:T}=l.useContext(B),[d]=T,[r,a]=l.useState(h),[p,n]=l.useState(r.likes),[s,f]=l.useState(r.liked===1),[b,R]=l.useState(r.creator_liked===1);l.useState(0),l.useState(!1),l.useState(!1);const[U,c]=l.useState(!1);l.useEffect(()=>{h&&a(h)},[h]);const S=()=>{L("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:u}},null).then(E=>{if(!(E!=null&&E.success))return m("warning",E.error);a(w=>({...w,replies:[...(w==null?void 0:w.replies)??[],...E.comments.filter(N=>w!=null&&w.replies?!w.replies.some(_=>_.id===N.id):!0)]})),c(!0)})},v=()=>{L("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!s},{success:!0}).then(E=>{if(!(E!=null&&E.success))return m("warning",E.error);d.username===u&&R(w=>!w),f(w=>!w),a(w=>({...w,liked:!w.liked}))})};ce("tiktok:updateCommentLikes",E=>{E.id===r.id&&n(w=>E.method==="add"?w+1:w-1)});let D=r.username!==d.username||u!==r.username||d.isAdmin;const F=Je(E=>{if(E.stopPropagation(),E.preventDefault(),!D)return m("warning","You cannot click to this comment!");let w=[(d.isAdmin||d.username===r.username)&&{title:i("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{L("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(N=>{if(!(N!=null&&N.success))return m("warning",N.error);P()})}}];W.ContextMenu.set({buttons:w})});return o("div",{className:"item","data-clickable":D,"data-id":r.id,children:[o("div",{className:"comment-info",...F,children:[e("div",{className:"avatar",children:e(Z,{avatar:r.avatar})}),o("div",{className:"comment-data",children:[o("div",{className:"username",children:[r.username,r.verified&&e(me,{}),r.username===u&&e("div",{className:"creator-badge",children:i("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),o("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ce(r.timestamp)}),e("div",{className:"reply",onClick:()=>{I(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:i("APPS.TIKTOK.REPLY")})]}),b&&e("div",{className:"creator-liked",children:i("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&o("div",{className:"replies",children:[(y=r.replies)==null?void 0:y.map(E=>e(Ye,{videoId:t,username:u,comment:{...E,replyTo:r.id},remove:()=>{a(w=>{var N;return{...w,reply_count:w.reply_count-1,replies:(N=w.replies)==null?void 0:N.filter(_=>_.id!==E.id)}})},setReplyTo:I})),!U&&((K=r.replies)==null?void 0:K.length)!==r.reply_count&&o("div",{className:"view-replies",onClick:S,children:[i("APPS.TIKTOK.VIEW_REPLIES")," ",o("b",{children:["(",r!=null&&r.replies?r.reply_count-(((O=r.replies)==null?void 0:O.length)??0):r.reply_count,")"]})," ",e(Me,{})]})]}),o("div",{className:"likes","data-active":s,onClick:v,children:[s?e(Ae,{}):e(Ze,{}),z(p)]})]})};function Ft({className:t}){return o("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:o("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function ke({data:t,active:u,preview:h}){var J,oe,ie;const{User:P,Func:I,ShareComponent:T,GoBack:d}=l.useContext(B),r=fe(de.Settings),[a]=P,[p,n]=T,[s,f]=l.useState(t==null?void 0:t.liked),[b,R]=l.useState(t==null?void 0:t.saved),[U,c]=l.useState(t==null?void 0:t.viewed),[S,v]=l.useState(t==null?void 0:t.likes),[D,F]=l.useState(t==null?void 0:t.saves),[y,K]=l.useState(t==null?void 0:t.comments),[O,E]=l.useState(!1),w=l.useRef(null),N=l.useRef(null),_=l.useRef(null),g=l.useRef(0),[k,x]=l.useState(!1),[Y,ee]=l.useState(!1),q=fe(Be),se=fe(ge),M=fe(Ie.LockScreenVisible);l.useEffect(()=>{var C,G;return u&&((C=t.music)!=null&&C.path&&ne(),(G=t.metadata)!=null&&G.tts&&H(),ee(!1)),()=>{N!=null&&N.current&&N.current.pause(),_!=null&&_.current&&_.current.pause(),!U&&u&&L("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{c(!0)})}},[u]),l.useEffect(()=>{var C,G,j;q!=null&&q.visible||!ae("TikTok")||M?(ee(!0),N!=null&&N.current&&N.current.pause(),_!=null&&_.current&&_.current.pause()):((j=(G=(C=ge)==null?void 0:C.value)==null?void 0:G.active)==null?void 0:j.name)==="TikTok"&&(ee(!1),N!=null&&N.current&&N.current.play().catch(()=>m("warning","TTS failed to play")),_!=null&&_.current&&_.current.play().catch(()=>m("warning","Music failed to play")))},[q==null?void 0:q.visible,se==null?void 0:se.active,M]);const H=()=>{var j,Te;if(!t.metadata.ttsUrl)return;N!=null&&N.current&&(N.current.pause(),N.current=null);const C=new Audio;C.src=t.metadata.ttsUrl;let G=((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?(Te=r==null?void 0:r.sound)==null?void 0:Te.volume:.5;C.volume=G/2,C.play().catch(()=>m("warning","TTS failed to play")),N.current=C},ne=()=>{var G,j;const C=new Audio;_!=null&&_.current&&(_.current.pause(),_.current=null),C.src=(G=t.music.path)!=null&&G.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,C.volume=t.music.volume*(((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?r.sound.volume:.5),C.play().catch(()=>m("warning","Music failed to play")),_.current=C};l.useEffect(()=>{var C,G,j,Te;(C=r==null?void 0:r.sound)!=null&&C.volume&&(w.current&&(w.current.volume=((G=r==null?void 0:r.sound)==null?void 0:G.volume)!==void 0?r.sound.volume:.5),_!=null&&_.current&&(_.current.volume=t.music.volume*(((j=r==null?void 0:r.sound)==null?void 0:j.volume)!==void 0?r.sound.volume:.5)),N!=null&&N.current&&(N.current.volume=(((Te=r==null?void 0:r.sound)==null?void 0:Te.volume)!==void 0?r.sound.volume:.5)/2))},[(J=r==null?void 0:r.sound)==null?void 0:J.volume]);const X=()=>{h||L("TikTok",{action:"toggleLike",id:t.id,toggle:!s},{success:!0}).then(C=>{if(!C.success)return m("warning",C.error);f(!s)})},A=()=>{h||-L("TikTok",{action:"toggleSave",id:t.id,toggle:!b},{success:!0}).then(C=>{if(!C.success)return m("warning",C.error);R(!b)})};ce("tiktok:updateLikes",C=>{if(C&&C.id===t.id)return v(G=>G+(C.method==="add"?1:-1))}),ce("tiktok:updateSaves",C=>{if(C&&C.id===t.id)return F(G=>G+(C.method==="add"?1:-1))}),ce("tiktok:updateComments",C=>{if(C&&C.id===t.id)return K(G=>(C.count=C.count??1,G+(C.method==="add"?C.count:-C.count)))});const V=C=>{if(C.detail===1)return ee(!Y);if(C.detail===2){if(!t.id)return;s||(X(),x(!0),setTimeout(()=>{x(!1)},1e3))}};return l.useEffect(()=>{const C=document.querySelector('.video[data-active="true"] video');if(!C)return m("warning","Video not found");Y?(C.pause(),N!=null&&N.current&&N.current.pause(),_!=null&&_.current&&_.current.pause(),m("info","paused everything")):(C.play().catch(()=>m("warning","Video failed to play")),N!=null&&N.current&&N.current.play().catch(()=>m("warning","TTS failed to play")),_!=null&&_.current&&_.current.play().catch(()=>m("warning","Music failed to play")),m("info","playing everything"))},[Y]),o(Q,{children:[e(Pe,{children:O&&!h&&e(Dt,{id:t.id,username:t.username,commentCount:y,close:()=>E(!1)})}),o("div",{className:"video","data-active":u,onClick:V,children:[k&&e("div",{className:"popup-heart","data-visible":k,children:e(xe,{})}),Y&&e("div",{className:"paused",children:e(Oe,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!u,ref:w,onTimeUpdate:C=>{var G,j;u&&(C.target.currentTime<g.current&&((G=t==null?void 0:t.music)!=null&&G.path&&ne(),(j=t==null?void 0:t.metadata)!=null&&j.ttsUrl&&(N.current.currentTime=0,N.current.play().catch(()=>m("warning","TTS failed to play")))),g.current=C.target.currentTime)},onLoadedMetadata:C=>{var G;u&&(C.currentTarget.volume=((G=r==null?void 0:r.sound)==null?void 0:G.volume)!==void 0?r.sound.volume:.5)}}),o("div",{className:"video-info",children:[o("div",{className:"user",children:[o("div",{className:"username",onClick:()=>{if(!h)return I.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(me,{})]}),o("span",{children:[" â€¢ ",Ce(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((oe=t==null?void 0:t.music)==null?void 0:oe.title)&&o("div",{className:"song",children:[e(Qe,{})," ",t.music.artist," - ",t.music.title]})]}),o("div",{className:"video-actions",children:[e(Z,{className:"profile",avatar:t.avatar,onClick:C=>{if(C.stopPropagation(),!h)return I.fetchAndSetProfile(t.username)}}),o("div",{className:"action","data-active":s,onClick:C=>{C.stopPropagation(),X()},children:[e(Ae,{className:"like"}),z(S)]}),o("div",{className:"action",onClick:C=>{C.stopPropagation(),E(!0)},children:[e(ze,{className:"comment"}),z(y)]}),o("div",{className:"action",onClick:C=>{C.stopPropagation(),A()},"data-active":b,children:[e(Ge,{className:"save"}),z(D)]}),e("div",{className:"action",onClick:C=>{C.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(a==null?void 0:a.username)===t.username?e(et,{className:"manage"}):o(Q,{children:[e(Ft,{className:"share"}),i("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e(tt,{src:(ie=t==null?void 0:t.music)==null?void 0:ie.cover,fallback:"./assets/img/icons/music/unknown.png"})})]})]})]})}function _e(){var se;const{View:t,Profile:u,FeedData:h,Func:P,GoBack:I}=l.useContext(B),T=fe(de.Settings),[d,r]=t,[a,p]=h,[n,s]=I,[f,b]=l.useState(0),[R,U]=l.useState(!1),[c,S]=l.useState(!1),[v,D]=l.useState("recent"),[F,y]=l.useState([]),[K,O]=l.useState(0),E=fe(ge),w=l.useRef(null);l.useEffect(()=>{var M;if(ae("TikTok")){if(d!=="feed"){N.current=!0;return}return b(0),S(!1),U(!1),y([]),(M=a==null?void 0:a.args)!=null&&M.single?(y([a.video]),O(0),g.current=0):L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:v,...a==null?void 0:a.args}},$.Videos).then(H=>{if(!H)return m("warning","No videos found");H.length<5&&S(!0),a&&(a!=null&&a.video)&&H.unshift(a.video),O(0),g.current=0,y(H)}),()=>{p(null)}}},[d]),l.useEffect(()=>{if(ae("TikTok")&&d==="feed")return setTimeout(()=>{de.Styles.TextColor.set("#ffffff")},100),()=>{de.Styles.TextColor.set(T.display.theme==="dark"?"#ffffff":"#000000"),de.SoundManager.reset()}},[d,E==null?void 0:E.active]);const N=l.useRef(!0);l.useEffect(()=>{if(ae("TikTok")&&!a){if(N.current){N.current=!1;return}y([]),L("TikTok",{action:"getVideos",page:0,data:{full:!0,type:v}},$.Videos).then(M=>{if(!M)return m("warning","No videos found");M.length<5&&S(!0),y(M),g.current=0,O(0)})}},[v,a]);const _=l.useRef(!1),g=l.useRef(0);l.useEffect(()=>{g.current=0,O(0),b(0),S(!1),U(!1)},[v]),l.useEffect(()=>{if(ae("TikTok")){if(F.length===0)return m("info","No videos found");if(F.length===1||F.length-2===K){if(m("info","fetching more videos: "+JSON.stringify(a)),a!=null&&a.single)return;if(R||c)return m("info","Already fetching or fetched everything");U(!0),L("TikTok",{action:"getVideos",page:f+1,data:{full:!0,type:v,...a==null?void 0:a.args}},null).then(M=>{M&&M.length>0?(M.length<5&&S(!0),y(H=>[...H,...M]),U(!1)):(m("info","Fetched everything"),U(!1),S(!0)),b(H=>H+1)})}}},[K]),l.useEffect(()=>{if(!F||F.length===0)return;const M=()=>{if(!_.current)return requestAnimationFrame(M);_.current=!1;const V=w.current,oe=document.querySelector(".video").getBoundingClientRect().height,ie=g.current*oe;m("info",`Target scroll position: ${ie}, current scroll position: ${V.scrollTop}, snapIndex: ${g.current}`),V.scrollTo({top:ie,behavior:"smooth"}),O(g.current),requestAnimationFrame(M)};requestAnimationFrame(M);const H=V=>{var J,oe;V.preventDefault(),!((oe=(J=Be)==null?void 0:J.value)!=null&&oe.visible)&&k(V)},ne=["ArrowUp","ArrowDown","Space"],X=V=>{var J;(ne.includes(V.key)||ne.includes(V.code))&&!document.querySelector(".tiktok-content")&&((J=E==null?void 0:E.active)==null?void 0:J.name)==="TikTok"&&V.preventDefault(),(V.key==="ArrowUp"||V.key==="ArrowDown")&&x(V.key==="ArrowUp"?-1:1)},A=w.current;return A.addEventListener("wheel",H,{passive:!1}),window.addEventListener("keydown",X),()=>{m("info","Removing event listeners (space button)"),A.removeEventListener("wheel",H),window.removeEventListener("keydown",X)}},[F]);const k=M=>{if(M.preventDefault(),ee())return;const ne=M.deltaY<0?-1:1;x(ne)},x=M=>{const ne=F.length-1,X=g.current+M;X>=0&&X<=ne?(g.current=X,_.current=!0,m("info","Scrolling to video: "+g.current)):X<0?m("info","Top of the feed, trying to scroll up?"):m("info","Reached the bottom of the feed")},Y=M=>{M.button===1&&M.preventDefault()},ee=()=>!!document.querySelector(".comments-container");let q=d==="feed";return e("div",{className:"tiktok-feed",style:{visibility:q?"visible":"hidden"},children:o(re.div,{className:"feed-wrapper",...We("right",d),children:[!a&&e("div",{className:"feed-header",children:o("div",{className:"feed-header-content",children:[e("div",{className:le("item",v=="following"&&"active"),onClick:()=>D("following"),children:i("APPS.TIKTOK.FOLLOWING")}),e("div",{className:le("item",v=="recent"&&"active"),onClick:()=>D("recent"),children:i("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":v==="recent"?"right":"left"})]})}),v==="following"&&F.length===0&&e("div",{className:"no-following",children:i("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((se=a==null?void 0:a.args)==null?void 0:se.username)||(n==null?void 0:n.view))&&e(ve,{className:"go-back",onClick:()=>{p(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(r(n.view),s(null)):P.fetchAndSetProfile(a.args.username)}}),e("div",{className:"videos",ref:w,onMouseDown:Y,children:F==null?void 0:F.map((M,H)=>e(ke,{data:M,active:K===F.indexOf(M)&&q},H))})]})})}function yt(){const{User:t,LoggedIn:u,View:h}=l.useContext(B),[P,I]=t,[T,d]=u,[r,a]=h,[p,n]=l.useState("login"),[s,f]=l.useState(null),[b,R]=l.useState(!0),U=()=>{var S;if(b)return m("warning","Button is disabled");if(!s)return m("warning","No form data");let c=(S=s==null?void 0:s.username)==null?void 0:S.toLowerCase().replace(/\s/g,"");if(p==="signup"){let v=c.match(he.value.UsernameFilter);if(!v||(v==null?void 0:v[0])!==c||c.length<3||c.length>15){m("warning","Username did not match regex"),W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i("APPS.INSTAGRAM.USERNAME_NOT_ALLOWED"),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});return}}L("TikTok",{action:p,data:s}).then(v=>{var D,F,y,K,O,E;if(!v)return m("warning","Could not login, no response");if(v.success){let w={...v.data,username:((D=v.data)==null?void 0:D.username)??c,name:((F=v.data)==null?void 0:F.username)??(s==null?void 0:s.name),follower_count:((y=v.data)==null?void 0:y.follower_count)||0,following_count:((K=v.data)==null?void 0:K.following_count)||0,like_count:((O=v.data)==null?void 0:O.like_count)||0};I(w),d(!0),a("feed"),te.APPS.TIKTOK.account.set(w)}else{if(v.error)return W.PopUp.set({title:i("APPS.INSTAGRAM.ERROR"),description:i(`APPS.INSTAGRAM.${(E=v.error)==null?void 0:E.toUpperCase()}`),buttons:[{title:i("APPS.INSTAGRAM.OK")}]});m("info",`Could not login, ${v.error}`)}})};return l.useEffect(()=>{var c,S;s&&R(p==="login"?!s.username||!s.password:!s.name||!s.username&&((c=s.username)==null?void 0:c.length)<3||!s.password&&((S=s.password)==null?void 0:S.length)<3)},[s]),o("div",{className:"login-container",children:[o("div",{className:"login-header",children:[e("div",{className:"title",children:p==="login"?i("APPS.TIKTOK.LOGIN_TITLE"):i("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:p==="login"?i("APPS.TIKTOK.LOGIN_SUBTITLE"):i("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),o("div",{className:"login-body",children:[p==="signup"&&e(ue,{placeholder:i("APPS.TIKTOK.NAME"),onChange:c=>{c.target.value.length>30||f({...s,name:c.target.value})}}),e(ue,{placeholder:i("APPS.TIKTOK.USERNAME"),onChange:c=>{c.target.value.length>20||f({...s,username:c.target.value.toLowerCase()})}}),e(ue,{type:"password",placeholder:i("APPS.TIKTOK.PASSWORD"),onChange:c=>{c.target.value.length>50||f({...s,password:c.target.value})}}),e("div",{className:"login-button","data-disabled":b,onClick:U,children:p==="login"?i("APPS.TIKTOK.LOGIN"):i("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:p==="login"?o(Q,{children:[i("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:i("APPS.TIKTOK.SIGNUP")})]}):o(Q,{children:[i("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:i("APPS.TIKTOK.LOGIN")})]})})]})}function Vt(){const{User:t,Profile:u,View:h,LoggedIn:P,UserPanel:I,Func:T,GoBack:d,Dm:r}=l.useContext(B),[a,p]=t,[n,s]=u,[f,b]=P,[R,U]=I,[c,S]=d,[v,D]=r,[F,y]=h,[K,O]=l.useState([]),[E,w]=l.useState(!1),[N,_]=l.useState("recent"),[g,k]=l.useState((n==null?void 0:n.follower_count)||0),[x,Y]=l.useState((n==null?void 0:n.following_count)||0),ee=[{value:"recent",icon:e(nt,{})},{value:"liked",icon:n!=null&&n.show_likes?e(xe,{}):e(it,{})},{value:"saved",hidden:(a==null?void 0:a.username)!==(n==null?void 0:n.username),icon:e(Ge,{})}],q=[{label:i("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:i("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:i("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];l.useEffect(()=>{ae("TikTok")&&n&&(k((n==null?void 0:n.follower_count)||0),Y((n==null?void 0:n.following_count)||0),O([]),!(N==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username)&&L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:N},page:0},$.Videos.filter(A=>A.username===n.username)).then(A=>{if(!A)return m("warning","Failed to get videos");O(A)}))},[N,n==null?void 0:n.username]);const{handleScroll:se}=Se({fetchData:A=>L("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:N},page:A}),onDataFetched:A=>O(V=>[...V,...A]),perPage:25}),M=A=>{L("TikTok",{action:"toggleFollow",data:{username:n.username,follow:A}},{success:!0}).then(V=>{if(!V||!(V!=null&&V.success))return m("warning","Failed to toggle follow");if(V.error)return m("error",V.error);m("info",`Toggling follow to ${A}`),s({...n,isFollowing:A})})};ce("tiktok:updateFollowers",A=>{if(!A||A.username!==n.username)return;let V=g+(A.method==="add"?1:-1);s({...n,follower_count:V}),k(V)}),ce("tiktok:updateFollowing",A=>{if(!A||A.username!==n.username)return;let V=x+(A.method==="add"?1:-1);s({...n,following_count:V}),Y(V)});const H=()=>{a.username===n.username&&L("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(A=>{var oe;if(!A)return m("info","No accounts found");let V=a.isAdmin,J=(oe=A==null?void 0:A.filter(ie=>ie!==a.username))==null?void 0:oe.map(ie=>({title:ie,cb:()=>{ie!==a.username&&L("AccountSwitcher",{action:"switch",app:"TikTok",account:ie}).then(()=>{L("TikTok",{action:"isLoggedIn"}).then(C=>{C?(te.APPS.TIKTOK.account.set(C),p({...C,isAdmin:V}),y("feed"),b(!0)):te.APPS.TIKTOK.account.set(null)})})}}));W.ContextMenu.set({buttons:[...J,{title:i("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{b(!1)}}]})})},ne=A=>{p(A),s(A),w(!1)},X=()=>{a.username!==n.username&&L("TikTok",{action:"getChannelId",username:n.username}).then(A=>{D({id:A.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),S({view:"profile",data:{identifier:"profile",data:n}}),y("dm"),s(null)})};return n?o(Q,{children:[e(Pe,{children:E&&e(Mt,{close:A=>ne(A)})}),o(re.div,{className:"profile-container",children:[o("div",{className:"profile-header",children:[n.username===a.username?e("span",{}):e("div",{children:e(ve,{className:"go-back",onClick:()=>{var A,V;if(c!=null&&c.view){if(c!=null&&c.data)switch((A=c==null?void 0:c.data)==null?void 0:A.identifier){case"dm":D((V=c==null?void 0:c.data)==null?void 0:V.data),y("dm");break;default:y("feed"),s(null)}else y(c==null?void 0:c.view);S(null)}else y("feed");s(null)}})}),o("div",{className:"name",onClick:H,children:[n.name,a.username===n.username&&e(Me,{})]}),e("span",{})]}),o("div",{className:"profile-info",onScroll:se,children:[e("div",{className:"avatar",children:e(Z,{avatar:n.avatar})}),o("div",{className:"username",children:["@",n.username,n.verified&&e(me,{})]}),e("div",{className:"stats",children:q.map((A,V)=>{let J={followers:g,following:x};return o("div",{className:"item","data-cursor":A.name!==void 0,onClick:()=>{A.name&&U({value:A.name,username:n.username,following:x,followers:g})},children:[e("div",{className:"value",children:z(J[A.name]??n.like_count)}),e("div",{className:"label",children:A.label})]},V)})}),o("div",{className:"actions",children:[a.username===n.username?e("div",{className:"button big",onClick:()=>w(!0),children:i("APPS.TIKTOK.EDIT_PROFILE")}):e(Q,{children:n.isFollowing?o(Q,{children:[e("div",{className:le("button","big"),onClick:X,children:i("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>M(!1)}]})},children:e(st,{})})]}):o(Q,{children:[e("div",{className:"button follow",onClick:()=>M(!0),children:i("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:X,children:e(Ve,{})})]})}),n.instagram&&e("div",{className:"button instapic",onClick:()=>{ge.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button birdy",onClick:()=>{ge.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),o("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:ee.filter(A=>!A.hidden).map(A=>e("div",{className:le("item",N===A.value&&"active"),onClick:()=>_(A.value),children:A.icon}))}),o("div",{className:"feed",children:[N==="liked"&&!(n!=null&&n.show_likes)&&a.username!==n.username&&o("div",{className:"private",children:[e("div",{className:"title",children:i("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:i("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),K.map((A,V)=>e(Rt,{data:A,onClick:()=>{S({...c,ignoreFeed:!0}),T.fetchAndSetVideo(A.id,{username:n.username,id:A.id,type:N})}}))]})]})]})]})]}):null}const Rt=({data:t,onClick:u})=>o("div",{className:"item",onClick:u,children:[e("video",{src:t.src,loop:!0,onMouseEnter:h=>{var P;return(P=h.currentTarget)==null?void 0:P.play().catch(()=>m("warning","Failed to play video"))},onMouseLeave:h=>{var P;return(P=h.currentTarget)==null?void 0:P.pause()},muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),o("div",{className:"views",children:[e(De,{}),z(t.views)]})]}),Mt=t=>{var f,b,R,U,c,S;const{User:u,LoggedIn:h,View:P}=l.useContext(B),[I,T]=u,[d,r]=h,[a,p]=l.useState(null),n=["instagram","twitter"];l.useEffect(()=>{p({name:I.name,bio:I.bio,avatar:I.avatar,instagram:I.instagram,twitter:I.twitter,show_likes:I.show_likes})},[]);const s=()=>{L("TikTok",{action:"updateProfile",data:a},{success:!0}).then(v=>{if(!v)return m("warning","No response from server");if(v.success)te.APPS.TIKTOK.account.set({...I,...a}),t.close({...I,...a});else switch(m("error",v.error),v.error){case"invalid_twitter":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.TWITTER.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":W.PopUp.set({title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:i("APPS.INSTAGRAM.TITLE")}),description:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:i("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:i("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return o(re.div,{...pe,className:"edit-profile-container",children:[o("div",{className:"edit-profile-header",children:[e("div",{children:e(ve,{onClick:s})}),e("div",{className:"title",children:i("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),o("div",{className:"edit-profile-content",children:[o("div",{className:"avatar",children:[o("div",{className:"image",onClick:()=>{var v,D,F;return W.Gallery.set({allowExternal:(F=(D=(v=he)==null?void 0:v.value)==null?void 0:D.AllowExternal)==null?void 0:F.Trendy,onSelect:y=>p({...a,avatar:y.src})})},children:[e(Z,{avatar:a==null?void 0:a.avatar}),e(ot,{})]}),i("APPS.TIKTOK.CHANGE_PHOTO")]}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.NAME")}),e(ue,{type:"text",defaultValue:a==null?void 0:a.name,onChange:v=>{v.target.value.length<=30&&p({...a,name:v.target.value})}})]}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.USERNAME")}),e(ue,{type:"text",disabled:!0,value:I.username})]}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.BIO")}),e($e,{placeholder:i("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:a==null?void 0:a.bio,onChange:v=>{v.target.value.length<=150&&p({...a,bio:v.target.value})}})]}),e("div",{className:"break"}),n.map((v,D)=>o("div",{className:"item",children:[e("div",{className:"label",children:Ee(v)}),e("div",{className:"value",onClick:()=>{a!=null&&a[v]?W.PopUp.set({title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)}),description:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)}),buttons:[{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:i("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{p({...a,[v]:null})}}]}):L("AccountSwitcher",{action:"getAccounts",app:Ee(v)}).then(F=>{F||m("info","No accounts found");let y=(F==null?void 0:F.map(K=>({title:K,cb:()=>{p({...a,[v]:K})}})))??[];W.ContextMenu.set({buttons:[...y]})})},children:a!=null&&a[v]?`@${a==null?void 0:a[v]}`:i("APPS.TIKTOK.ADD_ACCOUNT").format({name:i(`APPS.${v.toUpperCase()}.TITLE`)})})]},D)),e("div",{className:"break"}),o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.SHOW_LIKES")}),e(Nt,{checked:a==null?void 0:a.show_likes,onChange:()=>{p({...a,show_likes:!(a!=null&&a.show_likes)})}})]})]}),o("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{W.PopUp.set({title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:i("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"logout"},!0).then(v=>{if(!v)return m("warning","Failed to logout");te.APPS.TIKTOK.account.set(null),r(!1)})}}]})},children:i("APPS.TIKTOK.LOGOUT")}),((R=(b=(f=he)==null?void 0:f.value)==null?void 0:b.ChangePassword)==null?void 0:R.Trendy)&&e("div",{className:"button red",onClick:()=>at("TikTok",()=>{}),children:i("APPS.TIKTOK.CHANGE_PASSWORD")}),((S=(c=(U=he)==null?void 0:U.value)==null?void 0:c.DeleteAccount)==null?void 0:S.Trendy)&&e("div",{className:"button red",onClick:()=>{lt("TikTok",()=>{r(null),T(null),te.APPS.TIKTOK.account.set(null)})},children:i("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function xt(){var c,S,v,D,F,y,K;const{View:t,User:u}=l.useContext(B),[h]=u,[P,I]=t,[T,d]=l.useState(0),[r,a]=l.useState(!1),[p,n]=l.useState("en_us_001"),[s,f]=l.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[b,R]=l.useState(!1);l.useEffect(()=>{R(s.src&&s.caption)},[s]),l.useEffect(()=>{var O,E,w;switch(T){case 0:W.Gallery.set({allowExternal:(w=(E=(O=he)==null?void 0:O.value)==null?void 0:E.AllowExternal)==null?void 0:w.Trendy,includeVideos:!0,includeImages:!1,onSelect:N=>{f({...s,src:N.src}),d(_=>_+1)}});break}},[T]);const U=()=>{var O,E;L("TikTok",{action:"uploadVideo",data:{src:s.src,caption:s.caption,metadata:((O=s.metadata)==null?void 0:O.ttsUrl)&&s.metadata,music:((E=s.music)==null?void 0:E.path)&&{path:s.music.path,volume:s.music.volume}}},{success:!0}).then(w=>{if(!w||w.error)return m("warning","Failed to upload video, error: "+w.error);if(!w.success)return m("warning","Failed to upload video");I("feed")})};return o("div",{className:"upload-container",children:[r&&e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:((S=(c=de.Settings)==null?void 0:c.value)==null?void 0:S.display.theme)==="dark"?"#fff":"#000"})}),T!==0&&o(Q,{children:[o("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(T===2)return d(O=>O-1);if(T===1)return I("feed")},children:T===2?i("APPS.TIKTOK.GO_BACK"):i("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:i("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!b,onClick:()=>{if(b){if(T===2)return U();s!=null&&s.metadata.tts?(a(!0),Wt(s.metadata.tts,p).then(O=>{a(!1),f({...s,metadata:{...s.metadata,ttsUrl:O}}),d(E=>E+1)}).catch(O=>{a(!1),W.PopUp.set({title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:i("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{d(E=>E+1)}}]})})):d(O=>O+1)}},children:T===1?i("APPS.TIKTOK.PREVIEW"):i("APPS.TIKTOK.SHARE")})]}),o("div",{className:"upload-body",children:[T===1&&o(Q,{children:[e("div",{className:"video-placeholder",children:e("video",{src:s.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),o("div",{className:"form",children:[o("div",{className:"item",children:[e("div",{className:"label",children:i("APPS.TIKTOK.CAPTION")}),e(ue,{defaultValue:s.caption,placeholder:i("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:O=>{if(O.target.value.length<=100)return f({...s,caption:O.target.value})}})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[i("APPS.TIKTOK.TTS")," ",o("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),e($e,{defaultValue:(v=s==null?void 0:s.metadata)==null?void 0:v.tts,placeholder:i("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:O=>{if(O.target.value.length<=300)return f({...s,metadata:{...s.metadata,tts:O.target.value}})}}),((D=s==null?void 0:s.metadata)==null?void 0:D.tts)&&e("select",{onChange:O=>n(O.target.value),children:(y=(F=he)==null?void 0:F.value.TikTokTTS)==null?void 0:y.map(O=>e("option",{value:O[1],selected:O[1]===p,children:O[0]}))})]}),o("div",{className:"item",children:[o("div",{className:"label",children:[i("APPS.TIKTOK.MUSIC")," ",o("span",{children:["(",i("APPS.TIKTOK.OPTIONAL"),")"]})]}),o("div",{className:"button",onClick:()=>W.MusicSelector.set({onSelect:O=>f({...s,music:{...s.music,...O}})}),children:[s.music?s.music.title:i("APPS.TIKTOK.SELECT_MUSIC"),e(we,{onClick:O=>{O.stopPropagation(),f({...s,music:null})}})]}),((K=s.music)==null?void 0:K.title)&&o("div",{className:"slider",children:[e(rt,{}),e(It,{min:0,max:.5,step:.025,value:s.music.volume!==void 0?s.music.volume:.25,onChange:O=>f({...s,music:{...s.music,volume:O}})}),e(ct,{})]})]})]})]}),T===2&&e("div",{className:"preview",children:e(ke,{data:{...s,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:h.username,avatar:h.avatar??`./assets/img/avatar-placeholder-${de.Settings.value.display.theme}.svg`,verified:h.verified,music:s.music},active:!0,preview:!0})})]})]})]})}const Gt=async(t,u,h)=>{const P=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:u,voice:h})});if(!P.ok)throw new Error(`Fetch error: ${P.status} ${P.statusText}`);return P.json()},Bt=async(t,u)=>{const h=await Gt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,u);if(h.success&&h.data)return h.data;throw h},Wt=async(t,u)=>{try{const h=await Bt(t,u),I=await(await fetch(`data:application/octet-stream;base64,${h}`)).arrayBuffer(),T=new Uint8Array(I),d=new Blob([T],{type:"audio/mp3"});return await dt("Audio",d)}catch(h){throw h}};function Ht(){const{View:t,User:u,Profile:h,FeedData:P}=l.useContext(B),[I,T]=u,[d,r]=t,[a,p]=h,[n,s]=P,f=[{value:"feed",label:i("APPS.TIKTOK.HOME"),activeIcon:e(ut,{}),icon:e(mt,{}),cb:()=>{r("feed"),s(null)}},{value:"discover",label:i("APPS.TIKTOK.DISCOVER"),activeIcon:e(ft,{}),icon:e(ht,{})},{value:"upload",label:i("APPS.TIKTOK.UPLOAD"),activeIcon:e(Le,{}),icon:e(Le,{})},{value:"inbox",label:i("APPS.TIKTOK.INBOX"),activeIcon:e(vt,{}),icon:e(Re,{})},{value:"profile",label:i("APPS.TIKTOK.PROFILE"),activeIcon:e(Tt,{}),icon:e(Pt,{}),cb:()=>{p(I),r("profile")}}];return e("div",{className:"tiktok-footer","data-feed":d==="feed",children:f.map((b,R)=>{let U=d===b.value;return o("div",{className:"item","data-active":U,onClick:()=>b.cb?b.cb():r(b.value),children:[U?b.activeIcon:b.icon,b.label]},R)})})}function $t(){const{User:t,ShareComponent:u,View:h}=l.useContext(B),[P]=t,[I,T]=h,[d,r]=u,[a,p]=l.useState([]);l.useState(!1);const[n,s]=l.useState(d==null?void 0:d.pinned);return l.useEffect(()=>{L("TikTok",{action:"getRecentMessages"},{success:!0,channels:$.Messages}).then(f=>{if(!(f!=null&&f.success))return m("warning",f.error);p(f.channels.sort((b,R)=>R.timestamp-b.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>r(null),children:o(re.div,{...pe,className:"share-wrapper",onClick:f=>f.stopPropagation(),children:[e("div",{className:"share-header",children:i("APPS.TIKTOK.SHARE_TITLE")}),o("div",{className:"share-body",children:[e("div",{className:"friends",children:a.map(f=>e(Zt,{data:{username:f.username,name:f.name,avatar:f.avatar,verified:f.verified}}))}),o("div",{className:"options",children:[o("div",{className:"item",children:[e(gt,{}),i("APPS.TIKTOK.REPORT")]}),P.username===(d==null?void 0:d.username)&&o(Q,{children:[o("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?i("APPS.TIKTOK.UNPIN"):i("APPS.TIKTOK.PIN")}),buttons:[{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{L("TikTok",{action:"togglePinnedVideo",id:d==null?void 0:d.id,toggle:!n},{success:!0}).then(f=>{if(f!=null&&f.success||m("warning",f.error),f!=null&&f.error&&f.error==="max_pinned")return W.PopUp.set({title:i("APPS.TIKTOK.MAX_PINNED_TITLE"),description:i("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.OK")}]});s(!n)})}}]})},children:[e(pt,{}),n?i("APPS.TIKTOK.UNPIN_VIDEO"):i("APPS.TIKTOK.PIN_VIDEO")]}),o("div",{className:"item",onClick:()=>{W.PopUp.set({title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:i("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{L("TikTok",{action:"deleteVideo",id:d==null?void 0:d.id},{success:!0}).then(f=>{f!=null&&f.success||m("warning",f.error),r(null),T("profile")})}}]})},children:[e(St,{}),i("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>r(null),children:i("APPS.TIKTOK.CANCEL")})]})})}const Zt=t=>{const{ShareComponent:u}=l.useContext(B),[h]=u,[P,I]=l.useState(!1);return o("div",{className:"item","data-sent":P,onClick:()=>{if(P)return m("warning","You have already sent this video to this user!");L("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${h.src}"ID="${h.id}"!>`}},{success:!0}).then(d=>{if(!(d!=null&&d.success))return m("warning",d.error);m("info","Successfully sent video to user!"),I(!0)})},children:[e(Z,{avatar:t.data.avatar}),e("div",{className:"name",children:t.data.name}),P&&e(be,{className:"checkmark"})]})};function zt(){const{UserPanel:t}=l.useContext(B),[u,h]=t,[P,I]=l.useState([]),[T,d]=l.useState(u==null?void 0:u.value),r={following:"getFollowing",followers:"getFollowers"},a={following:i("APPS.TIKTOK.FOLLOWING"),followers:i("APPS.TIKTOK.FOLLOWERS")},p=(s,f)=>{var R,U;return(s===i("APPS.TIKTOK.FOLLOWING")?(R=$.Accounts[f])==null?void 0:R.following:((U=$.Accounts[f])==null?void 0:U.followers)??[]).map(c=>$.Accounts[c])};l.useEffect(()=>{!u||!(u!=null&&u.value)||T&&L("TikTok",{action:r[T],username:u.username,page:0},p(r[T],u.username)).then(s=>{if(!s)return m("warning","No data returned from tiktok event");I(s)})},[T]);const{handleScroll:n}=Se({fetchData:s=>L("TikTok",{action:r[u.value],username:u.username,page:s}),onDataFetched:s=>I([...P,...s]),perPage:15});return o(re.div,{...pe,className:"userpanel-container",children:[o("div",{className:"userpanel-header",children:[e("div",{onClick:()=>h(null),children:e(ve,{})}),e("div",{className:"title",children:u==null?void 0:u.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(s=>o("div",{className:"item","data-active":T===s,onClick:()=>d(s),children:[a[s]," ",z(u==null?void 0:u[s])??0]}))}),e("div",{className:"userpanel-content",onScroll:n,children:P.map((s,f)=>e(Yt,{data:s}))})]})}const Yt=({data:t})=>{const{Func:u,UserPanel:h}=l.useContext(B),[P,I]=h,[T,d]=l.useState(t.isFollowing),r=a=>{L("TikTok",{action:"toggleFollow",data:{username:t.username,follow:a}}).then(p=>{if(!p||!(p!=null&&p.success))return m("warning","Failed to toggle follow");if(p.error)return m("error",p.error);d(a)})};return o("div",{className:"item",onClick:()=>{u.fetchAndSetProfile(t.username),I(null)},children:[o("div",{className:"item-user",children:[e("div",{className:"avatar",children:e(Z,{avatar:t.avatar})}),o("div",{className:"user",children:[o("div",{className:"name",children:[t.name," ",t.verified&&e(me,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:le("button",T?"following":"follow"),onClick:a=>{a.stopPropagation(),T?W.PopUp.set({title:i("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:i("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:i("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:T?i("APPS.TIKTOK.UNFOLLOW"):i("APPS.TIKTOK.FOLLOW")})})]})};const B=l.createContext(null);function Qt(){const t=fe(de.Settings),[u,h]=l.useState(null),[P,I]=l.useState("feed"),[T,d]=l.useState(null),[r,a]=l.useState(null),[p,n]=l.useState(null),[s,f]=l.useState(null),[b,R]=l.useState(null),[U,c]=l.useState(null),[S,v]=l.useState(!1),[D,F]=l.useState(null),[y,K]=l.useState(!0),[O,E]=l.useState(!0);l.useEffect(()=>{L("isAdmin",null,!1).then(g=>{if(te.APPS.TIKTOK.account.value){h({...te.APPS.TIKTOK.account.value,isAdmin:g}),v(!0),K(!1);return}else if(te.APPS.TIKTOK.account.value===!1)return K(!1);L("TikTok",{action:"isLoggedIn"},$.Account).then(k=>{k?(te.APPS.TIKTOK.account.set(k),h({...k,isAdmin:g}),v(!0),K(!1)):(te.APPS.TIKTOK.account.set(!1),K(!1))})})},[]),ce("tiktok:logout",g=>{if(!g)return m("warning","No username provided to logout");if(!S)return m("info","User is not logged in, cannot log out");g===(u==null?void 0:u.username)&&(v(!1),h(null),te.APPS.TIKTOK.account.set(null))}),l.useEffect(()=>{P==="feed"&&T||P==="profile"&&(T==null?void 0:T.username)!==u.username?E(!1):E(!0)},[T]);const w={profile:e(Vt,{}),video:e(ke,{}),discover:e(Ot,{}),inbox:e(Lt,{}),messages:e(kt,{}),dm:e(bt,{}),upload:e(xt,{}),feed:e(_e,{})},N=g=>{if(!g)return m("warning","Couldn't fetch profile (no username provided)");m("info",`Fetching profile ${g}`),L("TikTok",{action:"getProfile",username:g},$.Accounts.find(k=>k.username===g)).then(k=>{if(!k)return m("warning","Couldn't fetch profile");d(k),I("profile")})},_=(g,k)=>{L("TikTok",{action:"getVideo",id:g},{video:$.Videos.find(x=>x.id===g)}).then(x=>{if(!x)return m("warning","Couldn't fetch video");if(x.error)return m("warning",x.error);if(!(x!=null&&x.video))return m("warning","Couldn't fetch video");R({video:x.video,args:k}),I("feed")})};return e(B.Provider,{value:{User:[u,h],View:[P,I],Profile:[T,d],LoggedIn:[S,v],FeedData:[b,R],UserPanel:[p,n],ShareComponent:[s,f],GoBack:[U,c],Video:[D,F],Dm:[r,a],Func:{fetchAndSetProfile:N,fetchAndSetVideo:_}},children:y||!Ct()?e("div",{className:"loading",children:e(He,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":P==="feed",children:S===!0?o(Q,{children:[o("div",{className:"tiktok-wrapper","data-profile":!O,children:[e(_e,{}),P!=="feed"&&e(re.div,{...We(P=="discover"||P=="messages"?"right":"left",P),className:"tiktok-content",children:w==null?void 0:w[P]}),e(Pe,{children:p&&e(zt,{})})]}),e(Pe,{children:s&&e($t,{})}),O&&e(Ht,{})]}):e(yt,{})})})}const Ce=t=>{if(!t)return;const u=new Date(t),P=new Date().getTime()-u.getTime(),I=Math.floor(P/(1e3*3600*24)),T=Math.floor(P/(1e3*3600)),d=Math.floor(P/(1e3*60)),r=Math.floor(P/1e3);return I>0?`${u.getMonth()+1}-${u.getDate()}`:T>0?`${T}h`:d>0?`${d}m`:r>0?`${r}s`:i("NOW")};function z(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,Qt as default,Ce as formatDate,z as formatNumber};
