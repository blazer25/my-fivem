import{r as o,u as T,j as s,m as D,S as K,a as t,I as fe,L as a,F as R,C as _,b as j,P as p,g as ee,c as re,d as F,e as Ae,f as Oe,h as Y,i as x,A as q,k as Se,l as W,n as Ne,o as ye,p as Ie,q as ke,s as de,t as y,v as H,w as M,x as me,y as pe,z as He,B as we,D as Te,E as _e,G as ue,H as ce,J as Re,K as oe,M as Pe,N as ge,O as De,Q as be,R as Me,T as Ue,U as Ve,V as xe,W as he,X as $e,Y as Be,Z as Fe,_ as Ke,$ as Ge}from"./index-569b241b.js";function Xe(){var B,v,I,b,w,u;const{View:r,Contact:E}=o.useContext(J),n=T(p.Settings),h=T(p.PhoneNumber),[c,S]=o.useState(null),[d,O]=r,[e,l]=E,N=T(M.APPS.PHONE.contacts),[f,m]=o.useState(!1),[P,g]=o.useState(!1);o.useEffect(()=>S(e.number),[]);const C=()=>{y("Phone",{action:"removeContact",number:e.number},!0).then(i=>{if(!i)return H("warning","Failed to remove contact");M.APPS.PHONE.contacts.set(N.filter(A=>A.number!==e.number)),l(null),O("Contacts")})},L=()=>{y("Phone",{action:"toggleBlock",number:e.number,blocked:!e.blocked},!0).then(i=>{if(i===void 0)return H("warning","Failed to toggle block");l({...e,blocked:!e.blocked}),M.APPS.PHONE.contacts.set(N.map(A=>A.number===e.number?{...A,blocked:!A.blocked}:A))})},k=()=>{y("Phone",{action:"toggleFavourite",number:e.number,favourite:!e.favourite},!0).then(i=>{if(!i)return H("warning","Failed to toggle favourite");l({...e,favourite:!e.favourite}),M.APPS.PHONE.contacts.set(N.map(A=>A.number===e.number?{...A,favourite:!A.favourite}:A))})},G=()=>{if(!e.number||e.number.length===0)return O("Contacts");e.number===h?(p.Settings.patch({name:e.firstname,avatar:e.avatar??n.avatar,address:e.address,email:e.email}),y("setPhoneName",e.firstname),y("setSettings",p.Settings.value),m(i=>!i),M.APPS.PHONE.contacts.set(N.map(i=>i.number===e.number?{...i,...e}:i))):(e.lastname=e.lastname??"",y("Phone",{action:"updateContact",data:{...e,oldNumber:c}},!0).then(i=>{if(!i)return H("warning","Failed to update contact");M.APPS.PHONE.contacts.set(N.map(A=>A.number===c?{...A,...e}:A)),m(A=>!A),S(e.number)}))},z=()=>{e&&_.PopUp.set({title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:a("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:a("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{y("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(i=>{i&&y("Messages",{action:"sendMessage",number:e.number,content:`<!SENT-LOCATION-X=${me(i.x,2)}Y=${me(i.y,2)}!>`,attachments:[]}).then(A=>{if(!A)return H("warning","something went wrong while sending location");q.patch({active:{name:"Messages",view:"messages",data:{number:e.number,name:e.firstname&&Y(e.firstname,e.lastname),avatar:e.avatar}}})})})}}]})},X=o.useRef(!0);return o.useEffect(()=>{X.current&&X.current&&(S(e.number),X.current=!1,g(e.number===h))},[e]),s(D.div,{...K("right","contact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[f?t("span",{}):s("div",{className:"back",onClick:()=>{O(e.from),l(null)},children:[t(fe,{}),a(`APPS.PHONE.${(B=e.from)==null?void 0:B.toUpperCase()}.TITLE`)]}),e.firstname&&!e.company&&t("span",{onClick:()=>{f?G():m(i=>!i)},children:f?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:f?t(R,{children:s("div",{className:"contact nohover",children:[s("div",{className:"user",onClick:()=>{_.ContextMenu.set({buttons:[{title:a("APPS.PHONE.CONTACTS.CHANGE_AVATAR"),cb:()=>{var i,A,$;_.Gallery.set({allowExternal:($=(A=(i=j)==null?void 0:i.value)==null?void 0:A.AllowExternal)==null?void 0:$.Other,onSelect:te=>l({...e,avatar:te.src})})}},{title:a("APPS.PHONE.CONTACTS.REMOVE_AVATAR"),color:"red",cb:()=>{l({...e,avatar:null}),P&&p.Settings.set({...p.Settings.value,avatar:null})}}]})},children:[e.avatar||P&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${e.avatar??n.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:ee(e.firstname,e.lastname)}):t(re,{}),t("span",{children:a("APPS.PHONE.EDIT")})]}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),value:e.firstname,onChange:i=>l({...e,firstname:i.target.value}),maxLength:20})}),!P&&t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),value:e.lastname??"",onChange:i=>l({...e,lastname:i.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:e==null?void 0:e.number,maxLength:20,disabled:P,onChange:i=>{if(P)return;let A=i.target.value.slice(-1).charCodeAt(0);A>=48&&A<=57&&i.target.value.length<=10&&l({...e,number:i.target.value})}})})}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{className:"phone_number",type:"email",placeholder:a("APPS.PHONE.CONTACTS.EMAIL"),defaultValue:P?n==null?void 0:n.email:e==null?void 0:e.email,maxLength:20,onChange:i=>{i.target.value.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i)&&(P?p.Settings.set({...p.Settings.value,email:i.target.value}):l({...e,email:i.target.value}))}})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.ADDRESS"),defaultValue:P?n==null?void 0:n.address:e==null?void 0:e.address,maxLength:20,onChange:i=>{P?p.Settings.set({...p.Settings.value,address:i.target.value}):l({...e,address:i.target.value})}})})]}),!P&&s(R,{children:[t("div",{className:"contact-info",children:s("div",{className:"item option",onClick:()=>le.set(e.number),children:[t("div",{className:"label",children:a("APPS.PHONE.CONTACTS.RINGTONE")}),s("div",{className:"option-value",children:[t("div",{className:"value",children:Ae((I=(v=n.sound)==null?void 0:v.ringtones)==null?void 0:I[e.number])||a("APPS.PHONE.CONTACTS.DEFAULT")}),t(Oe,{})]})]})}),t("div",{className:"contact-info",children:t("div",{className:"item red",onClick:()=>{_.PopUp.set({title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TITLE"),description:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_TEXT"),buttons:[{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.REMOVE_CONTACT_BUTTON_DELETE"),color:"red",cb:C}]})},children:a("APPS.PHONE.CONTACTS.DELETE_CONTACT")})})]})]})}):t(R,{children:s("div",{className:"contact nohover details",children:[s("div",{className:"user",children:[e.avatar||P&&n.avatar?t("div",{className:"avatar bigger",style:{backgroundImage:`url(${P?n.avatar:e.avatar})`}}):e.firstname?t("div",{className:"avatar bigger",children:ee(e.firstname,e.lastname)}):t(re,{}),t("div",{className:"name",children:e.firstname?Y(e.firstname,e.lastname):x(e.number)??a("APPS.PHONE.CALL.NO_CALLER_ID")})]}),s("div",{className:"actions",children:[s("div",{className:"item","data-disabled":P||e.company?!0:!e.number,onClick:()=>{P||e.company||!e.number||q.patch({active:{name:"Messages",data:{number:e.number,name:e.firstname&&Y(e.firstname,e.lastname),avatar:e.avatar,view:"messages"}}})},children:[t(Se,{}),a("APPS.PHONE.CONTACTS.MESSAGE")]}),s("div",{className:"item call","data-disabled":P||!e.number,onClick:()=>{P||!e.number||W({number:e.number,company:e.company,companylabel:e.company&&e.firstname})},children:[t(Ne,{}),a("APPS.PHONE.CONTACTS.CALL")]}),s("div",{className:"item","data-disabled":P||e.company?!0:!e.number,onClick:()=>{P||e.company||!e.number||W({number:e.number,company:e.company,companylabel:e.company&&e.firstname,videoCall:!0})},children:[t(ye,{}),a("APPS.PHONE.CONTACTS.VIDEO")]}),s("div",{className:"item","data-disabled":e.company?!0:!e.number,onClick:()=>{if(e.company||!e.number)return;let i=P?e.avatar??n.avatar:e.avatar;_.Share.set({type:"contact",data:{number:e.number,firstname:e.firstname,lastname:e.lastname,avatar:i,email:e.email,address:e.address}})},children:[t(Ie,{}),a("APPS.PHONE.CONTACTS.SHARE")]})]}),e.callData&&t("div",{className:"contact-info",children:s("div",{className:"item",children:[t("div",{className:"title",children:je((b=e.callData)==null?void 0:b.timestamp)}),t("div",{className:"value calls",children:e.callData.calls.map((i,A)=>s("div",{className:"call-item",children:[t("div",{className:"timestamp",children:ke(i.timestamp)}),s("div",{className:"call-content",children:[t("div",{className:"type",children:i.type}),i.responded&&i.duration&&t("div",{className:"call-duration",children:Ye(i.duration)})]})]},A))})]})}),!e.company&&e.number&&s(R,{children:[t("div",{className:"contact-info",children:s("div",{className:"item",onClick:()=>{de(e.number),_.PopUp.set({title:a("COMPONENTS.SHARE.COPY_POPUP.TITLE"),description:a("COMPONENTS.SHARE.COPY_POPUP.DESCRIPTION"),buttons:[{title:a("COMPONENTS.SHARE.COPY_POPUP.OK")}]})},children:[t("div",{className:"title",children:"phone"}),t("div",{className:"value",children:x(e.number)})]})}),(e.email||e.address)&&s("div",{className:"contact-info",children:[e.email&&s("div",{className:"item",onClick:()=>de(e.email),children:[t("div",{className:"title",children:(w=a("APPS.PHONE.CONTACTS.EMAIL"))==null?void 0:w.toLowerCase()}),t("div",{className:"value",children:e.email})]}),e.address&&s("div",{className:"item",onClick:()=>de(e.address),children:[t("div",{className:"title",children:(u=a("APPS.PHONE.CONTACTS.ADDRESS"))==null?void 0:u.toLowerCase()}),t("div",{className:"value",children:e.address})]})]}),t("div",{className:"contact-info",children:e.firstname?t(R,{children:!P&&s(R,{children:[t("div",{className:"item",onClick:()=>z(),children:a("APPS.PHONE.CONTACTS.SHARE_LOCATION")}),e.favourite?t("div",{className:"item red",onClick:()=>k(),children:a("APPS.PHONE.CONTACTS.REMOVE_FAVORITE")}):t("div",{className:"item",onClick:()=>k(),children:a("APPS.PHONE.CONTACTS.ADD_FAVORITE")}),e.blocked?t("div",{className:"item red",onClick:()=>{_.PopUp.set({title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_TEXT").format({number:x(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.UNBLOCK_NUMBER_BUTTON_UNBLOCK"),cb:()=>L()}]})},children:a("APPS.PHONE.CONTACTS.UNBLOCK_CALLER")}):t("div",{className:"item red",onClick:()=>{_.PopUp.set({title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TITLE"),description:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_TEXT").format({number:x(e.number)}),buttons:[{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_CANCEL")},{title:a("APPS.PHONE.CONTACTS.BLOCK_NUMBER_BUTTON_BLOCK"),color:"red",cb:()=>{L()}}]})},children:a("APPS.PHONE.CONTACTS.BLOCK_CALLER")})]})}):t("div",{className:"item",onClick:()=>O("NewContact"),children:a("APPS.PHONE.CONTACTS.ADD_CONTACT")})})]})]})})})]})}const je=r=>new Date(r).toLocaleDateString(j.value.DateLocale,{day:"numeric",month:"short",year:"numeric"}),Ye=r=>r<60?`${r} ${a("SECONDS")}`:r<3600?`${Math.floor(r/60)} ${a("MINUTES")}`:`${Math.floor(r/3600)} ${a("HOURS")}`;function ze(){const{View:r,viewContact:E}=o.useContext(J),n=T(p.Settings),[h,c]=r,S=T(p.PhoneNumber),d=T(M.APPS.PHONE.contacts),[O,e]=o.useState("");return s(D.div,{...K("left","contacts",.2),className:"animation-container",children:[s("div",{className:"contacts-header",children:[s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.TITLE")}),t(pe,{onClick:()=>c("NewContact")})]}),t(He,{placeholder:a("SEARCH"),onChange:l=>e(l.target.value)})]}),t("div",{className:"content",children:s("div",{className:"contact-list",children:[t("div",{className:"letters",children:[...Array(26)].map((l,N)=>{let f=String.fromCharCode(N+65);return t("a",{children:f},N)})}),t("div",{className:"contact card",onClick:()=>E({firstname:n==null?void 0:n.name,number:S},"Contacts"),children:s("div",{className:"profile",children:[n.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${n.avatar})`}}):t("div",{className:"avatar",children:ee(n==null?void 0:n.name)}),s("div",{className:"profile-info",children:[t("div",{className:"name",children:n==null?void 0:n.name}),t("div",{className:"info",children:a("APPS.PHONE.CONTACTS.MY_CARD")})]}),t(Oe,{})]})}),d&&s(R,{children:[Object.entries(d.filter(l=>{var N;return(N=Y(l.firstname,l.lastname))==null?void 0:N.toLowerCase().includes(O==null?void 0:O.toLowerCase())}).sort((l,N)=>l.firstname.localeCompare(N.firstname)).reduce((l,N)=>{var m;if(!N)return l;let f=(m=N.firstname)==null?void 0:m.charAt(0).toUpperCase();return l[f]||(l[f]=[]),l[f].push(N),l},{})).map(([l,N],f)=>s("div",{children:[t("div",{id:l,className:`divider ${f===0?"no-border":""}`,children:l}),t(D.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"contacts",children:N.map((m,P)=>s("div",{className:"contact item border",onClick:()=>E(m,"Contacts"),children:[m.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${m.avatar})`}}):t("div",{className:"avatar",children:ee(m.firstname,m.lastname)}),s("div",{className:"details",children:[t("div",{className:"name",children:Y(m.firstname,m.lastname)}),t("div",{className:"phone-number",children:x(m.number)})]})]},P))})]},f)),s("div",{className:"total-contacts",children:[d.length," ",a("APPS.PHONE.CONTACTS.TITLE")]})]})]})})]})}function qe(){const{viewContact:r}=o.useContext(J),E=T(M.APPS.PHONE.contacts),[n,h]=o.useState(!1);return s(D.div,{...K("left","favourites",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.FAVOURITES.TITLE")}),t("span",{onClick:()=>h(!n),children:n?a("APPS.PHONE.DONE"):a("APPS.PHONE.EDIT")})]})}),t("div",{className:"content",children:t("div",{className:"favourite",children:E.filter(c=>c.favourite||c.company).sort((c,S)=>c.company?-1:1).map((c,S)=>{let d=Y(c.firstname,c.lastname);return s(D.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item",onClick:()=>{_.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:d}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:d}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{W({number:c.number,company:c.company,companylabel:c.firstname})}}]})},children:[s("div",{className:"user",children:[n&&!c.company&&t(we,{onClick:O=>{O.stopPropagation(),_.PopUp.set({title:a("APPS.PHONE.FAVOURITES.REMOVE_TITLE"),description:a("APPS.PHONE.FAVOURITES.REMOVE_TEXT"),buttons:[{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_CANCEL")},{title:a("APPS.PHONE.FAVOURITES.REMOVE_BUTTON_REMOVE"),color:"red",cb:()=>{y("Phone",{action:"toggleFavourite",number:c.number,favourite:!1},!0).then(e=>{if(!e)return H("warning","Failed to remove favourite");M.APPS.PHONE.contacts.set(E.map(l=>l.number===c.number?{...l,favourite:!l.favourite}:l))})}}]})}}),c.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${c.avatar})`}}):t("div",{className:"avatar",children:ee(c.firstname,c.lastname)}),s("div",{className:"info",children:[d,t("span",{children:x(c.number)})]})]}),t(Te,{onClick:O=>{O.stopPropagation(),r(c,"Favourites")}})]},S)})})})]})}const U=[697,770,852,941],V=[1209,1336,1477,1633],Ce={1:[U[0],V[0]],2:[U[0],V[1]],3:[U[0],V[2]],4:[U[1],V[0]],5:[U[1],V[1]],6:[U[1],V[2]],7:[U[2],V[0]],8:[U[2],V[1]],9:[U[2],V[2]],"*":[U[3],V[0]],0:[U[3],V[1]],"#":[U[3],V[2]]},We=[{key:"1",letters:""},{key:"2",letters:"ABC"},{key:"3",letters:"DEF"},{key:"4",letters:"GHI"},{key:"5",letters:"JKL"},{key:"6",letters:"MNO"},{key:"7",letters:"PQRS"},{key:"8",letters:"TUV"},{key:"9",letters:"WXYZ"},{key:"*",letters:""},{key:"0",letters:"+"},{key:"#",letters:""}],ie={0:2.5,12:2,17:1.75};function Je(){const r=T(p.Settings),E=T(p.CallData),n=T(q),{View:h,Contact:c,viewContact:S}=o.useContext(J),[d,O]=h,[e,l]=c,[N,f]=o.useState(null),[m,P]=o.useState(""),g=o.useRef(null),C=o.useRef([]),L=o.useRef(null),k=o.useRef(null),G=o.useRef(!0),[z,X]=o.useState(2.5);o.useEffect(()=>{var u;if(!g.current&&((u=n==null?void 0:n.active)==null?void 0:u.name)==="Phone")return g.current=new AudioContext,()=>{g.current&&(v(),g.current.close(),g.current=null)}},[n==null?void 0:n.active]),o.useEffect(()=>{var u;G.current=!!(((u=n==null?void 0:n.active)==null?void 0:u.name)==="Phone"&&(!E||E!=null&&E.banner))},[n==null?void 0:n.active,E]),o.useEffect(()=>{document.addEventListener("keydown",b),document.addEventListener("keyup",w),m==="0"&&X(2.5);let u=0;for(let i=0;i<Object.keys(ie).length;i++)m.length>=parseInt(Object.keys(ie)[i])&&(u=ie[Object.keys(ie)[i]]);return X(u),()=>{document.removeEventListener("keydown",b),document.removeEventListener("keyup",w)}},[m]);const B=u=>{var ve;if(!g.current)return;const i=g.current,[A,$]=Ce[u],te="sine",ae=i.createOscillator();ae.frequency.value=A,ae.type=te;const ne=i.createOscillator();ne.frequency.value=$,ne.type=te;const se=i.createGain();se.gain.value=.2*(((ve=r==null?void 0:r.sound)==null?void 0:ve.volume)!==void 0?r.sound.volume:.5),ae.connect(se),ne.connect(se),se.connect(i.destination),ae.start(),ne.start();const Le=setTimeout(()=>{v()},1500);C.current.push([ae,ne,se,Le])},v=()=>{C.current.forEach(([u,i,A,$])=>{clearTimeout($),g.current&&(u.stop(),i.stop(),u.disconnect(),i.disconnect(),A.disconnect())}),L.current=null,C.current=[]},I=u=>{G.current&&(u=="delete"?P(i=>i.slice(0,-1)):u.match(/^[0-9]+$/)&&P(i=>i+u),Ce[u]&&(L.current&&v(),L.current=u,B(u)))},b=u=>{L.current||u.repeat||(u.key.match(/^[0-9]+$/)?(L.current=u.key,I(u.key)):u.key==="Backspace"?I("delete"):u.key==="Enter"&&m.length>=3&&W({number:m}))},w=u=>{u.key===L.current&&v()};return o.useEffect(()=>{if(m.length!==_e())return f(null);f(ue(m))},[m]),s(D.div,{...K("left","keypad",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"title",children:a("APPS.PHONE.KEYPAD.TITLE")}),t(pe,{onClick:()=>{if(P(""),N)S(N,"Keypad");else{let u=ue(m);u?(l({...u,number:m}),O("NewContact")):(l({number:m}),O("NewContact"))}}})]})}),t("div",{className:"content noscroll",children:s("div",{className:"keypad-container",children:[t("div",{className:"inputbox",children:t("div",{className:"input",style:{fontSize:`${z}rem`},children:x(m)})}),t("div",{className:"keypad-wrapper",children:s("div",{className:"keypad",children:[We.map(u=>s("div",{onMouseDown:()=>I(u.key),onMouseUp:()=>v(),children:[u.key,u.letters&&t("span",{children:u.letters})]},u.key)),t("span",{}),t("div",{className:"call",onClick:()=>{m.length>=3&&W({number:m})},children:t(Ne,{})}),t("div",{className:"delete",onMouseDown:()=>{if(!ce("Phone"))return;I("delete"),k.current&&clearInterval(k.current);const u=setInterval(()=>{I("delete")},100);k.current=u},onMouseUp:()=>{k.current&&(clearInterval(k.current),k.current=null)},children:t(Re,{})})]})})]})})]})}function Qe(){const{View:r,Contact:E}=o.useContext(J),n=T(p.PhoneNumber),[h]=E,[c,S]=r,d=T(M.APPS.PHONE.contacts),O=T(p.Settings),[e,l]=o.useState(null),[N,f]=o.useState(!1);o.useEffect(()=>{p.Styles.TextColor.set(O.display.theme=="dark"?"#ffffff":"#000000")},[]),o.useEffect(()=>{h&&h.number&&l({...e,number:h.number})},[h]),o.useEffect(()=>{e&&f(e.firstname&&e.number!==void 0)},[e]);const m=()=>{if(e){if(!e.number||(e==null?void 0:e.number)===n)return S("Contacts");e.lastname=(e==null?void 0:e.lastname)??"",y("Phone",{action:"saveContact",data:e},!0).then(P=>{if(!P)return H("warning","Failed to save contact");M.APPS.PHONE.contacts.set([...d,e]),S("Contacts")})}};return s(D.div,{...K("up","newcontact",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items",children:[t("div",{className:"back",onClick:()=>S("Contacts"),children:a("APPS.PHONE.CANCEL")}),t("span",{className:N?"":"disabled",onClick:()=>{N&&m()},children:a("APPS.PHONE.DONE")})]})}),t("div",{className:"content",children:t(R,{children:s("div",{className:"contact nohover",children:[t("div",{className:"user",onClick:()=>{var P,g,C;_.Gallery.set({allowExternal:(C=(g=(P=j)==null?void 0:P.value)==null?void 0:g.AllowExternal)==null?void 0:C.Other,onSelect:L=>l({...e,avatar:L.src})})},children:e!=null&&e.avatar?s(R,{children:[t("div",{className:"profile-image bigger transparent",style:{backgroundImage:`url(${e.avatar})`}}),t("span",{children:a("APPS.PHONE.EDIT")})]}):s(R,{children:[t(re,{className:"big"}),t("span",{className:"add",children:a("APPS.PHONE.CONTACTS.ADD_PHOTO")})]})}),s("div",{className:"contact-info",children:[t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.FIRST_NAME"),onChange:P=>l({...e,firstname:P.target.value}),maxLength:20})}),t("div",{className:"item input",children:t(F,{type:"text",placeholder:a("APPS.PHONE.CONTACTS.LAST_NAME"),onChange:P=>l({...e,lastname:P.target.value}),maxLength:20})})]}),t("div",{className:"contact-info",children:t("div",{className:"item input",children:t(F,{className:"phone_number",type:"number",placeholder:a("APPS.PHONE.CONTACTS.PHONE_NUMBER"),defaultValue:h==null?void 0:h.number,maxLength:15,onChange:P=>{let g=P.target.value.slice(-1).charCodeAt(0);g>=48&&g<=57&&l({...e,number:P.target.value})}})})})]})})})]})}const Q=oe([]).mock(Pe.RecentCalls);function Ze(){const{viewContact:r}=o.useContext(J),[E,n]=o.useState("all"),h=T(Q),c=["all","missed"];o.useEffect(()=>{y("Phone",{action:"getRecent",missed:E==="missed"},Pe.RecentCalls.filter(d=>E==="missed"?!d.answered:!0)).then(d=>{if(!d)return H("error","Failed to get recent calls");Q.set(d)})},[E]);const{handleScroll:S}=ge({fetchData:()=>{var d;return y("Phone",{action:"getRecent",missed:E==="missed",lastId:(d=Q.value[Q.value.length-1])==null?void 0:d.id})},onDataFetched:d=>Q.set([...Q.value,...d]),perPage:25});return o.useEffect(()=>{const d=document.querySelector(".content");d&&(d.scrollTop=0)},[E]),s(D.div,{...K("left","recent",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:s("div",{className:"items col",children:[t("div",{className:"selector-container",children:t("div",{className:"selector",children:c.map((d,O)=>t("div",{className:"option","data-active":E===d,onClick:()=>n(d),children:a(`APPS.PHONE.RECENTS.${d.toUpperCase()}`)},O))})}),t("div",{className:"title",children:a("APPS.PHONE.RECENTS.TITLE")})]})}),t("div",{className:"content",onScroll:S,children:t(D.div,{...K(E==="all"?"left":"right",E,.2),className:"recent-calls",children:h.map((d,O)=>{var l,N,f;let e=ue(d.number);return s(D.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},className:"item","data-missed":!d.called&&!d.answered?"true":"false",onClick:()=>{if(d.hideCallerId)return;let m;e!=null&&e.name?m=e.name:m=x(d.number),_.PopUp.set({title:a("APPS.PHONE.CALL.CALL_TITLE").format({name:m}),description:a("APPS.PHONE.CALL.CALL_TEXT").format({name:m}),buttons:[{title:a("APPS.PHONE.CALL.CALL_BUTTON_CANCEL")},{title:a("APPS.PHONE.CALL.CALL_BUTTON_CALL"),cb:()=>{W({number:d.number})}}]})},children:[s("div",{className:"user",children:[d.hideCallerId?t("div",{className:"avatar",style:{backgroundImage:`url(./assets/img/avatar-placeholder-${(f=(N=(l=p)==null?void 0:l.Settings)==null?void 0:N.value)==null?void 0:f.display.theme}.svg)`}}):e!=null&&e.avatar?t("div",{className:"avatar",style:{backgroundImage:`url(${e==null?void 0:e.avatar})`}}):t("div",{className:"avatar",children:ee(e==null?void 0:e.name)}),t("div",{className:"info",children:d.hideCallerId?s(R,{children:[a("APPS.PHONE.CALL.NO_CALLER_ID"),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]}):e!=null&&e.name?s(R,{children:[e.name,t("span",{children:x(d.number)})]}):s(R,{children:[x(d.number),t("span",{children:a("APPS.PHONE.CALL.UNKNOWN")})]})})]}),s("div",{className:"info",children:[t("div",{className:"date",children:De(d.timestamp)}),t(Te,{onClick:m=>{m.stopPropagation();let P=h.filter(C=>C.number===d.number&&Math.abs(C.timestamp-d.timestamp)<36e5),g={timestamp:P[0].timestamp,calls:P.map(C=>{let L;return C.called&&C.answered&&(L=a("APPS.PHONE.RECENTS.OUTGOING_CALL")),C.called&&!C.answered&&(L=a("APPS.PHONE.RECENTS.CANCELLED_CALL")),!C.called&&C.answered&&(L=a("APPS.PHONE.RECENTS.INCOMING_CALL")),!C.called&&!C.answered&&(L=a("APPS.PHONE.RECENTS.MISSED_CALL")),{outgoing:C.called,responded:C.answered,timestamp:C.timestamp,duration:C.duration,type:L}})};d.hideCallerId&&(d.number=null),r(e!=null&&e.name?{...e,number:d.number}:{...d},"Recents",g)}})]})]},O)})})})]})}const Ee=oe(null),Z=oe([]);function et(){const r=T(Z);o.useEffect(()=>{ce("Phone")&&y("Phone",{action:"getVoiceMails",page:0},Pe.VoiceMails).then(n=>{if(!n)return H("error","Failed to get voicemails");H("info","Received voicemails",n),Z.set(n)})},[]);const{handleScroll:E}=ge({fetchData:n=>y("Phone",{action:"getVoiceMails",page:n}),onDataFetched:n=>Z.set([...Z.value,...n]),perPage:25});return s(D.div,{...K("left","voicemail",.2),className:"animation-container",children:[t("div",{className:"contacts-header",children:t("div",{className:"items",children:t("div",{className:"title",children:a("APPS.PHONE.VOICEMAIL.TITLE")})})}),t("div",{className:"content",onScroll:E,children:t("div",{className:"voicemails",children:r.map(n=>t(tt,{data:n},n.id))})})]})}const tt=({data:r})=>{const E=T(j),n=T(p.Settings),h=o.useRef(null),[c,S]=o.useState(!1),[d,O]=o.useState(!1),[e,l]=o.useState(!1),[N,f]=o.useState(null),[m,P]=o.useState(0),g=T(Ee),[C,L]=o.useState(null),k=T(xe),G=T(q);o.useEffect(()=>{var v;k!=null&&k.visible&&((v=h.current)==null||v.pause(),l(!1))},[k==null?void 0:k.visible,G==null?void 0:G.active]),o.useEffect(()=>{var I,b;h.current=new Audio(r.url),h.current.src=r.url,h.current.volume=((I=n==null?void 0:n.sound)==null?void 0:I.volume)!==void 0?n.sound.volume:.5,h.current.addEventListener("ended",()=>{l(!1)}),h.current.addEventListener("timeupdate",()=>{P(h.current.currentTime)});let v=(b=M.APPS.PHONE.contacts)==null?void 0:b.value;if(v&&r.number){let w=v.find(u=>u.number==r.number);w&&L(w)}return()=>{var w,u;(w=h.current)==null||w.pause(),(u=h.current)==null||u.remove(),h.current=null}},[]),o.useEffect(()=>{var v;g&&g!==r.id&&((v=h.current)==null||v.pause(),l(!1),S(!1))},[g]),o.useEffect(()=>{n.sound.volume&&(h.current.volume=n.sound.volume)},[n.sound.volume]),o.useEffect(()=>{var v;l(!1),P(0),(v=h.current)==null||v.pause(),h.current.currentTime=0,c&&Ee.set(r.id)},[c]);const z=v=>{v=v/1e3;const I=Math.floor(v/60),b=me(v-I*60,0);return`${I}:${b<10?"0"+b:b}`},X=(v,I)=>{const b=new Date(v),w=b.getFullYear(),u=b.getMonth()+1,i=b.getDate(),A=b.getHours(),$=b.getMinutes();return I?`${i} ${b.toLocaleDateString(E.DateLocale,{month:"long"})} ${w} ${a("APPS.PHONE.VOICEMAIL.AT")} ${A}:${$<10?"0"+$:$}`:`${w}-${u<10?"0"+u:u}-${i<10?"0"+i:i}`},B={light:{active:"#333333",track:"#cccccc"},dark:{active:"#FFFFFF",track:"#999999"}};return t(D.div,{className:"voicemail-item",initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},viewport:{once:!0},onClick:()=>S(!c),"data-expanded":c,children:s("div",{className:"voicemail-info",children:[s("div",{className:"voicemail-row",children:[s("div",{className:"details",children:[t("div",{className:"voicemail-title",children:r.hideCallerId?a("APPS.PHONE.CALL.NO_CALLER_ID"):C?Y(C==null?void 0:C.firstname,C==null?void 0:C.lastname):x(r.number)}),t("div",{className:"subtitle",children:X(r.timestamp,!0)})]}),!c&&t("div",{className:"info",children:t("div",{className:"duration",children:z(r.duration)})})]}),t(be,{children:c&&s(D.div,{className:"voicemail-actions",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[s("div",{className:"voicemail-duration-slider",onClick:v=>v.stopPropagation(),children:[t(F,{type:"range",min:0,max:100,value:N||m/r.duration*100,style:{background:`linear-gradient(to right, ${B[n.display.theme].active} 0%, ${B[n.display.theme].active} ${N||m/(r.duration/1e3)*100}%, ${B[n.display.theme].track} ${N||m/(r.duration/1e3)*100}%, ${B[n.display.theme].track} 100%)`},onMouseDown:v=>{ce("Phone")&&(v.stopPropagation(),O(!0))},onMouseUp:v=>{if(v.stopPropagation(),O(!1),N){if(!h.current)return H("warning","Audio ref is null");h.current.currentTime=r.duration/1e3/100*N,f(null)}},onChange:v=>{v.stopPropagation(),f(v.target.value)}}),s("div",{className:"duration",children:[t("div",{children:z(m)??"0:00"}),t("div",{children:z(r.duration)})]})]}),s("div",{className:"voicemail-item-footer",children:[t("div",{className:"play",onClick:v=>{if(v.stopPropagation(),!h.current)return H("warning","Audio ref is null");e?h.current.pause():h.current.play().catch(()=>H("error","Failed to play voicemail",r.id)),l(!e)},children:e?t(Me,{}):t(Ue,{})}),s("div",{className:"buttons",children:[r.number&&s(R,{children:[t(Ne,{className:"green",onClick:v=>{v.stopPropagation(),_.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.DESCRIPTION").format({number:x(r.number)}),buttons:[{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.CALL_POPUP.PROCEED"),cb:()=>{W({number:r.number})}}]})}}),t(Se,{className:"blue",onClick:v=>{v.stopPropagation(),q.patch({active:{name:"Messages",data:{number:r.number,name:(C==null?void 0:C.firstname)&&Y(C.firstname,C.lastname),avatar:C==null?void 0:C.avatar},view:"messages"}})}})]}),t(Ve,{className:"red",onClick:v=>{v.stopPropagation(),_.PopUp.set({title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.TITLE"),description:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.DESCRIPTION"),buttons:[{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.CANCEL")},{title:a("APPS.PHONE.VOICEMAIL.DELETE_POPUP.PROCEED"),cb:()=>{y("Phone",{action:"deleteVoiceMail",id:r.id},!0).then(I=>{if(!I)return H("error","Failed to delete voicemail");H("info","Deleted voicemail",r.id),Z.set(Z.value.filter(b=>b.id!==r.id))})}}]})}})]})]})]})})]})})};function at(){var h;const r=T(j),E=T(q),n=T(le);return o.useEffect(()=>{ce("Phone")||y("stopPreviewingSound")},[E==null?void 0:E.active]),o.useEffect(()=>()=>{var c;((c=j.value.sound)==null?void 0:c.system)==="nui"?p.SoundManager.reset():y("stopPreviewingSound")},[]),s(D.div,{...K("ringtone-browser","right"),className:"ringtone-browser",children:[t("div",{className:"ringtone-browser-header",children:s("div",{className:"back",onClick:()=>le.set(null),children:[t(fe,{}),a("APPS.PHONE.CONTACTS.BACK")]})}),s("div",{className:"ringtone-browser-content",children:[t("div",{className:"title",children:a("APPS.PHONE.CONTACTS.RINGTONES")}),t("section",{className:"items",children:Object.keys((h=r==null?void 0:r.sound)==null?void 0:h.ringtones).sort((c,S)=>c.localeCompare(S,void 0,{numeric:!0,sensitivity:"base"})).map((c,S)=>{var d,O;return t("div",{className:"section-item",style:{cursor:"pointer"},onClick:()=>{var l,N,f,m,P;let e={...p.Settings.value,sound:{...p.Settings.value.sound,ringtones:{...p.Settings.value.sound.ringtones,[n]:c}}};if(((l=j.value.sound)==null?void 0:l.system)==="nui"){const g=((P=(m=(f=(N=j.value)==null?void 0:N.sound)==null?void 0:f.ringtones)==null?void 0:m[c])==null?void 0:P.name)??"1";p.SoundManager.set({url:`./assets/sound/ringtones/${g}.mp3`,timeout:5e3,loop:!0,override:!0})}else y("previewSound",{soundType:"ringtone",sound:c});p.Settings.set(e),y("setSettings",e)},children:s("div",{className:"item",children:[c==((O=(d=p.Settings.value.sound)==null?void 0:d.ringtones)==null?void 0:O[n])?t(he,{className:"checkmark"}):t(he,{className:"checkmark hidden"}),t("div",{className:"item-title",children:Ae(c)})]})},c)})})]})]})}const J=o.createContext(null),le=oe(null);function st(){const r=T(q).active,[E,n]=o.useState("Contacts"),[h,c]=o.useState(null),S=T(M.APPS.PHONE.contacts),d=T(le),O=(N,f,m)=>{c({...N,callData:m,from:f}),n("Contact")};o.useEffect(()=>{var N,f;if(S&&r!=null&&r.data)if(((N=r.data)==null?void 0:N.view)==="contact"){let m=S==null?void 0:S.find(P=>P.number==r.data.number);if(!m)return;c({...m||{number:r.data.number},from:"Contacts"}),n("Contact")}else((f=r.data)==null?void 0:f.view)==="newContact"&&(c({number:r.data.number,from:"Contacts"}),n("NewContact"))},[]);const e={Favourites:t(qe,{}),Contacts:t(ze,{}),Recents:t(Ze,{}),Keypad:t(Je,{}),NewContact:t(Qe,{}),Contact:t(Xe,{}),Voicemail:t(et,{})},l={Favourites:t(Be,{}),Recents:t(Fe,{}),Contacts:t(re,{}),Keypad:t(Ke,{}),Voicemail:t(Ge,{})};return s("div",{className:"phone-app-container",children:[t(be,{children:d&&t(at,{})}),t(J.Provider,{value:{Contact:[h,c],View:[E,n],viewContact:O},children:t("div",{className:"wrapper",children:e[E]})}),t("div",{className:"footer",children:Object.keys(l).map((N,f)=>s("div",{className:$e("item",E==N&&"active"),onClick:()=>n(N),children:[l[N],t("span",{children:a(`APPS.PHONE.${N.toUpperCase()}.TITLE`)})]},f))})]})}export{J as PhoneContext,le as RingtoneBrowserData,st as default};
