import{r as d,j as T,a as s,Q as x,m as f,u as _,H as B,bO as F,b as y,v as N,t as b,a2 as k,af as U,x as A,ac as $,b0 as D,F as H,L as e,c6 as j,c7 as z,z as M,c8 as G,c9 as W,a7 as q,C as v,i as Q,P as I,A as V}from"./index-569b241b.js";function X({children:t,text:a}){const[h,O]=d.useState(!1);return T("div",{className:"tooltip-wrapper",onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:[t,s(x,{children:h&&s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"tooltip top",children:s("div",{dangerouslySetInnerHTML:{__html:a}})})})]})}const w=d.createContext(null);function te(){var m;const t=_(y),a=_(I.Settings),h=_(V),[O,R]=d.useState(0),Y=_(I.Styles.TextColor),[E,n]=d.useState([]),[P,g]=d.useState(""),[C,r]=d.useState("0"),[u,p]=d.useState(a==null?void 0:a.streamerMode);d.useEffect(()=>{B("Crypto")&&(F()&&fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&sparkline=true&order=market_cap_desc&per_page=100&page=1&ids=${y.value.Crypto.Coins.join(",")}`).then(i=>i.json()).then(i=>{n(i.map(o=>{var c;return{id:o.id,name:o.name,symbol:o.symbol,image:o.image,current_price:o.current_price,prices:(c=o.sparkline_in_7d)==null?void 0:c.price,change_24h:o.price_change_percentage_24h}}))}).catch(i=>N("error",i)),b("Crypto",{action:"get"}).then(i=>{if(!i)return N("warning","No data received from Crypto NUI event");n(i)}))},[h==null?void 0:h.active]),k("crypto:updateCoins",i=>{if(!i)return N("warning","No data received from the update Crypto NUI event");n(i)}),d.useEffect(()=>R(E.reduce((i,o)=>i+(o.owned??0)*o.current_price,0)),[E]),d.useEffect(()=>{r(u?U("âˆ—".repeat(A(O,2).toString().length)):U(A(O,2).toString()))},[O,u]);const l=i=>{let o={0:50,10:45,12:40,14:35},c=0;for(let S=0;S<Object.keys(o).length;S++)i.length>=parseInt(Object.keys(o)[S])&&(c=o[Object.keys(o)[S]]);return c};return s("div",{className:"crypto-container",children:$()?T(H,{children:[T("div",{className:"crypto-header",children:[s("img",{src:"./assets/img/icons/apps/Cryptopng.png",alt:"btc"}),e("APPS.CRYPTO.TITLE")]}),s(w.Provider,{value:{Coins:[E,n]},children:T("div",{className:"crypto-wrapper",children:[T("div",{className:"balance",children:[T("div",{className:"title",children:[e("APPS.CRYPTO.BALANCE"),s("div",{className:"icon",onClick:()=>p(!u),children:u?s(j,{}):s(z,{})})]}),s("div",{className:"amount",style:{fontSize:l(C.toString())},onClick:()=>p(!u),children:(m=t==null?void 0:t.CurrencyFormat)==null?void 0:m.replace("%s",C.toString())})]}),s("div",{className:"search",children:s(M,{placeholder:"Search Cryptocurrency",onChange:i=>g(i.target.value)})}),s(J,{search:P}),s("div",{className:"credits",children:"Powered by CoinGecko"})]})})]}):s("div",{className:"loading",children:s(D,{size:40,lineWeight:5,speed:2,color:Y})})})}const J=({search:t})=>{const[a,h]=d.useState("balance"),[O,R]=d.useState(!0),Y=["Name","Graph","Balance"],[E]=d.useContext(w).Coins;return s("div",{className:"holdings",children:T("div",{className:"items",children:[s("div",{className:"item filters",children:Y.map((n,P)=>T("div",{className:"filter",onClick:()=>{if(h(n==null?void 0:n.toLowerCase()),a===(n==null?void 0:n.toLowerCase()))return R(!O);R(!0)},children:[n,(n==null?void 0:n.toLowerCase())===a&&O?s(G,{}):s(W,{})]},P))}),E.sort((n,P)=>a==="name"?O?n.name.localeCompare(P.name):P.name.localeCompare(n.name):a==="graph"?O?n.change_24h-P.change_24h:P.change_24h-n.change_24h:a==="balance"?O?(P.owned??0)*P.current_price-(n.owned??0)*n.current_price:(n.owned??0)*n.current_price-(P.owned??0)*P.current_price:0).filter(n=>{var P,g;return((P=n.name)==null?void 0:P.toLowerCase().includes(t.toLowerCase()))||((g=n.symbol)==null?void 0:g.toLowerCase().includes(t.toLowerCase()))}).map((n,P)=>s(K,{data:n},P))]})})},K=({data:t})=>{const[a,h]=d.useState(!1),[O,R]=d.useState(""),[Y,E]=d.useContext(w).Coins,n=(C,r)=>{var u,p,l,m,i;if(r>((p=(u=y.value)==null?void 0:u.CryptoLimit)==null?void 0:p.Buy)){v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.TOO_HIGH").format({amount:(i=(m=(l=y.value)==null?void 0:l.CryptoLimit)==null?void 0:m.Buy)==null?void 0:i.toLocaleString()}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]});return}r>0?b("Crypto",{action:"buy",coin:C,amount:r}).then(o=>{if(o!=null&&o.success)return E(c=>c.map(S=>S.id===C?{...S,owned:(S.owned??0)+r/S.current_price,value:(S.value??0)+r,invested:(S.invested??0)+r}:S));o!=null&&o.msg&&setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${o.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.BUY").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)},P=(C,r,u)=>{var p,l,m,i,o;if(r>((l=(p=y.value)==null?void 0:p.CryptoLimit)==null?void 0:l.Sell)){v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.TOO_HIGH").format({amount:(o=(i=(m=y.value)==null?void 0:m.CryptoLimit)==null?void 0:i.Sell)==null?void 0:o.toLocaleString()}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]});return}u>0?b("Crypto",{action:"sell",coin:C,amount:u}).then(c=>{if(c!=null&&c.success)return E(S=>S.map(L=>L.id===C?{...L,owned:(L.owned??0)-r/L.current_price,value:(L.value??0)+r,invested:(L.invested??0)-r}:L));c!=null&&c.msg&&setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${c.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.SELL").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)},g=(C,r,u,p)=>{u>0?b("Crypto",{action:"transfer",coin:C,amount:u,number:p}).then(l=>{l!=null&&l.success&&setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.TITLE"),description:e("APPS.CRYPTO.SUCCESSFULLY_TRANSFERED_POPUP.DESCRIPTION").format({amount:r,coin:t.symbol,number:Q(p)}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]}),E(m=>m.map(i=>i.id===C?{...i,owned:(i.owned??0)-r/i.current_price,value:(i.value??0)+r,invested:(i.invested??0)-r}:i))},250),l!=null&&l.msg&&setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e(`APPS.CRYPTO.${l.msg}`),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)}):setTimeout(()=>{v.PopUp.set({title:e("APPS.CRYPTO.ERROR"),description:e("APPS.CRYPTO.ATLEAST_ONE_COIN").format({action:e("APPS.CRYPTO.TRANSFER").toLowerCase(),currency:y.value.CurrencyFormat.replace("%s","")}),buttons:[{title:e("APPS.CRYPTO.CLOSE")}]})},250)};return t.symbol=t.symbol.toUpperCase(),t.owned=t.owned??0,t.value=t.current_price*(t.owned??0),T("div",{className:"item",onClick:()=>h(!a),children:[T("div",{className:"top",children:[T("div",{className:"info",children:[s(q,{src:t.image,className:"icon",alt:"Icon"}),T("div",{className:"coin",children:[s("div",{className:"name",children:t.symbol}),s("div",{className:"symbol",children:t.name})]})]}),s(Z,{data:t}),T("div",{className:"amount",children:[s("div",{className:"value",children:U(A(t.owned,4))}),T("div",{className:"asset",children:["$",U(A(t.value,2))]})]})]}),s(x,{children:a&&T(f.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},className:"bottom",children:[s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button fill",onClick:C=>{var r,u,p,l,m,i,o;C.stopPropagation(),v.PopUp.set({title:e("APPS.CRYPTO.BUY_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.BUY_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((p=(u=(r=y.value)==null?void 0:r.CryptoLimit)==null?void 0:u.Buy)==null?void 0:p.toString())??"1000000",maxLength:((o=(i=(m=(l=y.value)==null?void 0:l.CryptoLimit)==null?void 0:m.Buy)==null?void 0:i.toString())==null?void 0:o.length)+2,onChange:c=>R(c)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{R(c=>(n(t.id,parseFloat(c)),c))}}]})},children:e("APPS.CRYPTO.BUY")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button",onClick:C=>{var r,u,p,l,m,i,o;C.stopPropagation(),v.PopUp.set({title:e("APPS.CRYPTO.SELL_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.SELL_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",max:((p=(u=(r=y.value)==null?void 0:r.CryptoLimit)==null?void 0:u.Sell)==null?void 0:p.toString())??"1000000",maxLength:((o=(i=(m=(l=y.value)==null?void 0:l.CryptoLimit)==null?void 0:m.Sell)==null?void 0:i.toString())==null?void 0:o.length)+2,onChange:c=>R(c)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),cb:()=>{R(c=>{let S=parseFloat(c),L=S/t.current_price;return P(t.id,S,L),c})}}]})},children:e("APPS.CRYPTO.SELL")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button blue",onClick:C=>{C.stopPropagation(),v.PopUp.set({title:e("APPS.CRYPTO.TRANSFER_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.TRANSFER_POPUP.DESCRIPTION").format({coin:t.symbol}),input:{placeholder:e("APPS.CRYPTO.BUY_POPUP.PLACEHOLDER"),type:"number",value:"0",onChange:r=>R(r)},buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.TRANSFER_POPUP.NEXT"),cb:()=>{R(r=>{let u=parseFloat(r),p=u/t.current_price;return v.ContactSelector.set({onSelect:l=>{if(!l)return N("warning","No contact selected? Cancelling request");g(t.id,u,p,l.number)}}),r})}}]})},children:e("APPS.CRYPTO.TRANSFER")}),s(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.1},className:"button red",onClick:C=>{C.stopPropagation(),v.PopUp.set({title:e("APPS.CRYPTO.SELL_ALL_POPUP.TITLE").format({coin:t.symbol}),description:e("APPS.CRYPTO.SELL_ALL_POPUP.DESCRIPTION").format({coin:t.symbol,amount:t.owned*t.current_price}),buttons:[{title:e("APPS.CRYPTO.BUY_POPUP.CANCEL")},{title:e("APPS.CRYPTO.BUY_POPUP.PROCEED"),color:"red",cb:()=>{let r=t.owned*t.current_price;P(t.id,r,t.owned)}}]})},children:e("APPS.CRYPTO.SELL_ALL")})]})})]})},Z=t=>{if(!(t!=null&&t.data.prices))return null;let a=t.data.prices;const h=d.useRef(null),[O,R]=d.useState(null),[Y,E]=d.useState(null);return a=a.slice(0,24),d.useEffect(()=>{if(!(h!=null&&h.current))return;const n=h.current;n.width=150,n.height=100;const P=n.getContext("2d");P.lineWidth=3;const g=Math.min(...a),r=Math.max(...a)-g,u=n.height-10;let p=0,l=n.height-5-(a[0]-g)/r*u;P.beginPath(),P.moveTo(p,l);const m=a[a.length-1]-a[0]>0?"green":"red";P.strokeStyle=m;for(let c=1;c<a.length;c++)p+=n.width/(a.length-1),l=n.height-5-(a[c]-g)/r*u,P.lineTo(p,l);P.stroke();const i=(a[a.length-1]-a[0])/a[0]*100;i>0?R(`<div style="color: var(--phone-color-green)">+${A(i,2)}%</div>`):i<0?R(`<div style="color: var(--phone-color-red)">${A(i,2)}%</div>`):R(`<div>${A(i,2)}%</div>`);let o=(t.data.value-t.data.invested)/t.data.invested*100;o>0?E(`<div style="color: var(--phone-color-green)">+${A(o,2)}%</div>`):o<0&&E(`<div style="color: var(--phone-color-red)">${A(o,2)}%</div>`)},[h,a]),s(X,{text:`$${A(t.data.current_price,2)} ${O??""} ${Y??""}`,children:s("canvas",{ref:h})})};export{te as default};
