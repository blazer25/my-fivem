import{u as m,j as c,m as R,a as t,L as i,d as y,C as M,b as k,ay as $,t as N,v as b,P as S,ad as j,a7 as F,b8 as H,r as P,N as z,H as X,a2 as B,F as W,ak as q,z as Q,S as G,bN as J,bR as Z,I as _,f as ee,G as U,A as te,k as ae,n as se,bS as I,i as ne,l as ie,ac as re,b0 as ce,Q as K,K as T}from"./index-569b241b.js";import{T as le}from"./Textarea-61cff3f3.js";function oe(){var u;const e=m(E),s=m(S.PhoneNumber),n=()=>{var l,o;if(!(e!=null&&e.title)||!(e!=null&&e.description)||!(e!=null&&e.price)||!(e!=null&&e.attachments)||((l=e==null?void 0:e.attachments)==null?void 0:l.length)===0){let r;switch(!0){case!(e!=null&&e.title):r=i("APPS.MARKETPLACE.ERROR_POPUP.NO_TITLE");break;case!(e!=null&&e.description):r=i("APPS.MARKETPLACE.ERROR_POPUP.NO_DESCRIPTION");break;case!(e!=null&&e.price):r=i("APPS.MARKETPLACE.ERROR_POPUP.NO_PRICE");break;case(!(e!=null&&e.attachments)||((o=e==null?void 0:e.attachments)==null?void 0:o.length)===0):r=i("APPS.MARKETPLACE.ERROR_POPUP.NO_ATTACHMENTS");break;default:r="Unknown error"}setTimeout(()=>{M.PopUp.set({title:i("APPS.MARKETPLACE.ERROR_POPUP.TITLE"),description:r,buttons:[{title:i("APPS.MARKETPLACE.ERROR_POPUP.OK")}]})},250)}else{let r={...e,number:s};N("MarketPlace",{action:"sendPost",data:r},Math.floor(Math.random()*1e3).toString()).then(d=>{if(!d)return b("warning","Failed to send post, no id could be generated");g.set([{...r,id:d},...g.value]),E.reset()})}};return c(R.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{duration:.2,ease:"easeInOut"},className:"new-post-container",children:[c("div",{className:"new-post-header",children:[t("div",{}),t("div",{className:"close",children:t("div",{onClick:()=>E.set(null)})}),t("div",{className:"post",onClick:n,children:i("APPS.MARKETPLACE.POST")})]}),c("div",{className:"new-post-body",children:[c("div",{className:"item",children:[t("div",{className:"title",children:i("APPS.MARKETPLACE.PRICE")}),t(y,{type:"number",placeholder:"0",max:9999999999,maxLength:10,onChange:l=>{if(!l.target.value.match(/^[0-9]*$/))return l.preventDefault();E.patch({price:parseFloat(l.target.value)})}})]}),c("div",{className:"item",children:[t("div",{className:"title",children:i("APPS.MARKETPLACE.TITLE")}),t(y,{type:"text",placeholder:"Title",maxLength:50,onChange:l=>E.patch({title:l.target.value})})]}),c("div",{className:"item",children:[t("div",{className:"title",children:i("APPS.MARKETPLACE.DESCRIPTION")}),t(le,{type:"text",placeholder:"Your post",maxLength:250,rows:5,onChange:l=>E.patch({description:l.target.value})})]}),c("div",{className:"item",children:[c("div",{className:"title",children:[" ",i("APPS.MARKETPLACE.IMAGES")]}),c("div",{className:"images",children:[(e==null?void 0:e.attachments)&&e.attachments.length>0&&e.attachments.map((l,o)=>t("div",{className:"image",style:{backgroundImage:`url(${l})`},onClick:()=>{E.patch({attachments:e.attachments.filter((r,d)=>d!==o)})}},o)),(!(e!=null&&e.attachments)||((u=e==null?void 0:e.attachments)==null?void 0:u.length)<=3)&&t("div",{className:"image",onClick:()=>{var l,o,r;M.Gallery.set({allowExternal:(r=(o=(l=k)==null?void 0:l.value)==null?void 0:o.AllowExternal)==null?void 0:r.MarketPlace,onSelect:d=>E.patch({attachments:[...(e==null?void 0:e.attachments)??[],d.src]})})},children:t($,{})})]})]})]})]})}function de({post:e}){const s=m(k),n=m(S.PhoneNumber),u=m(D);return t(R.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},exit:{opacity:0,scale:.9},viewport:{once:!0},transition:{duration:.2,ease:"easeInOut"},className:"post-item",onClick:()=>f.set(e),children:c("div",{className:"post-info",children:[c("div",{className:"post-header",children:[t("div",{className:"title",children:e.title}),t("div",{className:"date",children:Y(e.timestamp)})]}),c("div",{className:"post-content",children:[c("div",{className:"post-text",children:[t("div",{className:"description",children:j(e.description)}),t("div",{className:"price",children:s==null?void 0:s.CurrencyFormat.replace("%s",e.price.toLocaleString())})]}),t("div",{className:"attachment",children:t(F,{src:e.attachments[0],blur:e.number!==n})})]}),(n===e.number||u)&&t("div",{className:"post-footer",children:t(H,{className:"red",onClick:l=>{l.stopPropagation(),V(e.id)}})})]})})}const x={posts:[{id:"1",title:"X80 Proto",description:"X80 Proto, white with red details. Has been driven carefully and is in mint condition",number:"0601232354",attachments:["https://www.digitaltrends.com/wp-content/uploads/2020/08/grotti-x80-proto.jpg"],price:2e6,timestamp:Date.now()-1e3*60*60*2},{id:"2",title:"Banshee",description:"Selling my 2020 model Bravado Banshee, low mileage and in perfect condition. Price is negotiable.",number:"0606643134",attachments:["https://static.wikia.nocookie.net/gtawiki/images/e/ea/Penumbra-GTAV-front-Hao.png","https://static.wikia.nocookie.net/gtawiki/images/e/ea/Penumbra-GTAV-front-Hao.png"],price:74999,timestamp:Date.now()-1e3*60*60*24*2},{id:"3",title:"Sanchez, 2018 Model",description:"Selling my 2018 Sanchez. It has low mileage and is in perfect condition. Price is negotiable.",number:"0651566734",attachments:["https://static.wikia.nocookie.net/gtawiki/images/9/93/Sanchez2-GTAV-front.png","https://img.gta5-mods.com/q95/images/honda-crf-450-livery-sanchez/79a3f3-QlX0LDJLBUGUwml4_mil2w_0_0.jpg"],price:1999,timestamp:Date.now()-1e3*60*60*24*3},{id:"4",title:"Dominator",description:"Selling my 2020 model Dominator, low mileage and in perfect condition.",number:"1234567890",attachments:["https://static.wikia.nocookie.net/gtawiki/images/7/78/Dominator-GTAV-front.png","https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSMLEjCaWEavvnX3kliYe0gwrIGYljDaPb-KA&s"],price:49999,timestamp:Date.now()-1e3*60*60*24*5}]};function me(){m(S.Settings);const e=m(S.PhoneNumber),s=m(O),n=m(g),[u,l]=P.useState([]),[o,r]=P.useState(""),[d,C]=P.useState(""),{handleScroll:h,setPage:v,setFetchedEverything:L}=z({fetchData:a=>N("MarketPlace",{action:"getPosts",from:s==="personal_posts"?e:null,query:(o==null?void 0:o.length)>0?o:null,page:a}),onDataFetched:a=>o.length>0?l([...u,...a]):g.set([...n,...a]),perPage:15});return P.useEffect(()=>{X("MarketPlace")&&(v(0),L(!1),l([]),N("MarketPlace",{action:"getPosts",from:s==="personal_posts"?e:null},x.posts.filter(a=>s==="personal_posts"?a.number===e:!0)).then(a=>{a&&a.length>0?g.set(a):L(!0)}))},[s]),P.useEffect(()=>{v(0),L(!1),l([]),o.length>0&&N("MarketPlace",{action:"getPosts",from:s==="personal_posts"?e:null,query:o},x.posts.filter(a=>{var p;return((p=a.title)==null?void 0:p.toLowerCase().includes(o==null?void 0:o.toLowerCase()))&&(s==="personal_posts"?a.number===e:!0)})).then(a=>{if(!a)return b("warning","Failed to fetch search results");l(a)})},[o]),P.useEffect(()=>{const a=setTimeout(()=>r(d),500);return()=>clearTimeout(a)},[d]),P.useEffect(()=>{l([]),g.set([])},[s]),B("marketPlace:newPost",a=>{a.number!==e&&g.set([a,...n])},{waitUntilService:!0}),c(W,{children:[c("div",{className:"marketplace-header",children:[c("div",{className:"marketplace-header-top",children:[t("div",{className:"title",children:i("APPS.MARKETPLACE.MARKETPLACE")}),t(q,{onClick:()=>E.set({})})]}),t(Q,{placeholder:i("APPS.MARKETPLACE.SEARCH"),onChange:a=>C(a.target.value)})]}),t("div",{className:"marketplace-wrapper",children:t(R.div,{...G(s==="home"?"left":"right",s,.2),className:"posts",onScroll:h,children:(o.length>0?u:n).map((a,p)=>t(de,{post:a},a.id))})})]})}const he=[{icon:t(J,{}),title:i("APPS.MARKETPLACE.HOME"),value:"home"},{icon:t(Z,{}),title:i("APPS.MARKETPLACE.YOUR_POSTS"),value:"personal_posts"}];function ue(){const e=m(O);return t("div",{className:"marketplace-footer",children:he.map((s,n)=>c("div",{className:"item","data-active":e===s.value,onClick:()=>O.set(s.value),children:[s==null?void 0:s.icon,s.title]},n))})}function pe(){const e=m(f),s=m(k),n=m(S.PhoneNumber),u=m(D),[l,o]=P.useState(!1),r=P.useRef(null),[d,C]=P.useState(0),h={pos:{startLeft:0,startX:0},onMouseDown:a=>{X("MarketPlace")&&(h.pos={startLeft:r.current.scrollLeft,startX:a.clientX},r.current.style.userSelect="none",document.addEventListener("mouseup",h.onMouseUp),document.addEventListener("mousemove",h.onMove))},onMove:a=>{const p=(a.clientX-h.pos.startX)/I();r.current.scrollLeft=h.pos.startLeft-p;const A=r.current.getBoundingClientRect();(A.left*I()-5>a.clientX||a.clientX>A.right*I()-5)&&h.onMouseUp()},onMouseUp:()=>{r.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",h.onMouseUp),document.removeEventListener("mousemove",h.onMove);const a=e.attachments,p=r.current.clientWidth;let A=d;const w=r.current.scrollLeft-h.pos.startLeft;w>p/2&&A<a.length-1?A++:w<-p/2&&A>0&&A--,v(A)}},v=a=>{a<0||a>=e.attachments.length||(r.current.scrollTo({left:a*r.current.offsetWidth,behavior:"smooth"}),C(a))},L=a=>{a&&M.PopUp.set({title:i("APPS.SERVICES.CALL_POPUP.TITLE"),description:i("APPS.SERVICES.CALL_POPUP.DESCRIPTION").format({name:ne(a)}),buttons:[{title:i("APPS.SERVICES.CALL_POPUP.CANCEL")},{title:i("APPS.SERVICES.CALL_POPUP.PROCEED"),cb:()=>{let p=U(a);ie({...p,number:a})}}]})};return c("div",{className:"post-container",children:[t("div",{className:"marketplace-header",children:t("div",{className:"marketplace-header-top",children:c("div",{className:"back",onClick:()=>f.reset(),children:[t(_,{}),i("APPS.MARKETPLACE.HOME")]})})}),t("div",{className:"marketplace-wrapper",children:c("div",{className:"post-data",children:[c("div",{className:"attachments",children:[t("div",{className:"attachments-grid",ref:r,onMouseDown:h.onMouseDown,children:e.attachments&&e.attachments.map((a,p)=>t("div",{className:"image",onClick:()=>o(!0),children:t(F,{src:a,blur:!l&&e.number!==n})},p))}),c("div",{className:"arrows",children:[t("div",{className:"arrow","data-disabled":d===0,children:t(_,{onClick:()=>v(d-1)})}),t("div",{className:"arrow","data-disabled":d===e.attachments.length-1,children:t(ee,{onClick:()=>v(d+1)})})]}),t("div",{className:"count",children:i("APPS.MARKETPLACE.AMOUNT_OF_TOTAL").format({amount:d+1,total:e.attachments.length})})]}),c("div",{className:"post-content",children:[t("div",{className:"date",children:Y(e.timestamp)}),t("div",{className:"title",children:e.title}),t("div",{className:"price",children:s.CurrencyFormat.replace("%s",e.price.toLocaleString())}),t("div",{className:"description",children:e.description}),c("div",{className:"buttons",children:[c("div",{className:"button green",onClick:()=>{let a=U(e.number);te.patch({active:{name:"Messages",data:{number:e.number,name:a==null?void 0:a.name,avatar:a==null?void 0:a.avatar,view:"messages"}}})},children:[t(ae,{}),i("APPS.MARKETPLACE.MESSAGE")]}),c("div",{className:"button blue",onClick:()=>L(e.number),children:[t(se,{}),i("APPS.MARKETPLACE.CALL")]}),(n===e.number||u)&&c("div",{className:"button red",onClick:()=>V(e.id),children:[t(H,{}),i("APPS.MARKETPLACE.REMOVE")]})]})]})]})})]})}const O=T("home"),D=T(!1),g=T([]),f=T(null),E=T(null);function ge(){const e=m(f),s=m(E),n=m(S.Styles.TextColor);return P.useEffect(()=>{N("isAdmin").then(u=>D.set(u))},[]),c("div",{className:"marketplace-container",children:[re()?c(R.div,{...G(e?"right":"left",e?"post":"home",.2),className:"marketplace-canister",children:[t(me,{}),t(K,{children:e&&t(pe,{})}),t(ue,{})]}):t("div",{className:"loading",children:t(ce,{size:40,lineWeight:5,speed:2,color:n})}),t(K,{children:s&&t(oe,{})})]})}const V=e=>{if(!e)return b("error","No id provided to delete post");M.PopUp.set({title:i("APPS.MARKETPLACE.DELETE_POPUP.TITLE"),description:i("APPS.MARKETPLACE.DELETE_POPUP.TEXT"),buttons:[{title:i("APPS.MARKETPLACE.DELETE_POPUP.CANCEL")},{title:i("APPS.MARKETPLACE.DELETE_POPUP.PROCEED"),color:"red",cb:()=>{N("MarketPlace",{action:"deletePost",id:e},!0).then(s=>{if(!s)return b("error","Failed to delete post");g.set(g.value.filter(n=>n.id!==e)),f!=null&&f.value&&f.reset()})}}]})},Y=e=>{var l,o;const s=new Date,n=new Date(e),u=new Intl.PluralRules((o=(l=k)==null?void 0:l.value)==null?void 0:o.DateLocale,{type:"ordinal"});if(s.getFullYear()===n.getFullYear()&&s.getMonth()===n.getMonth()){let r=n.getHours()<10?`0${n.getHours()}`:n.getHours(),d=n.getMinutes()<10?`0${n.getMinutes()}`:n.getMinutes();if(s.getDate()===n.getDate())return i("MISC.TODAY_TIME").format({hours:r,minutes:d});if(s.getDate()-1===n.getDate())return i("MISC.YESTERDAY_TIME").format({hours:r,minutes:d});const C=n.getDate(),h=C%100,v=i(`MISC.ORDINAL.${u.select(h).toUpperCase()}`);return`${n.toLocaleString("default",{month:"long"})} ${C}${v}, ${n.getFullYear()}`}};export{f as ActivePost,D as IsAdmin,E as NewPost,g as Posts,O as View,ge as default,V as deletePost,Y as formatDate};
