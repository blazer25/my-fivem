import{u as g,r as E,H as U,w as l,ac as K,v as m,t as D,j as r,m as L,S as M,a as n,L as e,ay as B,C as d,cC as z,b as k,ao as Q,ap as Z,z as ee,a3 as te,c2 as ne,al as ae,f as se,A as Y,P as y,N as ie,a2 as $,I as re,aj as oe,X as le,ad as W,ae as ce,q as V,d as _,cx as Ae,a9 as Pe,x as F,K as x}from"./index-569b241b.js";const G={username:"lb",channels:[{id:1,name:"guns",members:7,lastMessage:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{id:2,name:"comics",members:134,lastMessage:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{id:3,name:"cars",members:23,lastMessage:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12}],messages:{guns:[{content:"i have a draco, 2k",sender:"kevin",timestamp:Date.now()-1e3*60*60*4},{content:"yo, does anyone have any weapons for sale?",sender:"rya2n",timestamp:Date.now()-1e3*60*60*6},{content:"sup",sender:"lb",timestamp:Date.now()-1e3*60*60*17}],comics:[{content:"whats up, i found this really great comic the other day",sender:"anonymous943",timestamp:Date.now()-1e3*60*60*8},{content:"any good cominc recommendations?",sender:"yungblood",timestamp:Date.now()-1e3*60*60*10},{content:"just finished reading the new batman comic, its amazing",sender:"batmanfan123",timestamp:Date.now()-1e3*60*60*24}],cars:[{content:"i have a 2019 mustang for sale",sender:"pirateking32",timestamp:Date.now()-1e3*60*60*12},{content:"anyone know where i can get a good deal on a car?",sender:"anonymous",timestamp:Date.now()-1e3*60*60*14},{content:"i have a 2018 camaro for sale, 15k",sender:"camaroguy",timestamp:Date.now()-1e3*60*60*18},{content:"i have a 2017 mustang for sale, 10k",sender:"mustangguy",timestamp:Date.now()-1e3*60*60*20},{content:"looking for a quite new car in good condition for around 10k, anyone know where i can find one?",sender:"lb",timestamp:Date.now()-1e3*60*60*22}]}};function de(){var f,I;const s=g(u),P=g(R),C=g(Y),[o,S]=E.useState(""),[A,h]=E.useState(""),p=g(y.Settings),T=g(l.APPS.DARKCHAT.channels);E.useEffect(()=>{if(U("DarkChat")&&!l.APPS.DARKCHAT.channels.value){if(!K())return m("warning","No service, not fetching channels");D("DarkChat",{action:"getChannels"},G.channels).then(c=>{if(!c)return m("warning","Failed to fetch channels");l.APPS.DARKCHAT.channels.set(c)})}},[C==null?void 0:C.active,P]);const v=()=>{D("AccountSwitcher",{action:"getAccounts",app:"DarkChat"},null).then(c=>{var a;if(!c)return m("info","No accounts found");let t=(a=c==null?void 0:c.filter(i=>i!==P))==null?void 0:a.map(i=>({title:i,cb:()=>{D("AccountSwitcher",{action:"switch",app:"DarkChat",account:i}).then(()=>{R.set(i),l.APPS.DARKCHAT.username.set(i),l.APPS.DARKCHAT.channels.reset(),u.set("channels")})}}));d.ContextMenu.set({buttons:[{title:P},...t,{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:()=>{u.set("signup"),R.reset(),l.APPS.DARKCHAT.username.reset(),l.APPS.DARKCHAT.channels.reset()}},{title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),color:"red",cb:()=>{d.PopUp.set({title:e("APPS.MAIL.SIGN_OUT_POPUP.TITLE"),description:e("APPS.MAIL.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:e("APPS.MAIL.SIGN_OUT_POPUP.CANCEL")},{title:e("APPS.MAIL.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{D("DarkChat",{action:"logout"},!0).then(i=>{if(!i)return m("warning","Failed to logout, success returned false");R.reset(),l.APPS.DARKCHAT.username.reset(),l.APPS.DARKCHAT.channels.reset(),u.set("signin")})}}]})}}]})})},w=()=>{let c="";d.PopUp.set({title:e("APPS.DARKCHAT.JOIN_ROOM"),description:e("APPS.DARKCHAT.JOIN_ROOM_TEXT"),input:{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:p!=null&&p.streamerMode?"password":"text",minCharacters:3,onChange:t=>c=t},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{if(!K()){m("warning","No service, not joining channel"),d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]});return}return D("DarkChat",{action:"joinChannel",channel:c},"password_required").then(t=>{if(!t)return m("warning","Failed to join channel");if(t==="invalid_channel")return d.PopUp.set({title:e("APPS.DARKCHAT.INVALID_CHANNEL"),description:e("APPS.DARKCHAT.INVALID_CHANNEL_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(t==="already_in_channel")return d.PopUp.set({title:e("APPS.DARKCHAT.ALREADY_IN_CHANNEL"),description:e("APPS.DARKCHAT.ALREADY_IN_CHANNEL_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(t==="password_required"){let a="";d.PopUp.set({title:e("APPS.DARKCHAT.PASSWORD_REQUIRED"),description:e("APPS.DARKCHAT.PASSWORD_REQUIRED_TEXT"),input:{placeholder:e("APPS.DARKCHAT.PASSWORD_PLACEHOLDER"),type:"password",onChange:i=>a=i},buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.JOIN"),color:"blue",cb:()=>{D("DarkChat",{action:"joinChannel",channel:c,password:a},{timestamp:Date.now(),name:c,members:Math.floor(Math.random()*100),lastMessage:"Welcome to the channel!",sender:"admin"}).then(i=>{if(!i)return m("warning","Failed to join channel");if(i==="incorrect_password")return d.PopUp.set({title:e("APPS.DARKCHAT.INCORRECT_PASSWORD"),description:e("APPS.DARKCHAT.INCORRECT_PASSWORD_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});H.set(i),u.set("chat"),l.APPS.DARKCHAT.channels.set([i,...T])})}}]});return}H.set(t),u.set("chat"),l.APPS.DARKCHAT.channels.set([t,...T])}),A}}]})},b=()=>{let c="",t="";d.PopUp.set({title:e("APPS.DARKCHAT.CREATE_ROOM"),description:e("APPS.DARKCHAT.CREATE_ROOM_TEXT"),inputs:[{placeholder:e("APPS.DARKCHAT.ROOM_CODE"),type:"text",minCharacters:3,onChange:a=>c=a},{placeholder:e("APPS.DARKCHAT.PASSWORD_PLACEHOLDER_OPTIONAL"),type:"password",onChange:a=>t=a}],buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.CREATE"),color:"blue",cb:()=>{D("DarkChat",{action:"createChannel",channel:c,password:(t==null?void 0:t.length)>0?t:null},{timestamp:Date.now(),name:c,members:1}).then(a=>{if(!a)return m("warning","Failed to create channel");if(a==="channel_exists")return d.PopUp.set({title:e("APPS.DARKCHAT.CHANNEL_EXISTS"),description:e("APPS.DARKCHAT.CHANNEL_EXISTS_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(a==="invalid_name")return d.PopUp.set({title:e("APPS.DARKCHAT.INVALID_NAME"),description:e("APPS.DARKCHAT.INVALID_NAME_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});if(a==="unknown_error")return d.PopUp.set({title:e("APPS.DARKCHAT.UNKNOWN_ERROR"),description:e("APPS.DARKCHAT.UNKNOWN_ERROR_TEXT"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});H.set(a),u.set("chat"),l.APPS.DARKCHAT.channels.set([a,...T])})}}]})};return r(L.div,{...M("left",s,.2),className:"animation-container",children:[r("div",{className:"darkchat-header",children:[r("div",{className:"top",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.TITLE")}),r("div",{className:"buttons",children:[n(B,{onClick:()=>{P&&d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.JOIN_ROOM"),cb:w},{title:e("APPS.DARKCHAT.CREATE_ROOM"),cb:b}]})}}),n(z,{className:"elipse",onClick:()=>{var c,t,a,i;d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.CHANGE_ACCOUNT"),cb:v},((t=(c=k)==null?void 0:c.value)==null?void 0:t.ChangePassword.DarkChat)&&{title:e("APPS.DARKCHAT.CHANGE_PASSWORD"),cb:()=>Q("DarkChat",()=>{})},((i=(a=k)==null?void 0:a.value)==null?void 0:i.DeleteAccount.DarkChat)&&{title:e("APPS.DARKCHAT.DELETE_ACCOUNT"),color:"red",cb:()=>{Z("DarkChat",()=>{R.reset(),l.APPS.DARKCHAT.username.set(null),l.APPS.DARKCHAT.channels.set(null),u.set("signin")})}}]})}})]})]}),n(ee,{placeholder:e("APPS.DARKCHAT.SEARCH"),theme:"dark",onChange:c=>S(c.target.value)})]}),(T==null?void 0:T.length)===0&&r("div",{className:"no-channels",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.NO_CHATS")}),n("div",{className:"description",children:e("APPS.DARKCHAT.NO_CHATS_TEXT")})]}),n("div",{className:"channels-body",children:(I=(f=T==null?void 0:T.sort((c,t)=>t.timestamp-c.timestamp))==null?void 0:f.filter(c=>{var t;return(t=c.name)==null?void 0:t.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))==null?void 0:I.map(c=>n(me,{channel:c},c.id))})]})}const me=({channel:s})=>{const P=g(R),C=g(y.Settings),o=A=>/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(A),S=te(A=>{d.ContextMenu.set({buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),color:"red",cb:()=>{d.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_CHANNEL.TITLE"),description:e("APPS.DARKCHAT.LEAVE_CHANNEL.DESCRIPTION"),buttons:[{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE_CHANNEL.PROCEED"),cb:()=>{D("DarkChat",{action:"leaveChannel",channel:s.name},!0).then(h=>{if(!h)return m("warning","Failed to leave channel");u.set("channels"),H.set(null);let p=l.APPS.DARKCHAT.channels.value.filter(T=>T.name!==s.name);l.APPS.DARKCHAT.channels.set(p)})}}]})}}]})});return r("div",{...S,className:"channel",onClick:()=>{P&&(H.set(s),u.set("chat"))},children:[r("div",{className:"channel-info",children:[r("div",{className:"members",children:[n(ne,{}),n("span",{children:s.members})]}),r("div",{className:"channel-content",children:[n("div",{className:"channel-name",children:C.streamerMode?"*****":s.name}),s.lastMessage&&r("div",{className:"recent-message",children:[r("b",{children:[s.sender,":"]})," ",o(s.lastMessage)?e("APPS.MESSAGES.SENT_LOCATION_SHORT"):s.lastMessage]})]})]}),r("div",{className:"right",children:[n("div",{className:"timestamp",children:ae(s.timestamp)}),n(se,{})]})]})};function he(){const s=g(y.Settings),P=g(H),C=g(R),o=g(u),S=g(d.Emoji),[A,h]=E.useState([]),[p,T]=E.useState(""),v=E.useRef(null),w=E.useRef(0);E.useEffect(()=>{var t;if(U("DarkChat")){if(!K())return m("warning","No service, not fetching messages");D("DarkChat",{action:"getMessages",channel:P.name},(t=G.messages)==null?void 0:t[P.name]).then(a=>{if(!a)return m("error","Failed to fetch messages");h(a.reverse())})}},[]);const{handleScroll:b}=ie({fetchData:()=>{var t;return D("DarkChat",{action:"getMessages",channel:P.name,lastId:(t=A[0])==null?void 0:t.id})},onDataFetched:t=>{let a=document.querySelector(".chat-wrapper");w.current=a.scrollHeight,h(i=>[...t.reverse(),...i])},isReversed:!0,perPage:15});E.useEffect(()=>{let t=document.querySelector(".chat-wrapper");if(!t)return;const a=t.scrollHeight;t.scrollTop+=a-w.current},[A]);const f=()=>{if(!K()){d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]}),m("warning","No service, not sending message");return}if(p.length>0){let t={sender:C,content:p,timestamp:new Date().getTime()};D("DarkChat",{action:"sendMessage",content:p,channel:P.name},!0).then(a=>{if(!a)return h(N=>[...N,{...t,delivered:!1}]);T(""),v.current.value="",h([...A,t]);let i=l.APPS.DARKCHAT.channels.value.map(N=>(N.name===P.name&&(N.lastMessage=t.content,N.sender=C,N.timestamp=new Date().getTime()),N));l.APPS.DARKCHAT.channels.set(i)})}},I=()=>{d.PopUp.set({title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TITLE"),description:e("APPS.MESSAGES.SEND_LOCATION_POPUP.TEXT"),buttons:[{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.CANCEL")},{title:e("APPS.MESSAGES.SEND_LOCATION_POPUP.SEND"),cb:()=>{if(!K()){d.PopUp.set({title:e("MISC.AIRPLANE_MODE_POPUP.TITLE"),description:e("MISC.AIRPLANE_MODE_POPUP.DESCRIPTION"),buttons:[{title:e("MISC.AIRPLANE_MODE_POPUP.OK")}]}),m("warning","No service, not sending location");return}D("Maps",{action:"getCurrentLocation"},{x:"0",y:"0"}).then(t=>{if(!t)return;let a={content:`<!SENT-LOCATION-X=${F(t.x,2)}Y=${F(t.y,2)}!>`,sender:C,timestamp:new Date().getTime()};D("DarkChat",{action:"sendMessage",...a,channel:P.name},!0).then(i=>{if(!i)return h(O=>[...O,{...a,delivered:!1}]);T(""),v.current.value="";let N=l.APPS.DARKCHAT.channels.value.map(O=>(O.name===P.name&&(O.lastMessage=a.content,O.sender=C,O.timestamp=new Date().getTime()),O));l.APPS.DARKCHAT.channels.set(N)})})}}]})};$("darkChat:newMessage",t=>{if(P.name!==t.channel||!U("DarkChat"))return;let a=l.APPS.DARKCHAT.channels.value.map(i=>(i.name===t.channel&&(i.lastMessage=t.content,i.sender=t.sender,i.timestamp=new Date().getTime()),i));l.APPS.DARKCHAT.channels.set(a),h([...A,{...t,timestamp:new Date().getTime()}])},{waitUntilService:!0});const c=t=>{if(t)return/<!SENT-LOCATION-X=(-?\d*\.?\d*)Y=(-?\d*\.?\d*)!>/.test(t)};return r(L.div,{...M("right",o,.2),className:"animation-container",children:[n("div",{className:"darkchat-header chat",children:r("div",{className:"top",children:[n(re,{onClick:()=>{u.set("channels"),H.set(null)}}),r("div",{className:"content",children:[n("div",{className:"title",children:s.streamerMode?"*****":P.name}),r("div",{className:"members",children:[P.members," ",P.members===1?e("APPS.DARKCHAT.MEMBER"):e("APPS.DARKCHAT.MEMBERS")]})]}),n(oe,{onClick:()=>{d.PopUp.set({title:e("APPS.DARKCHAT.LEAVE_ROOM"),description:e("APPS.DARKCHAT.LEAVE_ROOM_TEXT"),buttons:[{title:e("APPS.DARKCHAT.CANCEL")},{title:e("APPS.DARKCHAT.LEAVE"),color:"red",cb:()=>{D("DarkChat",{action:"leaveChannel",channel:P.name},!0).then(t=>{if(!t)return m("warning","Failed to leave channel");u.set("channels"),H.set(null);let a=l.APPS.DARKCHAT.channels.value.filter(i=>i.name!==P.name);l.APPS.DARKCHAT.channels.set(a)})}}]})}})]})}),n("div",{className:"chat-wrapper",onScroll:b,children:n("div",{className:"chat-body",children:A.map((t,a)=>{var j;let i,N=null,O=t.sender===C?"self":"other",X=((j=A[a+1])==null?void 0:j.sender)===C?"self":"other";if(A[a+1]?i=Math.abs(t.timestamp-A[a+1].timestamp)/36e5:X=void 0,c(t.content)){let q=t.content.match(/X=(-?\d*\.?\d*)Y/)[1],J=t.content.match(/Y=(-?\d*\.?\d*)!>/)[1];N={x:q,y:J}}return r("div",{className:le("message",O),children:[t.delivered===!1?r("div",{className:"content-wrapper",children:[n("div",{className:"content",children:W(t.content)}),n(ce,{})]}):N?n("div",{className:"location",onClick:()=>{Y.patch({active:{name:"Maps",data:{location:[N.y,N.x],name:`${t.sender}'s location`}}})},children:n("div",{className:"img",style:{backgroundImage:'url("https://img.gta5-mods.com/q95/images/mirror-park-garden/2b72f9-20160428154103_1.jpg")'}})}):n("div",{className:"content",children:W(t.content)}),A[a+1]&&i>6?r("div",{className:"date",children:[O=="other"&&n("div",{className:"user",children:t.sender}),V(t.timestamp)]}):O!==X&&r("div",{className:"date",children:[O=="other"&&n("div",{className:"user",children:t.sender}),V(t.timestamp)]})]},a)})})}),n("div",{className:"chat-bottom",children:r("div",{className:"input",children:[n(_,{type:"text",placeholder:e("APPS.DARKCHAT.INPUT_PLACEHOLDER"),value:p,ref:v,onChange:t=>T(t.target.value),onKeyDown:t=>{if(t.key==="Enter")return f()}}),r("div",{className:"buttons",children:[n("div",{className:"location",children:n(Ae,{onClick:I})}),n("div",{className:"location",onClick:()=>{if(S)return d.Emoji.reset();d.Emoji.set({onSelect:t=>T(a=>`${a}${t.emoji}`)})},children:"ðŸ˜€"}),p.length>0&&n("div",{className:"send",onClick:f,children:n(Pe,{})})]})]})})]})}function ue(){const[s,P]=E.useState({username:"",password:""}),C=()=>{D("DarkChat",{action:"login",username:s.username,password:s.password},{success:!0}).then(o=>{o&&o.success?(R.set(s.username),l.APPS.DARKCHAT.username.set(s.username),u.set("channels")):o&&o.reason&&(m("error",o.reason),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${o.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]}))})};return n(L.div,{...M("right","signin",.2),className:"animation-container",children:r("div",{className:"form",children:[n("div",{className:"form-header",children:n("div",{className:"title",children:e("APPS.DARKCHAT.LOGIN")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),n("div",{className:"input",children:n(_,{type:"text",placeholder:"anonymous",maxLength:50,onChange:o=>{var S;P({...s,username:(S=o.target.value)==null?void 0:S.toLowerCase()})}})})]}),r("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),n("div",{className:"input",children:n(_,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:3,onChange:o=>{P({...s,password:o.target.value})}})})]}),n("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.LOGIN")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.NO_ACCOUNT")," ",n("span",{onClick:()=>u.set("signup"),children:e("APPS.DARKCHAT.SIGN_UP")})]})]})})}function Ce(){const[s,P]=E.useState({username:"",password:""}),C=()=>{var A;if(s.username===""||s.password==="")return m("warning","Username or password is empty");let o=(A=s==null?void 0:s.username)==null?void 0:A.toLowerCase().replace(/\s/g,""),S=o==null?void 0:o.match(k.value.UsernameFilter);if(!S||(S==null?void 0:S[0])!==o||o.length<3||o.length>15){m("warning","Username did not match regex"),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e("APPS.DARKCHAT.USERNAME_NOT_ALLOWED"),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}D("DarkChat",{action:"register",username:s.username,password:s.password},{success:!0}).then(h=>{if(!h)return m("warning","Darkchat response is null");if(h&&h.success)m("info","Account created successfully"),R.set(s.username),l.APPS.DARKCHAT.username.set(s.username),u.set("channels");else if(h&&h.reason){m("warning",h.reason),d.PopUp.set({title:e("APPS.DARKCHAT.ERROR"),description:e(`APPS.DARKCHAT.${h.reason.toUpperCase()}`),buttons:[{title:e("APPS.DARKCHAT.OK")}]});return}})};return n(L.div,{...M("left","signup",.2),className:"animation-container",children:r("div",{className:"form",children:[n("div",{className:"form-header",children:n("div",{className:"title",children:e("APPS.DARKCHAT.SIGN_UP")})}),r("div",{className:"form-content",children:[r("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.USERNAME")}),n("div",{className:"input",children:n(_,{type:"text",placeholder:"anonymous",maxLength:50,onChange:o=>{var S;P({...s,username:(S=o.target.value)==null?void 0:S.toLowerCase()})}})})]}),r("div",{className:"item",children:[n("div",{className:"title",children:e("APPS.DARKCHAT.PASSWORD")}),n("div",{className:"input",children:n(_,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",minLength:3,onChange:o=>{P({...s,password:o.target.value})}})})]}),n("div",{className:"button",onClick:()=>C(),children:e("APPS.DARKCHAT.SIGN_UP")})]}),r("div",{className:"footer",children:[e("APPS.DARKCHAT.ALREADY_HAVE")," ",n("span",{onClick:()=>u.set("signin"),children:e("APPS.DARKCHAT.LOGIN")})]})]})})}const Se={channels:n(de,{}),chat:n(he,{}),signin:n(ue,{}),signup:n(Ce,{})},u=x("signup"),H=x(null),R=x(null);function pe(){const s=g(u),[P,C]=E.useState(""),[o,S]=E.useState(!0);return E.useEffect(()=>{if(l.APPS.DARKCHAT.username.value){R.set(l.APPS.DARKCHAT.username.value),S(!1);return}D("DarkChat",{action:"getUsername"},G.username).then(A=>{if(S(!1),!A||!(A!=null&&A.username))return m("warning","Darkchat response is null");R.set(A.username),l.APPS.DARKCHAT.username.set(A.username),A.password?u.set("channels"):d.PopUp.set({title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),description:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.DESCRIPTION"),input:{type:"password",placeholder:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.PLACEHOLDER"),minLength:3,maxLength:50,onChange:h=>C(h)},buttons:[{title:e("APPS.DARKCHAT.SET_PASSWORD_POPUP.TITLE"),cb:()=>{C(h=>(D("DarkChat",{action:"setPassword",password:h},{success:!0}).then(p=>{if(!p||p!=null&&p.reason)return m("error",p.reason);u.set("channels")}),""))}}]})})},[]),$("darkchat:logout",A=>{if(!A)return m("warning","No username provided to logout");if(!R.value)return m("warning","No username stored in cache to logout");if(A!==(R==null?void 0:R.value))return m("warning","Username provided does not match current logged in username, not logging out");R.set(null),u.set("signin"),l.APPS.DARKCHAT.username.set(null),l.APPS.DARKCHAT.channels.set(null)}),n("div",{className:"darkchat-container",children:!o&&Se[s]})}export{H as ActiveChannel,R as Username,u as View,pe as default};
